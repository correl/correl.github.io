<!doctype html>
<html lang="en-us">
  <head>
    <title>Automating My Apartment With Home Assistant // Projects and Coding Adventures</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.105.0">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Correl Roush" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://correl.phoenixinquis.net/css/main.min.86d08b4bb3efd338b408a5c3ba02c2f37aa024dbec7f62531aae2f9a7c0aa6da.css" />

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-429788-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Automating My Apartment With Home Assistant"/>
<meta name="twitter:description" content="A while ago, I posted about my experiments with the Phillips Hue API to create an automated morning sunrise effect. The end result was nice, but all that mucking about with their HTTP APIs was a hassle any time I wanted to tweak something. I wanted to define what I wanted in a more declarative style, and have all the API calls managed behind the scenes. Home Assistant allowed me to do exactly that, and more."/>

    <meta property="og:title" content="Automating My Apartment With Home Assistant" />
<meta property="og:description" content="A while ago, I posted about my experiments with the Phillips Hue API to create an automated morning sunrise effect. The end result was nice, but all that mucking about with their HTTP APIs was a hassle any time I wanted to tweak something. I wanted to define what I wanted in a more declarative style, and have all the API calls managed behind the scenes. Home Assistant allowed me to do exactly that, and more." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://correl.phoenixinquis.net/2019/06/27/automating-my-apartment-with-home-assistant.html" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2019-06-27T18:13:00-04:00" />
<meta property="article:modified_time" content="2019-06-27T18:13:00-04:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://correl.phoenixinquis.net/"><img class="app-header-avatar" src="/avatar.jpg" alt="Correl Roush" /></a>
      <h1>Correl Roush</h1>
      <p>Transgender ・ MtF ・ Genderfluid ・ She/Her</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://twitter.com/correlr"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <title>twitter</title>
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg></a>
        
          <a target="_blank" href="https://github.com/correl"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
          <a target="_blank" href="https://www.instagram.com/correlroush/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-instagram">
  <title>instagram</title>
  <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.5" y2="6.5"></line>
</svg></a>
        
        <a target="_blank" rel="me" href="https://mastodon.cloud/@correl">
          <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
               width="24" height="24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" class="icon">
            <title>Mastodon</title>
            <path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"/>
          </svg>
        </a>
      </div>
      <p>
          <a href="/files/resume.pdf"> 
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-download">
  <title>download</title>
  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line>
</svg>
              Download Résumé
          </a>
      </p>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Automating My Apartment With Home Assistant</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jun 27, 2019
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          6 min read
        </div><div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://correl.phoenixinquis.net/tags/home-automation.html">home-automation</a></div></div>
    </header>
    <div class="post-content">
      <p>A while ago, I <a href="/2018/03/13/hue-wake-up.html">posted about</a> my experiments with the Phillips Hue API
to create an automated morning sunrise effect. The end result was
nice, but all that mucking about with their HTTP APIs was a hassle any
time I wanted to tweak something. I wanted to define what I wanted in
a more declarative style, and have all the API calls managed behind
the scenes. <a href="https://www.home-assistant.io/">Home Assistant</a> allowed me to do exactly that, and more.</p>
<p>While the Home Assistant docs are geared heavily towards setting up a
raspberry pi appliance to run everything 24/7, I don&rsquo;t own one, and I
already have a server going. I opted instead to get the home assistant
server running using <a href="https://www.home-assistant.io/docs/installation/docker/">Docker</a>, and setting up a git repository to hold
my configuration.</p>
<h2 id="a-brand-new-day">A Brand New Day</h2>
<p>Setting up my sunrise was actually <em>really</em> easy. I already had the
scenes I wanted from my <a href="/2018/03/13/hue-wake-up.html">previous attempt</a>, so it was just a matter of
codifying them in the YAML config. I split them into four scenes - a
start (dawn) and end (daylight) pair for the standing lamp at the wall
beyond the foot of the bed, and a pair for the two nightstand lights.
The end scenes include the transition time to fade in (30 minutes).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">scene</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Dawn Sun</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">entities</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">light.standing_lamp</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#66d9ef">on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">brightness</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">xy_color</span>: [<span style="color:#ae81ff">0.6042</span>, <span style="color:#ae81ff">0.3739</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Dawn Daylight</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">entities</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">light.correls_nightstand</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#66d9ef">on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">brightness</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">xy_color</span>: [<span style="color:#ae81ff">0.2376</span>, <span style="color:#ae81ff">0.1186</span>]
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">light.stephanies_nightstand</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#66d9ef">on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">brightness</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">xy_color</span>: [<span style="color:#ae81ff">0.2376</span>, <span style="color:#ae81ff">0.1186</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Sunrise Sun</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">entities</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">light.standing_lamp</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#66d9ef">on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">transition</span>: <span style="color:#ae81ff">1800</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">brightness</span>: <span style="color:#ae81ff">254</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">xy_color</span>: [<span style="color:#ae81ff">0.3769</span>, <span style="color:#ae81ff">0.3639</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Sunrise Daylight</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">entities</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">light.correls_nightstand</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#66d9ef">on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">transition</span>: <span style="color:#ae81ff">1800</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">brightness</span>: <span style="color:#ae81ff">203</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">xy_color</span>: [<span style="color:#ae81ff">0.2698</span>, <span style="color:#ae81ff">0.295</span>]
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">light.stephanies_nightstand</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#66d9ef">on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">transition</span>: <span style="color:#ae81ff">1800</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">brightness</span>: <span style="color:#ae81ff">203</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">xy_color</span>: [<span style="color:#ae81ff">0.2698</span>, <span style="color:#ae81ff">0.295</span>]
</span></span></code></pre></div><p>Breaking them apart this way means I can trigger the &ldquo;sun&rdquo; first for a
splash of orange, then start up the nightstand &ldquo;daylight&rdquo; lights a
little bit later! This worked out well, too, since even at the lowest
brightness, having them turn on right at the start when the room is
totally dark had a tendency to jolt me awake. Staggering them produces
a much gentler effect. Scripting all of this took very little work&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">script</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sunrise</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">alias</span>: <span style="color:#ae81ff">Sunrise</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sequence</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">scene.turn_on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">scene.dawn_sun</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">scene.turn_on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">scene.sunrise_sun</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">delay</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">seconds</span>: <span style="color:#ae81ff">180</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">scene.turn_on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">scene.dawn_daylight</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">scene.turn_on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">scene.sunrise_daylight</span>
</span></span></code></pre></div><p>&hellip; and the end result really is quite pleasant:</p>
<style>.org-center { margin-left: auto; margin-right: auto; text-align: center; }</style>
<div class="org-center">
<p><img src="/ox-hugo/ha-lights-1.png" alt="">
<img src="/ox-hugo/ha-lights-2.png" alt="">
<img src="/ox-hugo/ha-lights-3.png" alt=""></p>
</div>
<p>That just leaves the automation, which fires a half an hour before the
<em>actual</em> sunrise, so long as the lights aren&rsquo;t already on and somebody
is home (using a binary sensor I defined elsewhere based on phones
detected in the house plus an override toggle).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">automation</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">alias</span>: <span style="color:#ae81ff">Sunrise</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">action</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">script.sunrise</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">trigger</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">sun</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">sunrise</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">offset</span>: <span style="color:#e6db74">&#39;-00:30:00&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">condition</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">state</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">binary_sensor.occupied</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#e6db74">&#39;on&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">state</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">group.bedroom_lights</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#e6db74">&#39;off&#39;</span>
</span></span></code></pre></div><p>I later extended the automation with some configuration inputs, which
tie into some new triggers and conditions. I added a &ldquo;latest start
time&rdquo; to make sure it always gets me up in time for me to get ready
for work, and an option to disable the wake-up on weekends.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">input_select</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sunrise_days</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Days to wake up</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">options</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">Every Day</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">Weekdays</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initial</span>: <span style="color:#ae81ff">Every Day</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">icon</span>: <span style="color:#ae81ff">mdi:weather-sunset</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">input_datetime</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sunrise_time</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Latest start time</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">has_date</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">has_time</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initial</span>: <span style="color:#e6db74">&#39;06:30&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">automation</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">alias</span>: <span style="color:#ae81ff">Sunrise</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">action</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">script.sunrise</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">trigger</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">sun</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">sunrise</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">offset</span>: <span style="color:#e6db74">&#39;-00:30:00&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">template</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value_template</span>: &gt;-<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          {{ states(&#39;sensor.time&#39;) == (
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">               states.input_datetime.sunrise_time.attributes.timestamp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">               | int | timestamp_custom(&#39;%H:%M&#39;, False)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             )
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          }}</span>          
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">condition</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">state</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">binary_sensor.occupied</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#e6db74">&#39;on&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">state</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">group.bedroom_lights</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#e6db74">&#39;off&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">or</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">conditions</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">state</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">input_select.sunrise_days</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">state</span>: <span style="color:#ae81ff">Every Day</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">and</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">conditions</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">state</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">input_select.sunrise_days</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">state</span>: <span style="color:#ae81ff">Weekdays</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">time</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">weekday</span>:
</span></span><span style="display:flex;"><span>                  - <span style="color:#ae81ff">mon</span>
</span></span><span style="display:flex;"><span>                  - <span style="color:#ae81ff">tue</span>
</span></span><span style="display:flex;"><span>                  - <span style="color:#ae81ff">wed</span>
</span></span><span style="display:flex;"><span>                  - <span style="color:#ae81ff">thu</span>
</span></span><span style="display:flex;"><span>                  - <span style="color:#ae81ff">fri</span>
</span></span></code></pre></div><p>Sprinkle in some groups, and I&rsquo;ve got a nice panel in my Home
Assistant UI to manage everything:</p>
<figure><img src="/images/ha-sunrise-ui.png"
         alt="Figure 1: The completed sunrise panel"/><figcaption>
            <p><span class="figure-number">Figure 1: </span>The completed sunrise panel</p>
        </figcaption>
</figure>

<h2 id="keep-it-down">Keep It Down!</h2>
<p>Determined to find more things to automate, I realized that since I
have my TV audio going through a Sonos sound bar, I could very easily
automate the rather annoying ritual of leaping for the app on my phone
to turn on night mode when a movie I&rsquo;m watching is getting explodey
and I realize it&rsquo;s a bit late in the evening to be shaking my
neighbor&rsquo;s walls.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">automation</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">alias</span>: <span style="color:#ae81ff">Toggle Sonos night mode</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">action</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">media_player.sonos_set_option</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">media_player.den</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data_template</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">night_sound</span>: &gt;-<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span>            {{ <span style="color:#ae81ff">now().hour &gt;= 22 }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">trigger</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">time</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">at</span>: <span style="color:#e6db74">&#39;22:30:00&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">time</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">at</span>: <span style="color:#e6db74">&#39;08:00:00&#39;</span>
</span></span></code></pre></div><p>Boom. Happier neighbors, and I can fall asleep in front of movies
without worry!</p>
<p>Just because I could, I also added some configurability to this
automation as well. The logic got a bit tricky, since I wanted to
configure a window that crosses a 24-hour boundary. I also added a
binary sensor so I could see when night mode was enabled from Home
Assistant.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">automation</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">alias</span>: <span style="color:#ae81ff">Toggle Sonos night mode</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">action</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">media_player.sonos_set_option</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">media_player.den</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data_template</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">night_sound</span>: &gt;-<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {% set start = states.input_datetime.sonos_nightmode_start.attributes %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {% set end = states.input_datetime.sonos_nightmode_end.attributes %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {% set now_ = (now().hour, now().minute, now().second) %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {% set start_ = (start.hour, start.minute, start.second) %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {% set end_ = (end.hour, end.minute, end.second) %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {% if start_ &gt; end_ -%}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              {{ now_ &gt;= start_ or now_ &lt; end_ }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {%- else -%}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              {{ now_ &gt;= start_ and now_ &lt; end_ }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {%- endif -%}</span>            
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">trigger</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">template</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value_template</span>: <span style="color:#e6db74">&#34;{{ states(&#39;sensor.time&#39;) == (states.input_datetime.sonos_nightmode_start.attributes.timestamp | int | timestamp_custom(&#39;%H:%M&#39;, False)) }}&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">template</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value_template</span>: <span style="color:#e6db74">&#34;{{ states(&#39;sensor.time&#39;) == (states.input_datetime.sonos_nightmode_end.attributes.timestamp | int | timestamp_custom(&#39;%H:%M&#39;, False)) }}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">sensor</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">time_date</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">display_options</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">time</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">input_datetime</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sonos_nightmode_start</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Start Night Mode</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">has_date</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">has_time</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initial</span>: <span style="color:#e6db74">&#39;22:30&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sonos_nightmode_end</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">End Night Mode</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">has_date</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">has_time</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initial</span>: <span style="color:#e6db74">&#39;08:00&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">binary_sensor</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sensors</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">den_night_mode</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">friendly_name</span>: <span style="color:#ae81ff">Sonos Den Night Mode</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value_template</span>: &gt;-<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          </span>          {{ <span style="color:#ae81ff">state_attr(&#39;media_player.den&#39;, &#39;night_sound&#39;) }}</span>
</span></span></code></pre></div><p>And, voilà, a dashboard for my speakers, which I pretty much never
need to look at anymore!</p>
<figure><img src="/images/ha-sonos-ui.png"/>
</figure>

<h2 id="but-wait-there-s-more">But Wait, There&rsquo;s More!</h2>
<p>It&rsquo;s a too much to cover in a single blog post, but there&rsquo;s plenty
more going on in my config. Over time, I&rsquo;ve tweaked and added to my
device tracking to make sure Home Assistant knows when someone&rsquo;s home.
I set up some text-to-speech to announce the weather in the morning,
and welcome the first person to get home. I even re-purposed an old
phone as a webcam so I can check on the cat while I&rsquo;m out. My config
is on my personal gitlab server, feel free to check it out and see if
there&rsquo;s anything there you can use or learn from:
<a href="http://git.phoenixinquis.net/correlr/home-assistant">http://git.phoenixinquis.net/correlr/home-assistant</a></p>

    </div>
    <div class="post-footer">
      <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "correl" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </article>

    </main>
  </body>
</html>
