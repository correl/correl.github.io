<!doctype html>
<html lang="en-us">
  <head>
    <title> // Projects and Coding Adventures</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.105.0">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Correl Roush" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://correl.phoenixinquis.net/css/main.min.86d08b4bb3efd338b408a5c3ba02c2f37aa024dbec7f62531aae2f9a7c0aa6da.css" />

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-429788-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Potatoes and Portal Guns
 Got my hands on Portal 2 and finished a run through the single player campaign. Was a lot of fun, the characters were bursting with humor and personality. Just like the first game, it was hard to stop playing. Unlike the first game, it&rsquo;s got some length, so I stayed up late a couple nights with my eyes glued to the television. I already want to play through it again to find any little things I my tired eyes may have missed.
I&rsquo;m itching to give co-op a try, so if you happen to have it on xbox or care to drop by, let me know.
Update: Played some co-op with Jen, had fun navigating puzzles together :)
Meh.php
&lt;?php
if (!defined(&#39;meh&#39;)) define(&#39;meh&#39;, null);

class Meh {
    public function __set($name, $value) {
    }
    public function __get($name) {
        return meh;
    }
    public function __isset($name) {
        return true || false;
    }
    public function __unset($name) {
    }
    public function __call($name, $arguments) {
        return meh;
    }
    public function __callStatic($name, $arguments) {
        return meh;
    }
}

$bwuh = new Meh();
$bwuh-&gt;give_a_shit();
echo $bwuh-&gt;concerns;

class SuperDuperBillingProcessor extends Meh {}

$p = new SuperDuperBillingProcessor();
$p-&gt;calculateEverything();
$p-&gt;profit();
Transmission, RSS, and XBMC
I&rsquo;m a huge fan of XBMC. My pc (currently running Ubuntu 10.04) has taken root in my
living room, piping all my movies and tv shows straight to my HDTV.
While my pc is set up as a DVR using MythTV to record shows off my FIOS box, it tends to be a little unreliable, which can suck when it&rsquo;s time to catch up on Daily Show and Colbert episodes.
I&rsquo;ve had Transmission set up for a while for all my torrenting needs, and
I&rsquo;ve even written an XBMC script to manage torrents, so I got to looking for
tools to track tv show torrent rss feeds."/>

    <meta property="og:title" content="" />
<meta property="og:description" content="Potatoes and Portal Guns
 Got my hands on Portal 2 and finished a run through the single player campaign. Was a lot of fun, the characters were bursting with humor and personality. Just like the first game, it was hard to stop playing. Unlike the first game, it&rsquo;s got some length, so I stayed up late a couple nights with my eyes glued to the television. I already want to play through it again to find any little things I my tired eyes may have missed.
I&rsquo;m itching to give co-op a try, so if you happen to have it on xbox or care to drop by, let me know.
Update: Played some co-op with Jen, had fun navigating puzzles together :)
Meh.php
&lt;?php
if (!defined(&#39;meh&#39;)) define(&#39;meh&#39;, null);

class Meh {
    public function __set($name, $value) {
    }
    public function __get($name) {
        return meh;
    }
    public function __isset($name) {
        return true || false;
    }
    public function __unset($name) {
    }
    public function __call($name, $arguments) {
        return meh;
    }
    public function __callStatic($name, $arguments) {
        return meh;
    }
}

$bwuh = new Meh();
$bwuh-&gt;give_a_shit();
echo $bwuh-&gt;concerns;

class SuperDuperBillingProcessor extends Meh {}

$p = new SuperDuperBillingProcessor();
$p-&gt;calculateEverything();
$p-&gt;profit();
Transmission, RSS, and XBMC
I&rsquo;m a huge fan of XBMC. My pc (currently running Ubuntu 10.04) has taken root in my
living room, piping all my movies and tv shows straight to my HDTV.
While my pc is set up as a DVR using MythTV to record shows off my FIOS box, it tends to be a little unreliable, which can suck when it&rsquo;s time to catch up on Daily Show and Colbert episodes.
I&rsquo;ve had Transmission set up for a while for all my torrenting needs, and
I&rsquo;ve even written an XBMC script to manage torrents, so I got to looking for
tools to track tv show torrent rss feeds." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://correl.phoenixinquis.net/1/01/01.html" /><meta property="article:section" content="blog" />





  </head>
  <body>
    <header class="app-header">
      <a href="https://correl.phoenixinquis.net/"><img class="app-header-avatar" src="/avatar.jpg" alt="Correl Roush" /></a>
      <h1>Correl Roush</h1>
      <p>Transgender ・ MtF ・ Genderfluid ・ She/Her</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://twitter.com/correlr"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <title>twitter</title>
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg></a>
        
          <a target="_blank" href="https://github.com/correl"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
          <a target="_blank" href="https://www.instagram.com/correlroush/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-instagram">
  <title>instagram</title>
  <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.5" y2="6.5"></line>
</svg></a>
        
        <a target="_blank" rel="me" href="https://mastodon.cloud/@correl">
          <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
               width="24" height="24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" class="icon">
            <title>Mastodon</title>
            <path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"/>
          </svg>
        </a>
      </div>
      <p>
          <a href="/files/resume.pdf"> 
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-download">
  <title>download</title>
  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line>
</svg>
              Download Résumé
          </a>
      </p>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title"></h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jan 1, 0001
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          114 min read
        </div></div>
    </header>
    <div class="post-content">
      <h2 id="potatoes-and-portal-guns">Potatoes and Portal Guns</h2>
<p><a href="/images/portal_2_logo.jpg"><img src="/images/portal_2_logo-150x150.jpg" alt="Portal 2 Logo" title="Portal 2 Logo" width="150" height="150" style="float: right" /></a> Got my hands on Portal 2 and finished a run through the single player campaign. Was a <em>lot</em> of fun, the characters were bursting with humor and personality. Just like the first game, it was hard to stop playing. <em>Unlike</em> the first game, it&rsquo;s got some length, so I stayed up late a couple nights with my eyes glued to the television. I already want to play through it again to find any little things I my tired eyes may have missed.</p>
<p>I&rsquo;m itching to give co-op a try, so if you happen to have it on xbox or care to drop by, let me know.</p>
<p><strong>Update:</strong> Played some co-op with Jen, had fun navigating puzzles together :)</p>
<h2 id="meh-php">Meh.php</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">defined</span>(<span style="color:#e6db74">&#39;meh&#39;</span>)) <span style="color:#a6e22e">define</span>(<span style="color:#e6db74">&#39;meh&#39;</span>, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Meh</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __set($name, $value) {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __get($name) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">meh</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __isset($name) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span> <span style="color:#f92672">||</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __unset($name) {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __call($name, $arguments) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">meh</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __callStatic($name, $arguments) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">meh</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$bwuh <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Meh</span>();
</span></span><span style="display:flex;"><span>$bwuh<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">give_a_shit</span>();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> $bwuh<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">concerns</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SuperDuperBillingProcessor</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Meh</span> {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SuperDuperBillingProcessor</span>();
</span></span><span style="display:flex;"><span>$p<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">calculateEverything</span>();
</span></span><span style="display:flex;"><span>$p<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">profit</span>();
</span></span></code></pre></div><h2 id="transmission-rss-and-xbmc">Transmission, RSS, and XBMC</h2>
<p>I&rsquo;m a huge fan of <a href="http://www.xbmc.org/">XBMC</a>. My pc (currently running Ubuntu 10.04) has taken root in my
living room, piping all my movies and tv shows straight to my HDTV.</p>
<p>While my pc is set up as a DVR using <a href="http://www.mythtv.org">MythTV</a> to record shows off my FIOS box, it tends to be a little unreliable, which can suck when it&rsquo;s time to catch up on Daily Show and Colbert episodes.
I&rsquo;ve had <a href="http://www.transmissionbt.com/">Transmission</a> set up for a while for all my torrenting needs, and
I&rsquo;ve even written an <a href="https://github.com/correl/Transmission-XBMC">XBMC script to manage torrents</a>, so I got to looking for
tools to track tv show torrent rss feeds.</p>
<p>My first stop was <a href="http://ted.nu/">TED</a>. TED worked well enough, but would occasionally hang.
Since it&rsquo;s a GUI java app running in the taskbar, it would require me to dig
out my mouse and break out of full screen XBMC to fiddle with it. I eventually
got tired of dealing with TED and went back to prodding Myth.</p>
<p>Recently I&rsquo;ve been itching to reliably watch my shows again, so I checked around
for a simple command-line utility to track rss feeds and download torrents.
Finding none, I loaded up vim and threw together a python script to handle it
all for me.</p>
<p>I also have another, simple script from when I was using TED (or just manually
downloading shows) which looks at completed torrents, compares their names with
the folders in my TV directory, and moves the shows into them for XBMC to see.</p>
<p>A couple cron jobs and a few rss feeds later, and I&rsquo;ve got all my shows
automatically delivered straight to XBMC for my lazy evening viewing pleasure.</p>
<h3 id="trsspy">trss.py</h3>
<p><a href="https://github.com/correl/trss/raw/master/trss.py">Download</a></p>
<pre tabindex="0"><code>Usage:
    trss.py add &lt;rss-url&gt; [&lt;recent-items&gt;]
        Adds an RSS feed to follow
        rss-url:        Full URL to the RSS feed
        recent-items:   (Optional) number of recent items to queue
                        for downloading
    trss.py remove &lt;index&gt;
        Remove an RSS feed
        index:          Numeric index of the feed to remove as
                        reported by the list command
    trss.py list
        Displays a list of followed feeds

    trss.py download
        Fetch all feeds and download new items

    trss.py set [&lt;setting&gt; [&lt;value&gt;]]
        Set or view configuration settings
        Call without any arguments to list all settings and their values
        Call with a setting and no value to see the current value for that setting

        Currently, the only used setting is &#39;download_dir&#39;, which allows you to set
        a directory to store all retrieved torrents, such as a directory your
        torrent application watches for new downloads. If &#39;download_dir&#39; is not set,
        the current directory will be used.
</code></pre><h3 id="transmission-tvpy">transmission-tv.py</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/python</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> transmissionrpc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TV_PATH <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/media/Gaia/Video/TV/&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TVShowCollection</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">def</span> __init__(self, path):
</span></span><span style="display:flex;"><span>		self<span style="color:#f92672">.</span>path <span style="color:#f92672">=</span> path
</span></span><span style="display:flex;"><span>		self<span style="color:#f92672">.</span>shows <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>listdir(path)
</span></span><span style="display:flex;"><span>		self<span style="color:#f92672">.</span>patterns <span style="color:#f92672">=</span> [[s<span style="color:#f92672">.</span>lower()<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39; &#39;</span>, <span style="color:#e6db74">&#39;.?&#39;</span>), s] <span style="color:#66d9ef">for</span> s <span style="color:#f92672">in</span> sorted(self<span style="color:#f92672">.</span>shows, key<span style="color:#f92672">=</span>len, reverse<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)]
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">match</span>(self, filename):
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> pattern, show <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>patterns:
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> re<span style="color:#f92672">.</span>findall(pattern, filename<span style="color:#f92672">.</span>lower()):
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">return</span> show
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">move</span>(self, ids, location):
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;&#34;&#34;Move torrent data to the new location.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>	self<span style="color:#f92672">.</span>_rpc_version_warning(<span style="color:#ae81ff">6</span>)
</span></span><span style="display:flex;"><span>	args <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;location&#39;</span>: location, <span style="color:#e6db74">&#39;move&#39;</span>: <span style="color:#66d9ef">True</span>}
</span></span><span style="display:flex;"><span>	self<span style="color:#f92672">.</span>_request(<span style="color:#e6db74">&#39;torrent-set-location&#39;</span>, args, ids, <span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> float(transmissionrpc<span style="color:#f92672">.</span>__version__) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0.4</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># The move function is not present in versions 0.3 and older</span>
</span></span><span style="display:flex;"><span>	transmissionrpc<span style="color:#f92672">.</span>Client<span style="color:#f92672">.</span>move <span style="color:#f92672">=</span> move
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>collection <span style="color:#f92672">=</span> TVShowCollection(TV_PATH)
</span></span><span style="display:flex;"><span>client <span style="color:#f92672">=</span> transmissionrpc<span style="color:#f92672">.</span>Client()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>torrents <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>info()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, torrent <span style="color:#f92672">in</span> torrents<span style="color:#f92672">.</span>iteritems():
</span></span><span style="display:flex;"><span>	status <span style="color:#f92672">=</span> torrent<span style="color:#f92672">.</span>status
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> status <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;seeding&#39;</span>, <span style="color:#e6db74">&#39;stopped&#39;</span>]:
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>	show <span style="color:#f92672">=</span> collection<span style="color:#f92672">.</span>match(torrent<span style="color:#f92672">.</span>name)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> show <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>	path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{0}{1}</span><span style="color:#e6db74">/&#39;</span><span style="color:#f92672">.</span>format(TV_PATH, show)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> torrent<span style="color:#f92672">.</span>downloadDir<span style="color:#f92672">.</span>startswith(path):
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>	print <span style="color:#e6db74">&#39;Found </span><span style="color:#e6db74">{0}</span><span style="color:#e6db74"> torrent </span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">{1}</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74"> in show </span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">{2}</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">, moving...&#39;</span><span style="color:#f92672">.</span>format(status, torrent<span style="color:#f92672">.</span>name, show)
</span></span><span style="display:flex;"><span>	result <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>move(i, path)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> status <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;seeding&#39;</span>:
</span></span><span style="display:flex;"><span>		print <span style="color:#e6db74">&#39;Re-starting torrent to continue seeding&#39;</span>
</span></span><span style="display:flex;"><span>		client<span style="color:#f92672">.</span>start(i)
</span></span></code></pre></div><h2 id="learning-functional-programming-part-one">Learning Functional Programming, Part One</h2>
<h2 id="part-one-lambdas-in-my-python">Part One: Lambdas? In my Python?</h2>
<p>Over the past few months, I&rsquo;ve decided to take a stab at learning some
functional programming. I&rsquo;d been doing python for a few years (and
completely falling in love with it), and so I&rsquo;d been exposed to a few
functional concepts it offers - primarily higher-order functions and list
comprehensions, both of which allow for very clear, concise and powerful code.
Since that&rsquo;s where I started my journey, that&rsquo;s where my post will begin as
well.</p>
<!--more-->
<h3 id="functions-are-objects-too">Functions are objects, too</h3>
<p>Having graduated to python from PHP and C/C++, perhaps the biggest new thing to
wrap my head around (besides readable code, whitespace-as-syntax,
<a href="http://xkcd.com/353/">programming being fun again</a>, and all that), is that in
python, functions (and classes!) are objects, just like anything else. They
can still be defined in the usual way, but they can also be assigned, passed
as arguments, even modified and replaced like any other value or object in your
program.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">do_a</span>():
</span></span><span style="display:flex;"><span>    print <span style="color:#e6db74">&#34;Doing something&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>do_b <span style="color:#f92672">=</span> do_a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>do_b()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Prints &#34;Doing something&#34;</span>
</span></span></code></pre></div><p>Functions themselves no longer require formal definitions, either, they can be
created <em><a href="http://en.wikipedia.org/wiki/Anonymous_function">anonymously</a></em>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>my_send <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> person, thing: send(person<span style="color:#f92672">.</span>upper(), thing, subject<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Check this out!&#34;</span>)
</span></span><span style="display:flex;"><span>ucase_people <span style="color:#f92672">=</span> map(<span style="color:#66d9ef">lambda</span> name: name<span style="color:#f92672">.</span>upper(), [<span style="color:#e6db74">&#34;Joe&#34;</span>, <span style="color:#e6db74">&#34;Mary&#34;</span>, <span style="color:#e6db74">&#34;Zach&#34;</span>])
</span></span></code></pre></div><h3 id="abstracting-behaviour">Abstracting behaviour</h3>
<p>You&rsquo;ll find you can now start abstracting away common idioms. For
example, you probably very often find yourself looping over some list of items,
performing some set of actions on them, or passing them to some other function
or method:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>people <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;Joe&#34;</span>, <span style="color:#e6db74">&#34;Chris&#34;</span>, <span style="color:#e6db74">&#34;Matt&#34;</span>, <span style="color:#e6db74">&#34;Jennifer&#34;</span>]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> person <span style="color:#f92672">in</span> people:
</span></span><span style="display:flex;"><span>    u_person <span style="color:#f92672">=</span> person<span style="color:#f92672">.</span>upper()
</span></span><span style="display:flex;"><span>    send(person, super_fun_thing)
</span></span></code></pre></div><p>Instead of that, you could have a function that takes a list as one argument,
and a function to apply to each item in it as another:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dostuff</span>(action, things):
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> thing <span style="color:#f92672">in</span> things:
</span></span><span style="display:flex;"><span>        result<span style="color:#f92672">.</span>append(action(thing))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> result
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dostuff(send, people)
</span></span></code></pre></div><p>The above example is actually just a simple definition of one of the most
common higher-order functions,
<a href="http://docs.python.org/library/functions.html#map">map</a>, which python already
provides for you. Another particularly useful higher-order function is
<a href="http://docs.python.org/library/functions.html#filter">filter</a> which, given a
function that returns true of false if its criteria are met by the passed item,
will return the subset of the passed list that satisfy the filtering function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>stuff <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;My notes.txt&#34;</span>, <span style="color:#e6db74">&#34;Matt&#39;s notes.txt&#34;</span>,  <span style="color:#e6db74">&#34;My music.pls&#34;</span>]
</span></span><span style="display:flex;"><span>my_stuff <span style="color:#f92672">=</span> filter(<span style="color:#66d9ef">lambda</span> s: s<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#34;My &#34;</span>), stuff)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># my_stuff = [&#34;My notes.txt&#34;, &#34;My music.pls&#34;]</span>
</span></span></code></pre></div><p><a href="http://docs.python.org/tutorial/datastructures.html#list-comprehensions">List comprehensions</a>
provide a cleaner, easier to read way to perform mapping and/or filtering on a
list:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>stuff <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;My notes.txt&#34;</span>, <span style="color:#e6db74">&#34;Matt&#39;s notes.txt&#34;</span>,  <span style="color:#e6db74">&#34;My music.pls&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>my_stuff <span style="color:#f92672">=</span> [file <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> stuff <span style="color:#66d9ef">if</span> file<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#34;My &#34;</span>)]
</span></span><span style="display:flex;"><span><span style="color:#75715e"># [&#34;My notes.txt&#34;, &#34;My music.pls&#34;]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>upper_stuff <span style="color:#f92672">=</span> [file<span style="color:#f92672">.</span>upper() <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> stuff]
</span></span><span style="display:flex;"><span><span style="color:#75715e"># [&#34;MY NOTES.TXT&#34;, &#34;MATT&#39;S NOTES.TXT&#34;, &#34;MY MUSIC.PLS&#34;]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>music <span style="color:#f92672">=</span> [file<span style="color:#f92672">.</span>upper() <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> stuff <span style="color:#66d9ef">if</span> file<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">&#34;.pls&#34;</span>)]
</span></span><span style="display:flex;"><span><span style="color:#75715e"># [&#34;MY MUSIC.PLS&#34;]</span>
</span></span></code></pre></div><h3 id="tip-of-the-iceberg">Tip of the iceberg</h3>
<p>This is just a very small taste of functional programming concepts. Later, I&rsquo;ll
introduce a couple of functional languages, and explain what sets them apart
from object-oriented and imperative programming languages.</p>
<h2 id="erlang-the-movie">Erlang: The Movie</h2>
<p>Hopping through <a href="http://joearms.github.io/">Joe Armstrong&rsquo;s blog</a>, I happened across Erlang: The Movie.
More programming languages need videos like this.</p>
<iframe width="420" height="315" src="//www.youtube.com/embed/xrIjfIjssLE" frameborder="0" allowfullscreen></iframe>
<h2 id="getting-organized-with-org-mode">Getting Organized with Org Mode</h2>
<img src="/images/org-mode-unicorn-logo.png" alt="Org Mode logo" style="float: right" />
<p>I&rsquo;ve been using Emacs Org mode for nearly a year now. For a while I
mostly just used it to take and organize notes, but over time I&rsquo;ve
discovered it&rsquo;s an incredibly useful tool for managing projects and
tasks, writing and publishing documents, keeping track of time and
todo lists, and maintaining a journal.</p>
<h3 id="project-management">Project Management</h3>
<p>Most of what I&rsquo;ve been using <a href="http://orgmode.org/">Org mode</a> for has been breaking down large
projects at work into tasks and subtasks. It&rsquo;s really easy to enter
projects in as a hierarchy of tasks and task groupings. Using
<a href="http://orgmode.org/worg/org-tutorials/org-column-view-tutorial.html">Column View</a>, I was able to dive right into scoping them individually
and reporting total estimates for each major segment of work.</p>
<figure><img src="/images/emacs-projects.png"
         alt="Example projects org file"/>
</figure>

<p>Because Org Mode makes building and modifying an outline structure
like this so quick and easy, I usually build and modify the project
org document while planning it out with my team. Once done, I then
manually load that information into our issue tracker and get
underway. Occasionally I&rsquo;ll also update tags and progress status in
the org document as well as the project progresses, so I can use the
same document to plan subsequent development iterations.</p>
<h3 id="organizing-notes-and-code-exercises">Organizing Notes and Code Exercises</h3>
<p>More recently, I&rsquo;ve been looking into various ways to get more
things organized with Org mode. I&rsquo;ve been stepping through
<a href="http://sarabander.github.io/sicp/">Structure and Interpretation of Computer Programs</a> with some other
folks from work, and discovered that Org mode was an ideal fit for
keeping my notes and exercise work together. The latter is neatly
managed by <a href="http://orgmode.org/worg/org-contrib/babel/intro.html">Babel</a>, which let me embed and edit source examples and
my excercise solutions right in the org document itself, and even
export them to one or more scheme files to load into my
interpreter.</p>
<h3 id="exporting-and-publishing-documents">Exporting and Publishing Documents</h3>
<p>Publishing my notes with org is also a breeze. I&rsquo;ve published
project plans and proposals to PDF to share with colleagues, and
exported my <a href="https://github.com/correl/sicp">SICP notes</a> to html and <a href="http://sicp.phoenixinquis.net/">dropped them into a site</a> built
with <a href="http://jekyllrb.com/">Jekyll</a>. Embedding graphs and diagrams into exported documents
using <a href="http://www.graphviz.org/">Graphviz</a>, <a href="http://www.mcternan.me.uk/mscgen/">Mscgen</a>, and <a href="http://plantuml.sourceforge.net/">PlantUML</a> has also really helped with
putting together some great project plans and documentation. A lot of
great examples using those tools (and more!) can be found <a href="http://home.fnal.gov/~neilsen/notebook/orgExamples/org-examples.html">here</a>.</p>
<h3 id="emacs-configuration">Emacs Configuration</h3>
<p>While learning all the cool things I could do with Org mode and Babel,
it was only natural I&rsquo;d end up using it to reorganize my <a href="https://github.com/correl/dotfiles/tree/master/.emacs.d">Emacs
configuration</a>. Up until that point, I&rsquo;d been managing my configuration
in a single init.el file, plus a directory full of mode or
purpose-specific elisp files that I&rsquo;d loop through and load. Inspired
primarily by the blog post, <a href="http://zeekat.nl/articles/making-emacs-work-for-me.html">&ldquo;Making Emacs Work For Me&rdquo;</a>, and later by
others such as <a href="http://pages.sachachua.com/.emacs.d/Sacha.html">Sacha Chua&rsquo;s Emacs configuration</a>, I got all my configs
neatly organized into a single org file that gets loaded on
startup. I&rsquo;ve found it makes it far easier to keep track of what I&rsquo;ve
got configured, and gives me a reason to document and organize things
neatly now that it&rsquo;s living a double life as a <a href="https://github.com/correl/dotfiles/blob/master/.emacs.d/emacs.org">published document</a> on
GitHub. I&rsquo;ve still got a directory lying around with autoloaded
scripts, but now it&rsquo;s simply reserved for <a href="https://github.com/correl/dotfiles/blob/master/.emacs.d/emacs.org#auto-loading-elisp-files">tinkering and sensitive
configuration</a>.</p>
<h3 id="tracking-habits">Tracking Habits</h3>
<p>Another great feature of Org mode that I&rsquo;ve been taking advantage
of a lot more lately is the <a href="http://orgmode.org/manual/Agenda-Views.html">Agenda</a>. By defining some org files as
being agenda files, Org mode can examine these files for TODO
entries, scheduled tasks, deadlines and more to build out useful
agenda views to get a quick handle on what needs to be done and
when. While at first I started by simply syncing down my google
calendars as org-files (using <a href="http://orgmode.org/worg/code/awk/ical2org.awk">ical2org.awk</a>), I&rsquo;ve started
managing TODO lists in a dedicated org file. By adding tasks to
this file, scheduling them, and setting deadlines, I&rsquo;ve been doing
a much better job of keeping track of things I need to get done
and (even more importantly) <em>when</em> I need to get them done.</p>
<figure><img src="/images/emacs-org-agenda.png"
         alt="Agenda view snippet"/>
</figure>

<p>This works not only for one-shot tasks, but also <a href="http://orgmode.org/manual/Tracking-your-habits.html">habits and other
repetitive tasks</a>. It&rsquo;s possible to schedule a task that should be
done every day, every few days, or maybe every first sunday of a
month. For example, I&rsquo;ve set up repeating tasks to write a blog
post at least once a month, practice guitar every two to three
days, and to do the dishes every one or two days. The agenda view
can even show a small, colorized graph next to each repeating task
that paints a picture of how well (or not!) I&rsquo;ve been getting
those tasks done on time.</p>
<h3 id="keeping-a-journal-and-tracking-work">Keeping a Journal and Tracking Work</h3>
<p>The last thing I&rsquo;ve been using (which I&rsquo;m still getting a handle
on) is using <a href="http://orgmode.org/manual/Capture.html">Capture</a> to take and store notes, keep a journal, and
even <a href="http://orgmode.org/manual/Clocking-work-time.html">track time on tasks at work</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(setq org-capture-templates
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#39;</span>((<span style="color:#e6db74">&#34;j&#34;</span> <span style="color:#e6db74">&#34;Journal Entry&#34;</span> plain
</span></span><span style="display:flex;"><span>         (file+datetree <span style="color:#e6db74">&#34;~/org/journal.org&#34;</span>)
</span></span><span style="display:flex;"><span>         <span style="color:#e6db74">&#34;%U\n\n%?&#34;</span> :empty-lines-before <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        (<span style="color:#e6db74">&#34;w&#34;</span> <span style="color:#e6db74">&#34;Log Work Task&#34;</span> entry
</span></span><span style="display:flex;"><span>         (file+datetree <span style="color:#e6db74">&#34;~/org/worklog.org&#34;</span>)
</span></span><span style="display:flex;"><span>         <span style="color:#e6db74">&#34;* TODO %^{Description}  %^g\n%?\n\nAdded: %U&#34;</span>
</span></span><span style="display:flex;"><span>         :clock-in <span style="color:#66d9ef">t</span>
</span></span><span style="display:flex;"><span>         :clock-keep <span style="color:#66d9ef">t</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(global-set-key (kbd <span style="color:#e6db74">&#34;C-c c&#34;</span>) <span style="color:#e6db74">&#39;org-capture</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(setq org-clock-persist <span style="color:#e6db74">&#39;history</span>)
</span></span><span style="display:flex;"><span>(org-clock-persistence-insinuate)
</span></span></code></pre></div><p>For my journal, I&rsquo;ve configured a capture template that I can use
to write down a new entry that will be stored with a time stamp
appended into its own org file, organized under headlines by year,
month and date.</p>
<p>For work tasks, I have another capture template configured that
will log and tag a task into another org file, also organized by
date, which will automatically start tracking time for that
task. Once done, I can simply clock out and check the time I&rsquo;ve
spent, and can easily find it later to clock in again, add notes,
or update its status. This helps me keep track of what I&rsquo;ve gotten
done during the day, keep notes on what I was doing at any point
in time, and get a better idea of how long it takes me to do
different types of tasks.</p>
<h3 id="conclusion">Conclusion</h3>
<p>There&rsquo;s a lot that can be done with Org mode, and I&rsquo;ve only just
scratched the surface. The simple outline format provided by Org mode
lends itself to doing all sorts of things, be it organizing notes,
keeping a private or work journal, or writing a book or technical
document. I&rsquo;ve even written this blog post in Org mode! There&rsquo;s tons
of functionality that can be built on top of it, yet the underlying
format itself remains simple and easy to work with. I&rsquo;ve never been
great at keeping myself organized, but Org mode is such a delight to
use that I can&rsquo;t help trying anyway. If it can work for me, maybe it
can work for you, too!</p>
<p>There&rsquo;s tons of resources for finding new ways for using Org mode, and
I&rsquo;m still discovering cool things I can track and integrate with it. I
definitely recommend reading through <a href="http://sachachua.com/blog/">Sacha Chua&rsquo;s Blog</a>, as well as
posts from <a href="http://newartisans.com/2007/08/using-org-mode-as-a-day-planner/">John Wiegley</a>. I&rsquo;m always looking for more stuff to try
out. Feel free to drop me a line if you find or are using something
you think is cool or useful!</p>
<h2 id="sicp">Adventuring Through SICP</h2>
<p>Back in May, a coworker and I got the idea to start up a little
seminar after work every couple of weeks with the plan to set aside
some time to learn and discuss new ideas together, along with anyone
else who cared to join us.</p>
<h3 id="learning-together">Learning Together</h3>
<p>Over the past several months, we&rsquo;ve read our way through the first
three chapters of the book, watched the <a href="http://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-001-structure-and-interpretation-of-computer-programs-spring-2005/video-lectures/">related video lectures</a>, and
did (most of) the exercises.</p>
<p>Aside from being a great excuse to unwind with friends after work
(which it is!), it&rsquo;s proved to be a great way to get through the
material. Doing a section of a chapter every couple of weeks is an
easy goal to meet, and meeting up to discuss it becomes something to
look forward to. We all get to enjoy a sense of accomplishment in
learning stuff that can be daunting or difficult to set aside time for
alone.</p>
<p>The best part, by far, is getting different perspectives on the
material. Most of my learning tends to be solitary, so it&rsquo;s refreshing
to do it with a group. By reviewing the different concepts together,
we&rsquo;re able to gain insights and clarity we&rsquo;d never manage on our
own. Even the simplest topics can spur interesting conversations.</p>
<h3 id="sicp">SICP</h3>
<p>Our first adventure together so far has been the venerable <a href="http://mitpress.mit.edu/sicp/">Structure
and Interpretation of Computer Programs</a>. This book had been on my todo
list for a long time, but never quite bubbled to the top. I&rsquo;m glad to
have the opportunity to go through it in this format, since there&rsquo;s
plenty of time to let really get into the excercises and let the
lessons sink in.</p>
<p>SICP was originally an introductory textbook for MIT computer
programming courses. What sets it apart from most, though, is that it
doesn&rsquo;t focus so much on learning a particular programming language
(while the book does use and cover MIT Scheme) as it does on
identifying and abstracting out patterns common to most programming
problems. Because of that, the book is every bit as useful and
illuminating as ever, especially now that functional paradigms are
re-entering the spotlight and means of abstracting and composing
systems are as important as ever.</p>
<h3 id="what-s-next">What&rsquo;s next?</h3>
<p>We&rsquo;ve still got plenty of SICP left to get through. We&rsquo;ve only just
gotten through Chapter 4, section 1, which has us building a scheme
interpreter <strong>in</strong> scheme, so there&rsquo;s plenty of fun left to be had
there.</p>
<p>We&rsquo;re also staring to do some smaller, lunchtime review meetings
following the evening discussions to catch up the folks that can&rsquo;t
make it. I may also try sneaking in some smaller material, like
interesting blog posts, to keep things lively.</p>
<hr>
<p>If anyone&rsquo;s interested, I have the exercise work along with some notes
taken during the meetings <a href="http://sicp.phoenixinquis.net/">hosted online</a>. I apologize for the lack of
notes early on, I&rsquo;ve been trying to get better at capturing memorable
excerpts and conversation topics recently. I may have to put some more
posts together later on summarizing what we discussed for each
chapter; if and when I do, they&rsquo;ll be posted on the <a href="http://extreme-tech-seminar.github.io/">seminar website</a>.</p>
<h2 id="coders-at-work">Coders at Work</h2>
<p>A few days before leaving work for a week and a half of flying and
cruising to escape frigid Pennsylvania, I came across a <a href="#org-target--armstrong-oop">Joe Armstrong
quote</a> during my regularly scheduled slacking off on twitter and Hacker
News. I&rsquo;d come across a couple times before, only this time I noticed
it had a source link. This led me to discovering (and shortly
thereafter, buying) Peter Seibel&rsquo;s &ldquo;<a href="http://www.codersatwork.com/">Coders at Work &ndash; Reflections on
the Craft of Programming</a>&rdquo;. I loaded it onto my nook, and off I went.</p>
<p>The book is essentially a collection of interviews with a series of
highly accomplished software developers. Each of them has their own
fascinating insights into the craft and its rich history.</p>
<p>While making my way through the book, I highlighted some excerpts
that, for one reason or another, resonated with me. I&rsquo;ve organized and
elaborated on them below.</p>
<h3 id="incremental-changes">Incremental Changes</h3>
<p><span class="org-target" id="org-target--fitzpatrick-increments"></span></p>
<blockquote>
<p>I&rsquo;ve seen young programmers say, &ldquo;Oh, shit, it doesn&rsquo;t work,&rdquo; and then
rewrite it all. Stop. Try to figure out what&rsquo;s going on. <strong>Learn how to
write things incrementally so that at each stage you could verify it.</strong><br />
&ndash; Brad Fitzpatrick</p>
</blockquote>
<p>I can remember doing this to myself when I was still relatively new to
coding (and even worse, before I discovered source control!). Some
subroutine or other would be misbehaving, and rather than picking it
apart and figuring out what it was I&rsquo;d done wrong, I&rsquo;d just blow it
away and attempt to write it fresh. While I <em>might</em> be successful,
that likely depended on the issue being some sort of typo or missed
logic; if it was broken because I misunderstood something or had a bad
plan to begin with, rewriting it would only result in more broken
code, sometimes in more or different ways than before. I don&rsquo;t think
I&rsquo;ve ever rewritten someone else&rsquo;s code without first at least getting
a firm understanding of it and what it was trying to accomplish, but
even then, breaking down changes piece by piece makes it all the
easier to maintain sanity.</p>
<p>I do still sometimes catch myself doing too much at once when building
a new feature or fixing a bug. I may have to fix a separate bug that&rsquo;s
in my way, or I may have to make several different changes in various
parts of the code. If I&rsquo;m not careful, things can get out of hand
pretty quickly, and before I know it I have a blob of changes strewn
across the codebase in my working directory without a clear picture of
what&rsquo;s what. If something goes wrong, it can be pretty tough to sort
out which change broke things (or fixed them). Committing changes
often helps tremendously to avoid this sort of situation, and when I
catch myself going off the rails I try to find a stopping point and
split changes up into commits as soon as possible to regain
control. Related changes and fixes can always be squashed together
afterwards to keep things tidy.</p>
<h3 id="specifications-and-documentation">Specifications &amp; Documentation</h3>
<p><span class="org-target" id="org-target--bloch-customers"></span></p>
<blockquote>
<p><strong>Many customers won&rsquo;t tell you a problem; they&rsquo;ll tell you a
solution.</strong> A customer might say, for instance, &ldquo;I need you to add
support for the following 17 attributes to this system. Then you have
to ask, &lsquo;Why? What are you going to do with the system? How do you
expect it to evolve?&rsquo;&rdquo; And so on. You go back and forth until you
figure out what all the customer really needs the software to
do. These are the use cases.<br />
&ndash; Joshua Bloch</p>
</blockquote>
<p>Whether your customer is your customer, or your CEO, the point stands:
customers are <em>really bad</em> at expressing what they want. It&rsquo;s hard to
blame them, though; analyzing what you really want and distilling it
into a clear specification is tough work. If your customer is your
boss, it can be intimidating to push back with questions like &ldquo;Why?&rdquo;,
but if you can get those questions answered you&rsquo;ll end up with a
better product, a better <em>understanding</em> of the product, and a happy
customer. The agile process of doing quick iterations to get tangible
results in front of them is a great way of getting the feedback and
answers you need.</p>
<p><span class="org-target" id="org-target--armstrong-documentation"></span></p>
<blockquote>
<p>The code shows me what it <em>does</em>. It doesn&rsquo;t show me what it&rsquo;s
supposed to do. I think the code is the answer to a problem.
<strong>If you don&rsquo;t have the spec or you don&rsquo;t have any documentation, you have to guess what the problem is from the answer. You might guess wrong.</strong><br />
&ndash; Joe Armstrong</p>
</blockquote>
<p>Once you&rsquo;ve got the definition of what you&rsquo;ve got to build and how
it&rsquo;s got to work, it&rsquo;s extremely important that you get it
documented. Too often, I&rsquo;m faced with code that&rsquo;s doing something in
some way that somebody, either a customer or a developer reading it,
takes issue with, and there&rsquo;s no documentation anywhere on why it&rsquo;s
doing what it&rsquo;s doing. What happens next is anybody&rsquo;s guess. Code
that&rsquo;s clear and conveys its intent is a good start towards avoiding
this sort of situation. Comments explaining intent help too, though
making sure they&rsquo;re kept up to date with the code can be
challenging. At the very least, I try to promote useful commit
messages explaining what the purpose of a change is, and reference a
ticket in our issue tracker which (hopefully) has a clear accounting
of the feature or bugfix that prompted it.</p>
<h3 id="pair-programming">Pair Programming</h3>
<p><span class="org-target" id="org-target--armstrong-pairing"></span></p>
<blockquote>
<p>&hellip; <strong>if you don&rsquo;t know what you&rsquo;re doing then I think it can be very
helpful with someone who also doesn&rsquo;t know what they&rsquo;re doing.</strong> If you
have one programmer who&rsquo;s better than the other one, then there&rsquo;s
probably benefit for the weaker programmer or the less-experienced
programmer to observe the other one. They&rsquo;re going to learn something
from that. But if the gap&rsquo;s too great then they won&rsquo;t learn, they&rsquo;ll
just sit there feeling stupid.<br />
&ndash; Joe Armstrong</p>
</blockquote>
<p>Pairing isn&rsquo;t something I do much. At least, it&rsquo;s pretty rare that I
have someone sitting next to me as I code. I <strong>do</strong> involve peers while
I&rsquo;m figuring out what I want to build as often as I can. The tougher
the problem, the more important it is, I think, to get as much
feedback and brainstorming in as possible. This way, everybody gets to
tackle the problem and learn together, and anyone&rsquo;s input, however
small it might seem, can be the key to the &ldquo;a-ha&rdquo; moment to figuring
out a solution.</p>
<h3 id="peer-review">Peer Review</h3>
<p><span class="org-target" id="org-target--crockford-reading"></span></p>
<blockquote>
<p><strong>I think an hour of code reading is worth two weeks of QA.</strong> It&rsquo;s just
a really effective way of removing errors. If you have someone who is
strong reading, then the novices around them are going to learn a lot
that they wouldn&rsquo;t be learning otherwise, and if you have a novice
reading, he&rsquo;s going to get a lot of really good advice.<br />
&ndash; Douglas Crockford</p>
</blockquote>
<p>Just as important as designing the software as a team, I think, is
reviewing it as a team. In doing so, each member of the team has an
opportunity to understand <em>how</em> the system has been implemented, and
to offer their suggestions and constructive criticisms. This helps the
team grow together, and results in a higher quality of code overall.
This benefits QA as well as the developers themselves for the next
time they find themselves in that particular bit of the system.</p>
<h3 id="object-oriented-programming">Object-Oriented Programming</h3>
<p><span class="org-target" id="org-target--armstrong-oop"></span></p>
<blockquote>
<p>I think the lack of reusability comes in object-oriented languages,
not in functional languages.
<strong>Because the problem with object-oriented languages is they&rsquo;ve got all this implicit environment that they carry around with them. You wanted a banana but what you got was a gorilla holding the banana and the entire jungle.</strong><br />
&ndash; Joe Armstrong</p>
</blockquote>
<p>A lot has been written on why OOP isn&rsquo;t the great thing it claims to
be, or was ever intended to be. Having grappled with it myself for
years, attempting to find ways to keep my code clean, concise and
extensible, I&rsquo;ve more or less come to the same conclusion as Armstrong
in that coupling data structures with behaviour makes for a terrible
mess. Dividing the two led to a sort of moment of clarity; there was
no more confusion about what methods belong on what object. There was
simply the data, and the methods that act on it. I am still struggling
a bit, though, on how to bring this mindset to the PHP I maintain at
work. The language seems particularly ill-suited to managing complex
data structures (or even simple ones &ndash; vectors and hashes are
bizarrely intertwined).</p>
<h3 id="writing">Writing</h3>
<p><span class="org-target" id="org-target--bloch-writing"></span></p>
<blockquote>
<p>You should read <em>[Elements of Style]</em> for two reasons: The first is
that a large part of every software engineer&rsquo;s job is writing
prose. <strong>If you can&rsquo;t write precise, coherent, readable specs, nobody
is going to be able to use your stuff.</strong> So anything that improves your
prose style is good. The second reason is that most of the ideas in
that book are also applicable to programs.<br />
&ndash; Joshua Bloch</p>
</blockquote>
<p><span class="org-target" id="org-target--crockford-writing"></span></p>
<blockquote>
<p><strong>My advice to everybody is pretty much the same, to read and write.</strong><br />
&hellip;<br />
Are you a good Java programmer, a good C programmer, or whatever? I
don&rsquo;t care. I just want to know that you know how to put an algorithm
together, you understand data structures, and you know how to document
it.<br />
&ndash; Douglas Crockford</p>
</blockquote>
<p><span class="org-target" id="org-target--knuth-writing"></span></p>
<blockquote>
<p>This is what literate programming is so great for &ndash;<br />
<strong>I can talk to myself. I can read my program a year later and know
exactly what I was thinking.</strong><br />
&ndash; Donald Knuth</p>
</blockquote>
<p>The more I&rsquo;ve program professionally, the clearer it is that writing
(and communication in general) is a very important skill to
develop. Whether it be writing documentation, putting together a
project plan, or whiteboarding and discussing something, clear and
concise communication skills are a must. Clarity in writing translates
into clarity in coding as well, in my opinion. Code that is short, to
the point, clear in its intention, making good use of structure and
wording (in the form of function and variable names) is far easier to
read and reason about than code that is disorganized and obtuse.</p>
<h3 id="knuth">Knuth</h3>
<p><span class="org-target" id="org-target--crockford-knuth"></span></p>
<blockquote>
<p>I tried to make familiarity with Knuth a hiring criteria, and I was
disappointed that I couldn&rsquo;t find enough people that had read him. In
my view,
<strong>anybody who calls himself a professional programmer should have read
Knuth&rsquo;s books or at least should have copies of his books.</strong><br />
&ndash; Douglas Crockford</p>
</blockquote>
<p><span class="org-target" id="org-target--steele-knuth"></span></p>
<blockquote>
<p>&hellip; Knuth is really good at telling a story about code. When you read
your way through <em>The Art of Computer Programming</em> and you read your
way through an algorithm, he&rsquo;s explained it to you and showed you some
applications and given you some exercises to work, and <strong>you feel like
you&rsquo;ve been led on a worthwhile journey.</strong><br />
&ndash; Guy Steele</p>
</blockquote>
<p><span class="org-target" id="org-target--norvig-knuth"></span></p>
<blockquote>
<p>At one point I had <em>[The Art of Computer Programming]</em> as my monitor
stand because it was one of the biggest set of books I had, and it was
just the right height. That was nice because it was always there, and
I guess then I was more prone to use it as a reference because it was
right in front of me.<br />
&ndash; Peter Norvig</p>
</blockquote>
<p>I haven&rsquo;t read any of Knuth&rsquo;s books yet, which is something I&rsquo;ll have
to rectify soon. I don&rsquo;t think I have the mathematical background
necessary to get through some of his stuff, but I expect it will be
rewarding nonetheless. I&rsquo;m also intrigued by his concept of literate
programming, and I&rsquo;m curious to learn more about TeX. I imagine I&rsquo;ll
be skimming through <a href="http://brokestream.com/tex-web.html">TeX: The Program</a> pretty soon now that I&rsquo;ve
finished Coders at Work :)</p>
<h2 id="birthday-puzzle">Birthday Puzzle</h2>
<p>This logic puzzle has been floating around the internet lately. When I
caught wind of it, I thought it would be a great exercise to tackle
using Prolog. I&rsquo;m not especially good with the language yet, so it
added to the challenge a bit, but it was a pretty worthwhile
undertaking. When I got stumped, I discovered that mapping out the
birthdays into a grid helped me visualize the problem and ultimately
solve it, so I&rsquo;ve included that with my prolog code so you can see how
I arrived at the answer.</p>
<h3 id="the-puzzle">The Puzzle</h3>
<p>Albert and Bernard have just met Cheryl. “When is your birthday?”
Albert asked Cheryl. Cheryl thought for a moment and said, “I won’t
tell you, but I’ll give you some clues”. She wrote down a list of
ten dates:</p>
<ul>
<li>May 15, May 16, May 19</li>
<li>June 17, June 18</li>
<li>July 14, July 16</li>
<li>August 14, August 15, August 17</li>
</ul>
<p>“One of these is my birthday,” she said.</p>
<p>Cheryl whispered in Albert’s ear the month, and only the month, of
her birthday. To Bernard, she whispered the day, and only the
day. “Can you figure it out now?” she asked Albert.</p>
<p>Albert: “I don’t know when your birthday is, but I know Bernard
doesn’t know, either.”</p>
<p>Bernard: “I didn’t know originally, but now I do.”</p>
<p>Albert: “Well, now I know, too!”</p>
<p><em>When is Cheryl’s birthday?</em></p>
<h3 id="the-solution">The Solution</h3>
<h4 id="the-dates">The Dates</h4>
<p>To start off, i entered each of the possible birthdays as facts:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-prolog" data-lang="prolog"><span style="display:flex;"><span><span style="color:#a6e22e">possible_birthday</span>(<span style="color:#e6db74">may</span>, <span style="color:#ae81ff">15</span>).
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">possible_birthday</span>(<span style="color:#e6db74">may</span>, <span style="color:#ae81ff">16</span>).
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">possible_birthday</span>(<span style="color:#e6db74">may</span>, <span style="color:#ae81ff">19</span>).
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">possible_birthday</span>(<span style="color:#e6db74">june</span>, <span style="color:#ae81ff">17</span>).
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">possible_birthday</span>(<span style="color:#e6db74">june</span>, <span style="color:#ae81ff">18</span>).
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">possible_birthday</span>(<span style="color:#e6db74">july</span>, <span style="color:#ae81ff">14</span>).
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">possible_birthday</span>(<span style="color:#e6db74">july</span>, <span style="color:#ae81ff">16</span>).
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">possible_birthday</span>(<span style="color:#e6db74">august</span>, <span style="color:#ae81ff">14</span>).
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">possible_birthday</span>(<span style="color:#e6db74">august</span>, <span style="color:#ae81ff">15</span>).
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">possible_birthday</span>(<span style="color:#e6db74">august</span>, <span style="color:#ae81ff">17</span>).
</span></span></code></pre></div><p>And here they are, mapped out in a grid:</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:center">May</th>
<th style="text-align:center">June</th>
<th style="text-align:center">July</th>
<th style="text-align:center">August</th>
</tr>
</thead>
<tbody>
<tr>
<td>14</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
</tr>
<tr>
<td>15</td>
<td style="text-align:center">X</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">X</td>
</tr>
<tr>
<td>16</td>
<td style="text-align:center">X</td>
<td style="text-align:center"></td>
<td style="text-align:center">X</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>17</td>
<td style="text-align:center"></td>
<td style="text-align:center">X</td>
<td style="text-align:center"></td>
<td style="text-align:center">X</td>
</tr>
<tr>
<td>18</td>
<td style="text-align:center"></td>
<td style="text-align:center">X</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>19</td>
<td style="text-align:center">X</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<h4 id="albert-s-statement">Albert&rsquo;s Statement</h4>
<blockquote>
<p>I don’t know when your birthday is,&hellip;</p>
</blockquote>
<p>Albert only knows the month, and the month isn&rsquo;t enough to uniquely
identify Cheryl&rsquo;s birthday.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-prolog" data-lang="prolog"><span style="display:flex;"><span><span style="color:#a6e22e">month_is_not_unique</span>(M) :-
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">bagof</span>(D, <span style="color:#a6e22e">possible_birthday</span>(M, D), Days),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">length</span>(Days, Len),
</span></span><span style="display:flex;"><span>    Len <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1.</span>
</span></span></code></pre></div><blockquote>
<p>&hellip; but I know Bernard doesn’t know, either.</p>
</blockquote>
<p>Albert knows that Bernard doesn&rsquo;t know Cheryl&rsquo;s
birthday. Therefore, the day alone isn&rsquo;t enough to know Cheryl&rsquo;s
birthday, and we can infer that the month of Cheryl&rsquo;s birthday does
not include any of the unique dates.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-prolog" data-lang="prolog"><span style="display:flex;"><span><span style="color:#a6e22e">day_is_not_unique</span>(D) :-
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">bagof</span>(M, <span style="color:#a6e22e">possible_birthday</span>(M, D), Months),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">length</span>(Months, Len),
</span></span><span style="display:flex;"><span>    Len <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">month_has_no_unique_days</span>(M) :-
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">forall</span>(<span style="color:#a6e22e">possible_birthday</span>(M,D),
</span></span><span style="display:flex;"><span>           <span style="color:#a6e22e">day_is_not_unique</span>(D)).
</span></span></code></pre></div><p>Based on what Albert knows at this point, let&rsquo;s see how we&rsquo;ve
reduced the possible dates:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-prolog" data-lang="prolog"><span style="display:flex;"><span><span style="color:#a6e22e">part_one</span>(M,D) :-
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">possible_birthday</span>(M,D),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">month_is_not_unique</span>(M),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">month_has_no_unique_days</span>(M),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">day_is_not_unique</span>(D).
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Results = [ (july, 14), (july, 16), (august, 14), (august, 15), (august, 17)].
</span></span></code></pre></div><p>So the unique days (the 18th and 19th) are out, as are the months
that contained them (May and June).</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:center">July</th>
<th style="text-align:center">August</th>
</tr>
</thead>
<tbody>
<tr>
<td>14</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
</tr>
<tr>
<td>15</td>
<td style="text-align:center"></td>
<td style="text-align:center">X</td>
</tr>
<tr>
<td>16</td>
<td style="text-align:center">X</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>17</td>
<td style="text-align:center"></td>
<td style="text-align:center">X</td>
</tr>
</tbody>
</table>
<h4 id="bernard-s-statement">Bernard&rsquo;s Statement</h4>
<blockquote>
<p>I didn’t know originally, but now I do.</p>
</blockquote>
<p>For Bernard to know Cheryl&rsquo;s birthday, the day he knows must be
unique within the constraints we have so far.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-prolog" data-lang="prolog"><span style="display:flex;"><span><span style="color:#a6e22e">day_is_unique</span>(Month, Day) :-
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">findall</span>(M, <span style="color:#a6e22e">part_one</span>(M, Day), [Month]).
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">part_two</span>(Month, Day) :-
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">possible_birthday</span>(Month, Day),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">day_is_unique</span>(Month, Day).
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Results = [ (july, 16), (august, 15), (august, 17)].
</span></span></code></pre></div><p>Both July and August contain the 14th, so that row is out.</p>
<table>
<thead>
<tr>
<th></th>
<th>July</th>
<th>August</th>
</tr>
</thead>
<tbody>
<tr>
<td>15</td>
<td></td>
<td>X</td>
</tr>
<tr>
<td>16</td>
<td>X</td>
<td></td>
</tr>
<tr>
<td>17</td>
<td></td>
<td>X</td>
</tr>
</tbody>
</table>
<h4 id="albert-s-second-statement">Albert&rsquo;s Second Statement</h4>
<blockquote>
<p>Well, now I know, too!</p>
</blockquote>
<p>Albert&rsquo;s month must be the remaining unique month:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-prolog" data-lang="prolog"><span style="display:flex;"><span><span style="color:#a6e22e">month_is_not_unique</span>(Month, Day) :-
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">findall</span>(D, <span style="color:#a6e22e">part_two</span>(Month, D), [Day]).
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">part_three</span>(Month, Day) :-
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">possible_birthday</span>(Month, Day),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">month_is_not_unique</span>(Month, Day).
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Results = [ (july, 16)].
</span></span></code></pre></div><p>August had two possible days, so it&rsquo;s now clear that the only
possible unique answer is July 16th.</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:center">July</th>
</tr>
</thead>
<tbody>
<tr>
<td>15</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>16</td>
<td style="text-align:center">X</td>
</tr>
<tr>
<td>17</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<h4 id="cheryl-s-birthday">Cheryl&rsquo;s Birthday</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-prolog" data-lang="prolog"><span style="display:flex;"><span><span style="color:#a6e22e">cheryls_birthday</span>(Month, Day) :-
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">part_three</span>(Month, Day).
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Month = july,
</span></span><span style="display:flex;"><span>Day = 16.
</span></span></code></pre></div><p>So, there we have it. Cheryl&rsquo;s birthday is July 16th!</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:center">July</th>
</tr>
</thead>
<tbody>
<tr>
<td>16</td>
<td style="text-align:center">X</td>
</tr>
</tbody>
</table>
<h2 id="syncing">Keeping Files And Configuration In Sync</h2>
<p>I have a few computers I use on a daily basis, and I like to keep the
same emacs and shell configuration on all of them, along with my org
files and a handful of scripts. Since I&rsquo;m sure other people have this
problem as well, I&rsquo;ll share what I&rsquo;m doing so anyone can learn from
(or criticise) my solutions.</p>
<h3 id="git-for-configuration-and-projects">Git for configuration and projects</h3>
<p>I&rsquo;m a software developer, so keeping things in git just makes sense
to me. I keep my org files in a privately hosted git repository, and
<a href="https://www.gnu.org/software/emacs/">Emacs</a> and <a href="http://www.zsh.org/">Zsh</a> configurations in a <a href="https://github.com/correl/dotfiles">public repo on github</a>. My blog is
also hosted and published on github as well; I like having it cloned
to all my machines so I can work on drafts wherever I may be.</p>
<p>My <a href="https://github.com/correl/dotfiles/blob/master/.zshrc">.zshrc</a> installs <a href="https://github.com/robbyrussell/oh-my-zsh">oh-my-zsh</a> if it isn&rsquo;t installed already, and sets
up my shell theme, path, and some other environmental things.</p>
<p>My <a href="https://github.com/correl/dotfiles/blob/master/.emacs.d/emacs.org">Emacs configuration</a> behaves similarly, making use of John
Wiegley&rsquo;s excellent <a href="https://github.com/jwiegley/use-package">use-package</a> tool to ensure all my packages are
installed if they&rsquo;re not already there and configured the way I like
them.</p>
<p>All I have to do to get running on a new system is to install git,
emacs and zsh, clone my repo, symlink the files, and grab a cup of
tea while everything installs.</p>
<h3 id="bittorrent-sync-for-personal-settings-and-books">Bittorrent sync for personal settings &amp; books</h3>
<p>For personal configuration that doesn&rsquo;t belong in and/or is too
sensitive to be in a public repo, I have a folder of dotfiles and
things that I sync between my machines using <a href="https://www.getsync.com/">Bittorrent Sync</a>. The
dotfiles are arranged into directories by their purpose:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[correlr@reason:~/dotenv]
</span></span><span style="display:flex;"><span>% tree -a -L 2
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── authinfo
</span></span><span style="display:flex;"><span>│   └── .authinfo.gpg
</span></span><span style="display:flex;"><span>├── bin
</span></span><span style="display:flex;"><span>│   └── .bin
</span></span><span style="display:flex;"><span>├── emacs
</span></span><span style="display:flex;"><span>│   ├── .bbdb
</span></span><span style="display:flex;"><span>│   └── .emacs.local.d
</span></span><span style="display:flex;"><span>├── mail
</span></span><span style="display:flex;"><span>│   ├── .gnus.el
</span></span><span style="display:flex;"><span>│   ├── .signature
</span></span><span style="display:flex;"><span>├── README.org
</span></span><span style="display:flex;"><span>├── .sync
</span></span><span style="display:flex;"><span>│   ├── Archive
</span></span><span style="display:flex;"><span>│   ├── ID
</span></span><span style="display:flex;"><span>│   ├── IgnoreList
</span></span><span style="display:flex;"><span>│   └── StreamsList
</span></span><span style="display:flex;"><span>├── tex
</span></span><span style="display:flex;"><span>│   └── texmf
</span></span><span style="display:flex;"><span>├── xmonad
</span></span><span style="display:flex;"><span>│   └── .xmonad
</span></span><span style="display:flex;"><span>└── zsh
</span></span><span style="display:flex;"><span>    └── .zshenv
</span></span></code></pre></div><p>This folder structure allows my configs to be easily installed using
<a href="https://www.gnu.org/software/stow/">GNU Stow</a> from my <code>dotenv</code> folder:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>stow -vvS *
</span></span></code></pre></div><p>Running that command will, for each file in each of the directories,
create a symlink to it in my home folder if there isn&rsquo;t a file or
directory with that name there already.</p>
<p>Bittorrent sync also comes in handy for syncing my growing <a href="http://calibre-ebook.com/">Calibre</a> ebook
collection, which outgrew my <a href="https://www.dropbox.com/">Dropbox</a> account a while back.</p>
<h2 id="git-graphs">Drawing Git Graphs with Graphviz and Org-Mode</h2>
<style type="text/css">
 svg text {
     fill: white;
 }
 svg path,
 svg polygon,
 svg ellipse {
     stroke: white;
 }
</style>
<p>Digging through Derek Feichtinger&rsquo;s <a href="https://github.com/dfeich/org-babel-examples">org-babel examples</a> (which I came
across via <a href="http://irreal.org/blog/?p%3D4162">irreal.org</a>), I found he had some great examples of
displaying git-style graphs using graphviz. I thought it&rsquo;d be a fun
exercise to generate my own graphs based on his graphviz source using
elisp, and point it at actual git repos.</p>
<h3 id="getting-started">Getting Started</h3>
<p>I started out with the goal of building a simple graph showing a
mainline branch and a topic branch forked from it and eventually
merged back in.</p>
<p>Using Derek&rsquo;s example as a template, I described 5 commits on a master
branch, plus two on a topic branch.</p>
<p><a id="code-snippet--git-graphs-example"></a></p>
<pre tabindex="0"><code class="language-dot" data-lang="dot">digraph G {
        rankdir=&#34;LR&#34;;
        bgcolor=&#34;transparent&#34;;
        node[width=0.15, height=0.15, shape=point, color=white];
        edge[weight=2, arrowhead=none, color=white];
        node[group=master];
        1 -&gt; 2 -&gt; 3 -&gt; 4 -&gt; 5;
        node[group=branch];
        2 -&gt; 6 -&gt; 7 -&gt; 4;
}
</code></pre><p>The resulting image looks like this:</p>
<figure><img src="/ox-hugo/git-graphs-example.svg"/>
</figure>

<h4 id="designing-the-data-structure">Designing the Data Structure</h4>
<p>The first thing I needed to do was describe my data structure. Leaning
on my experiences reading and working through <a href="https://www.google.com/url?sa%3Dt&amp;rct%3Dj&amp;q%3D&amp;esrc%3Ds&amp;source%3Dweb&amp;cd%3D1&amp;cad%3Drja&amp;uact%3D8&amp;ved%3D0CB8QFjAA&amp;url%3Dhttps%253A%252F%252Fmitpress.mit.edu%252Fsicp%252F&amp;ei%3DlH6gVau5OIGR-AG8j7yACQ&amp;usg%3DAFQjCNHTCXQK7qN-kYibdy_MqRBWxlr8og&amp;sig2%3DLu9WIhyuTJS92e8hxne0Aw&amp;bvm%3Dbv.97653015,d.cWw">SICP</a>, I got to work
building a constructor function, and several accessors.</p>
<p>I decided to represent each node on a graph with an id, a list of
parent ids, and a group which will correspond to the branch on the
graph the commit belongs to.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(defun git-graph/make-node (id <span style="color:#66d9ef">&amp;optional</span> parents group)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">list</span> id parents group))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/node-id (node)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">0</span> node))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/node-parents (node)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">1</span> node))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/node-group (node)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">2</span> node))
</span></span></code></pre></div><h4 id="converting-the-structure-to-graphviz">Converting the structure to Graphviz</h4>
<p>Now that I had my data structures sorted out, it was time to step
through them and generate the graphviz source that&rsquo;d give me the
nice-looking graphs I was after.</p>
<p>The graph is constructed using the example above as a template. The
nodes are defined first, followed by the edges between them.</p>
<p><a id="code-snippet--git-graph-to-graphviz"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(defun git-graph/to-graphviz (id nodes)
</span></span><span style="display:flex;"><span>  (string-join
</span></span><span style="display:flex;"><span>   (<span style="color:#a6e22e">list</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;digraph &#34;</span> id <span style="color:#e6db74">&#34; {&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;bgcolor=\&#34;transparent\&#34;;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;rankdir=\&#34;LR\&#34;;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;node[width=0.15,height=0.15,shape=point,fontsize=8.0,color=white,fontcolor=white];&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;edge[weight=2,arrowhead=none,color=white];&#34;</span>
</span></span><span style="display:flex;"><span>    (string-join
</span></span><span style="display:flex;"><span>     (-map <span style="color:#a6e22e">#&#39;</span>git-graph/to-graphviz-node nodes)
</span></span><span style="display:flex;"><span>     <span style="color:#e6db74">&#34;\n&#34;</span>)
</span></span><span style="display:flex;"><span>     (string-join
</span></span><span style="display:flex;"><span>      (-uniq (-flatten (-map
</span></span><span style="display:flex;"><span>                        (lambda (node) (git-graph/to-graphviz-edges node nodes))
</span></span><span style="display:flex;"><span>                        nodes)))
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;\n&#34;</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;}&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#34;\n&#34;</span>))
</span></span></code></pre></div><p>For the sake of readability, I&rsquo;ll format the output:</p>
<p><a id="code-snippet--git-graph-to-graphviz"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(defun git-graph/to-graphviz-pretty (id nodes)
</span></span><span style="display:flex;"><span>  (with-temp-buffer
</span></span><span style="display:flex;"><span>    (graphviz-dot-mode)
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">insert</span> (git-graph/to-graphviz id nodes))
</span></span><span style="display:flex;"><span>    (indent-region (<span style="color:#a6e22e">point-min</span>) (<span style="color:#a6e22e">point-max</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">buffer-string</span>)))
</span></span></code></pre></div><p>Each node is built, setting its group attribute when applicable.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(defun git-graph/to-graphviz-node (node)
</span></span><span style="display:flex;"><span>  (let ((node-id (git-graph/to-graphviz-node-id
</span></span><span style="display:flex;"><span>                  (git-graph/node-id node))))
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">concat</span> node-id
</span></span><span style="display:flex;"><span>            (--if-let (git-graph/node-group node)
</span></span><span style="display:flex;"><span>                (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;[group=\&#34;&#34;</span> it <span style="color:#e6db74">&#34;\&#34;]&#34;</span>))
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;;&#34;</span>)))
</span></span></code></pre></div><p>Graphviz node identifiers are quoted to avoid running into issues with
spaces or other special characters.</p>
<p><a id="code-snippet--git-graph-to-graphviz-nodes"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(defun git-graph/to-graphviz-node-id (id)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;\&#34;%s\&#34;&#34;</span> id))
</span></span></code></pre></div><p>For each node, an edge is built connecting the node to each of its
parents.</p>
<p><a id="code-snippet--git-graph-to-graphviz-edges"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(defun git-graph/to-graphviz-edges (node <span style="color:#66d9ef">&amp;optional</span> nodelist)
</span></span><span style="display:flex;"><span>  (let ((node-id (git-graph/node-id node))
</span></span><span style="display:flex;"><span>        (parents (git-graph/node-parents node))
</span></span><span style="display:flex;"><span>        (node-ids (-map <span style="color:#a6e22e">#&#39;</span>git-graph/node-id nodelist)))
</span></span><span style="display:flex;"><span>    (-map (lambda (parent)
</span></span><span style="display:flex;"><span>            (unless (and nodelist (not (<span style="color:#a6e22e">member</span> parent node-ids)))
</span></span><span style="display:flex;"><span>              (git-graph/to-graphviz-edge node-id parent)))
</span></span><span style="display:flex;"><span>          parents)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/to-graphviz-edge (from to)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">concat</span>
</span></span><span style="display:flex;"><span>   (git-graph/to-graphviz-node-id to)
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#34; -&gt; &#34;</span>
</span></span><span style="display:flex;"><span>   (git-graph/to-graphviz-node-id from)
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#34;;&#34;</span>))
</span></span></code></pre></div><p>With that done, the simple graph above could be generated with the
following code:</p>
<p><a id="code-snippet--git-example"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(git-graph/to-graphviz-pretty
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;example&#34;</span>
</span></span><span style="display:flex;"><span> (<span style="color:#a6e22e">list</span> (git-graph/make-node <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">nil</span> <span style="color:#e6db74">&#34;master&#34;</span>)
</span></span><span style="display:flex;"><span>       (git-graph/make-node <span style="color:#ae81ff">2</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">1</span>) <span style="color:#e6db74">&#34;master&#34;</span>)
</span></span><span style="display:flex;"><span>       (git-graph/make-node <span style="color:#ae81ff">3</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">2</span>) <span style="color:#e6db74">&#34;master&#34;</span>)
</span></span><span style="display:flex;"><span>       (git-graph/make-node <span style="color:#ae81ff">4</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">7</span>) <span style="color:#e6db74">&#34;master&#34;</span>)
</span></span><span style="display:flex;"><span>       (git-graph/make-node <span style="color:#ae81ff">5</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">4</span>) <span style="color:#e6db74">&#34;master&#34;</span>)
</span></span><span style="display:flex;"><span>       (git-graph/make-node <span style="color:#ae81ff">6</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">2</span>) <span style="color:#e6db74">&#34;branch&#34;</span>)
</span></span><span style="display:flex;"><span>       (git-graph/make-node <span style="color:#ae81ff">7</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">6</span>) <span style="color:#e6db74">&#34;branch&#34;</span>)))
</span></span></code></pre></div><p>Which generates the following graphviz source:</p>
<p><a id="code-snippet--git-graphs-generated-example"></a></p>
<pre tabindex="0"><code class="language-dot" data-lang="dot">nil
</code></pre><p>The generated image matches the example exactly:</p>
<figure><img src="/ox-hugo/git-graphs-generated-example.svg"/>
</figure>

<h3 id="adding-labels">Adding Labels</h3>
<p>The next thing my graph needed was a way of labeling nodes. Rather
than trying to figure out some way of attaching a separate label to a
node, I decided to simply draw a labeled node as a box with text.</p>
<pre tabindex="0"><code class="language-dot" data-lang="dot">digraph G {
        rankdir=&#34;LR&#34;;
        bgcolor=&#34;transparent&#34;;
        node[width=0.15, height=0.15, shape=point,fontsize=8.0,color=white,fontcolor=white];
        edge[weight=2, arrowhead=none,color=white];
        node[group=main];
        1 -&gt; 2 -&gt; 3 -&gt; 4 -&gt; 5;
        5[shape=box,label=master];
        node[group=branch1];
        2 -&gt; 6 -&gt; 7 -&gt; 4;
        7[shape=box,label=branch];
}
</code></pre><figure><img src="/ox-hugo/git-graphs-labels.svg"/>
</figure>

<h4 id="updating-the-data-structure">Updating the Data Structure</h4>
<p>I updated my data structure to support an optional label applied to a
node. I opted to store it in an associative list alongside the group.</p>
<p><a id="code-snippet--git-graph-structure"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(defun git-graph/make-node (id <span style="color:#66d9ef">&amp;optional</span> parents options)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">list</span> id parents options))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/node-id (node)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">0</span> node))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/node-parents (node)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">1</span> node))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/node-group (node)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">cdr</span> (<span style="color:#a6e22e">assoc</span> <span style="color:#e6db74">&#39;group</span> (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">2</span> node))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/node-label (node)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">cdr</span> (<span style="color:#a6e22e">assoc</span> <span style="color:#e6db74">&#39;label</span> (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">2</span> node))))
</span></span></code></pre></div><h4 id="updating-the-graphviz-node-generation">Updating the Graphviz node generation</h4>
<p>The next step was updating the Graphviz generation functions to handle
the new data structure, and set the shape and label attributes of
labeled nodes.</p>
<p><a id="code-snippet--git-graph-to-graphviz-nodes"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(defun git-graph/to-graphviz-node (node)
</span></span><span style="display:flex;"><span>  (let ((node-id (git-graph/to-graphviz-node-id (git-graph/node-id node))))
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">concat</span> node-id
</span></span><span style="display:flex;"><span>            (git-graph/to-graphviz-node--attributes node)
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;;&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/to-graphviz-node--attributes (node)
</span></span><span style="display:flex;"><span>  (let ((attributes (git-graph/to-graphviz-node--compute-attributes node)))
</span></span><span style="display:flex;"><span>    (and attributes
</span></span><span style="display:flex;"><span>         (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;[&#34;</span>
</span></span><span style="display:flex;"><span>                 (<span style="color:#a6e22e">mapconcat</span> (lambda (pair)
</span></span><span style="display:flex;"><span>                              (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;%s=\&#34;%s\&#34;&#34;</span>
</span></span><span style="display:flex;"><span>                                      (<span style="color:#a6e22e">car</span> pair) (<span style="color:#a6e22e">cdr</span> pair)))
</span></span><span style="display:flex;"><span>                            attributes
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;, &#34;</span>)
</span></span><span style="display:flex;"><span>                 <span style="color:#e6db74">&#34;]&#34;</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/to-graphviz-node--compute-attributes (node)
</span></span><span style="display:flex;"><span>  (-filter <span style="color:#a6e22e">#&#39;identity</span>
</span></span><span style="display:flex;"><span>           (<span style="color:#a6e22e">append</span> (and (git-graph/node-group node)
</span></span><span style="display:flex;"><span>                        (<span style="color:#a6e22e">list</span> (<span style="color:#a6e22e">cons</span> <span style="color:#e6db74">&#39;group</span> (git-graph/node-group node))))
</span></span><span style="display:flex;"><span>                   (and (git-graph/node-label node)
</span></span><span style="display:flex;"><span>                        (<span style="color:#a6e22e">list</span> (<span style="color:#a6e22e">cons</span> <span style="color:#e6db74">&#39;shape</span> <span style="color:#e6db74">&#39;box</span>)
</span></span><span style="display:flex;"><span>                              (<span style="color:#a6e22e">cons</span> <span style="color:#e6db74">&#39;label</span> (git-graph/node-label node)))))))
</span></span></code></pre></div><p>I could then label the tips of each branch:</p>
<p><a id="code-snippet--graph-example-labels"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(git-graph/to-graphviz-pretty
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;labeled&#34;</span>
</span></span><span style="display:flex;"><span> (<span style="color:#a6e22e">list</span> (git-graph/make-node <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">nil</span> <span style="color:#f92672">&#39;</span>((group <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;master&#34;</span>)))
</span></span><span style="display:flex;"><span>       (git-graph/make-node <span style="color:#ae81ff">2</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">1</span>) <span style="color:#f92672">&#39;</span>((group <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;master&#34;</span>)))
</span></span><span style="display:flex;"><span>       (git-graph/make-node <span style="color:#ae81ff">3</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">2</span>) <span style="color:#f92672">&#39;</span>((group <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;master&#34;</span>)))
</span></span><span style="display:flex;"><span>       (git-graph/make-node <span style="color:#ae81ff">4</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">7</span>) <span style="color:#f92672">&#39;</span>((group <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;master&#34;</span>)))
</span></span><span style="display:flex;"><span>       (git-graph/make-node <span style="color:#ae81ff">5</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">4</span>) <span style="color:#f92672">&#39;</span>((group <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;master&#34;</span>)
</span></span><span style="display:flex;"><span>                                     (label <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;master&#34;</span>)))
</span></span><span style="display:flex;"><span>       (git-graph/make-node <span style="color:#ae81ff">6</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">2</span>) <span style="color:#f92672">&#39;</span>((group <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;branch&#34;</span>)))
</span></span><span style="display:flex;"><span>       (git-graph/make-node <span style="color:#ae81ff">7</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">6</span>) <span style="color:#f92672">&#39;</span>((group <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;branch&#34;</span>)
</span></span><span style="display:flex;"><span>                                     (label <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;branch&#34;</span>)))))
</span></span></code></pre></div><figure><img src="/ox-hugo/git-graphs-labels-generated.svg"/>
</figure>

<h3 id="automatic-grouping-using-leaf-nodes">Automatic Grouping Using Leaf Nodes</h3>
<p>Manually assigning groups to each node is tedious, and easy to
accidentally get wrong. Also, with the goal to graph git repositories,
I was going to have to figure out groupings automatically anyway.</p>
<p>To do this, it made sense to traverse the nodes in <a href="https://en.wikipedia.org/wiki/Topological_sorting">topological order</a>.</p>
<p>Repeating the example above,</p>
<pre tabindex="0"><code class="language-dot" data-lang="dot">digraph G {
        rankdir=&#34;LR&#34;;
        bgcolor=&#34;transparent&#34;;
        node[width=0.15, height=0.15, shape=circle, color=white, fontcolor=white];
        edge[weight=2, arrowhead=none, color=white];
        node[group=main];
        1 -&gt; 2 -&gt; 3 -&gt; 4 -&gt; 5;
        node[group=branch1];
        2 -&gt; 6 -&gt; 7 -&gt; 4;
}
</code></pre><figure><img src="/ox-hugo/git-graphs-topo.svg"/>
</figure>

<p>These nodes can be represented (right to left) in topological order as
either <code>5, 4, 3, 7, 6, 2, 1</code> or <code>5, 4, 7, 6, 3, 2, 1</code>.</p>
<p>Having no further children, <code>5</code> is a leaf node, and can be used as a
group. All first parents of <code>5</code> can therefore be considered to be in
group <code>5</code>.</p>
<p><code>7</code> is a second parent to <code>4</code>, and so should be used as the group for
all of its parents not present in group <code>5</code>.</p>
<p><a id="code-snippet--git-graph-group-topo"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(defun git-graph/group-topo (nodelist)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">reverse</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#a6e22e">car</span>
</span></span><span style="display:flex;"><span>    (-reduce-from
</span></span><span style="display:flex;"><span>     (lambda (acc node)
</span></span><span style="display:flex;"><span>       (let* ((grouped-nodes (<span style="color:#a6e22e">car</span> acc))
</span></span><span style="display:flex;"><span>              (group-stack (<span style="color:#a6e22e">cdr</span> acc))
</span></span><span style="display:flex;"><span>              (node-id (git-graph/node-id node))
</span></span><span style="display:flex;"><span>              (group-from-stack (--if-let (<span style="color:#a6e22e">assoc</span> node-id group-stack)
</span></span><span style="display:flex;"><span>                                    (<span style="color:#a6e22e">cdr</span> it)))
</span></span><span style="display:flex;"><span>              (group (or group-from-stack node-id))
</span></span><span style="display:flex;"><span>              (parents (git-graph/node-parents node))
</span></span><span style="display:flex;"><span>              (first-parent (first parents)))
</span></span><span style="display:flex;"><span>         (if group-from-stack
</span></span><span style="display:flex;"><span>             (pop group-stack))
</span></span><span style="display:flex;"><span>         (if (and first-parent (not (<span style="color:#a6e22e">assoc</span> first-parent group-stack)))
</span></span><span style="display:flex;"><span>             (push (<span style="color:#a6e22e">cons</span> first-parent group) group-stack))
</span></span><span style="display:flex;"><span>         (<span style="color:#a6e22e">cons</span> (<span style="color:#a6e22e">cons</span> (git-graph/make-node node-id
</span></span><span style="display:flex;"><span>                                    parents
</span></span><span style="display:flex;"><span>                                    <span style="color:#f92672">`</span>((group <span style="color:#f92672">.</span> <span style="color:#f92672">,</span>group)
</span></span><span style="display:flex;"><span>                                      (label <span style="color:#f92672">.</span> <span style="color:#f92672">,</span>(git-graph/node-label node))))
</span></span><span style="display:flex;"><span>                     grouped-nodes)
</span></span><span style="display:flex;"><span>               group-stack)))
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>     nodelist))))
</span></span></code></pre></div><p>While iterating through the node list, I maintained a stack of pairs
built from the first parent of the current node, and the current
group. To determine the group, the head of the stack is checked to see
if it contains a group for the current node id. If it does, that group
is used and it is popped off the stack, otherwise the current node id
is used.</p>
<p>The following table illustrates how the stack is used to store and
assign group relationships as the process iterates through the node
list:</p>
<div class="table-caption">
  <span class="table-number">Table 1:</span>
  Progressing through the nodes
</div>
<table>
<thead>
<tr>
<th>Node</th>
<th>Parents</th>
<th>Group Stack</th>
<th>Group</th>
</tr>
</thead>
<tbody>
<tr>
<td>5</td>
<td>(4)</td>
<td>(4 . 5)</td>
<td>5</td>
</tr>
<tr>
<td>4</td>
<td>(3 7)</td>
<td>(3 . 5)</td>
<td>5</td>
</tr>
<tr>
<td>3</td>
<td>(2)</td>
<td>(2 . 5)</td>
<td>5</td>
</tr>
<tr>
<td>7</td>
<td>(6)</td>
<td>(6 . 7) (2 . 5)</td>
<td>7</td>
</tr>
<tr>
<td>6</td>
<td>(2)</td>
<td>(2 . 5)</td>
<td>7</td>
</tr>
<tr>
<td>2</td>
<td>(1)</td>
<td>(1 . 5)</td>
<td>5</td>
</tr>
<tr>
<td>1</td>
<td></td>
<td></td>
<td>5</td>
</tr>
</tbody>
</table>
<h4 id="graph-without-automatic-grouping">Graph without automatic grouping</h4>
<p><a id="code-snippet--graph-no-auto-grouping"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(git-graph/to-graphviz-pretty
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;nogroups&#34;</span>
</span></span><span style="display:flex;"><span> (<span style="color:#a6e22e">list</span> (git-graph/make-node <span style="color:#ae81ff">5</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">4</span>) <span style="color:#f92672">&#39;</span>((label <span style="color:#f92672">.</span> master)))
</span></span><span style="display:flex;"><span>       (git-graph/make-node <span style="color:#ae81ff">4</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">7</span>))
</span></span><span style="display:flex;"><span>       (git-graph/make-node <span style="color:#ae81ff">3</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>       (git-graph/make-node <span style="color:#ae81ff">7</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">6</span>) <span style="color:#f92672">&#39;</span>((label <span style="color:#f92672">.</span> develop)))
</span></span><span style="display:flex;"><span>       (git-graph/make-node <span style="color:#ae81ff">6</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>       (git-graph/make-node <span style="color:#ae81ff">2</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>       (git-graph/make-node <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">nil</span>)))
</span></span></code></pre></div><figure><img src="/ox-hugo/git-graphs-no-auto-grouping.svg"/>
</figure>

<h4 id="graph-with-automatic-grouping">Graph with automatic grouping</h4>
<p><a id="code-snippet--graph-with-auto-grouping"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(git-graph/to-graphviz-pretty
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;autogroups&#34;</span>
</span></span><span style="display:flex;"><span> (git-graph/group-topo
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">list</span> (git-graph/make-node <span style="color:#ae81ff">5</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">4</span>) <span style="color:#f92672">&#39;</span>((label <span style="color:#f92672">.</span> master)))
</span></span><span style="display:flex;"><span>        (git-graph/make-node <span style="color:#ae81ff">4</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">7</span>))
</span></span><span style="display:flex;"><span>        (git-graph/make-node <span style="color:#ae81ff">3</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>        (git-graph/make-node <span style="color:#ae81ff">7</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">6</span>) <span style="color:#f92672">&#39;</span>((label <span style="color:#f92672">.</span> develop)))
</span></span><span style="display:flex;"><span>        (git-graph/make-node <span style="color:#ae81ff">6</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>        (git-graph/make-node <span style="color:#ae81ff">2</span> <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>        (git-graph/make-node <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">nil</span>))))
</span></span></code></pre></div><figure><img src="/ox-hugo/git-graphs-with-auto-grouping.svg"/>
</figure>

<h3 id="graphing-a-git-repository">Graphing a Git Repository</h3>
<p>Satisfied that I had all the necessary tools to start graphing real
git repositories, I created an example repository to test against.</p>
<h4 id="creating-a-sample-repository">Creating a Sample Repository</h4>
<p>Using the following script, I created a sample repository to test
against. I performed the following actions:</p>
<ul>
<li>Forked a develop branch from master.</li>
<li>Forked a feature branch from develop, with two commits.</li>
<li>Added another commit to develop.</li>
<li>Forked a second feature branch from develop, with two commits.</li>
<li>Merged the second feature branch to develop.</li>
<li>Merged develop to master and tagged it.</li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mkdir /tmp/test.git
</span></span><span style="display:flex;"><span>cd /tmp/test.git
</span></span><span style="display:flex;"><span>git init
</span></span><span style="display:flex;"><span>touch README
</span></span><span style="display:flex;"><span>git add README
</span></span><span style="display:flex;"><span>git commit -m <span style="color:#e6db74">&#39;initial&#39;</span>
</span></span><span style="display:flex;"><span>git commit --allow-empty -m <span style="color:#e6db74">&#39;first&#39;</span>
</span></span><span style="display:flex;"><span>git checkout -b develop
</span></span><span style="display:flex;"><span>git commit --allow-empty -m <span style="color:#e6db74">&#39;second&#39;</span>
</span></span><span style="display:flex;"><span>git checkout -b feature-1
</span></span><span style="display:flex;"><span>git commit --allow-empty -m <span style="color:#e6db74">&#39;feature 1&#39;</span>
</span></span><span style="display:flex;"><span>git commit --allow-empty -m <span style="color:#e6db74">&#39;feature 1 again&#39;</span>
</span></span><span style="display:flex;"><span>git checkout develop
</span></span><span style="display:flex;"><span>git commit --allow-empty -m <span style="color:#e6db74">&#39;third&#39;</span>
</span></span><span style="display:flex;"><span>git checkout -b feature-2
</span></span><span style="display:flex;"><span>git commit --allow-empty -m <span style="color:#e6db74">&#39;feature 2&#39;</span>
</span></span><span style="display:flex;"><span>git commit --allow-empty -m <span style="color:#e6db74">&#39;feature 2 again&#39;</span>
</span></span><span style="display:flex;"><span>git checkout develop
</span></span><span style="display:flex;"><span>git merge --no-ff feature-2
</span></span><span style="display:flex;"><span>git checkout master
</span></span><span style="display:flex;"><span>git merge --no-ff develop
</span></span><span style="display:flex;"><span>git tag -a 1.0 -m <span style="color:#e6db74">&#39;1.0!&#39;</span>
</span></span></code></pre></div><h4 id="generating-a-graph-from-a-git-branch">Generating a Graph From a Git Branch</h4>
<p>The first order of business was to have a way to call out to git and
return the results:</p>
<p><a id="code-snippet--git-graph-from-git"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(defun git-graph/git-execute (repo-url command <span style="color:#66d9ef">&amp;rest</span> args)
</span></span><span style="display:flex;"><span>  (with-temp-buffer
</span></span><span style="display:flex;"><span>    (shell-command (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;git -C \&#34;%s\&#34; %s&#34;</span>
</span></span><span style="display:flex;"><span>                           repo-url
</span></span><span style="display:flex;"><span>                           (string-join (<span style="color:#a6e22e">cons</span> command args)
</span></span><span style="display:flex;"><span>                                        <span style="color:#e6db74">&#34; &#34;</span>))
</span></span><span style="display:flex;"><span>                   <span style="color:#66d9ef">t</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">buffer-string</span>)))
</span></span></code></pre></div><p>Next, I needed to get the list of commits for a branch in topological
order, with a list of parent commits for each. It turns out git
provides exactly that via its <code>rev-list</code> command.</p>
<p><a id="code-snippet--git-graph-from-git"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(defun git-graph/git-rev-list (repo-url head)
</span></span><span style="display:flex;"><span>  (-map (lambda (line) (split-string line))
</span></span><span style="display:flex;"><span>        (split-string (git-graph/git-execute
</span></span><span style="display:flex;"><span>                       repo-url
</span></span><span style="display:flex;"><span>                       <span style="color:#e6db74">&#34;rev-list&#34;</span> <span style="color:#e6db74">&#34;--topo-order&#34;</span> <span style="color:#e6db74">&#34;--parents&#34;</span> head)
</span></span><span style="display:flex;"><span>                      <span style="color:#e6db74">&#34;\n&#34;</span> <span style="color:#66d9ef">t</span>)))
</span></span></code></pre></div><p>I also wanted to label branch heads wherever possible. To do this, I
looked up the revision name from git, discarding it if it was relative
to some other named commit.</p>
<p><a id="code-snippet--git-graph-from-git"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(defun git-graph/git-label (repo-url rev)
</span></span><span style="display:flex;"><span>  (let ((name (string-trim
</span></span><span style="display:flex;"><span>               (git-graph/git-execute repo-url
</span></span><span style="display:flex;"><span>                                      <span style="color:#e6db74">&#34;name-rev&#34;</span> <span style="color:#e6db74">&#34;--name-only&#34;</span> rev))))
</span></span><span style="display:flex;"><span>    (unless (s-contains? <span style="color:#e6db74">&#34;~&#34;</span> name)
</span></span><span style="display:flex;"><span>      name)))
</span></span></code></pre></div><p>Generating the graph for a single branch was as simple as iterating
over each commit and creating a node for it.</p>
<p><a id="code-snippet--git-graph-from-git"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(defun git-graph/git-graphs-head (repo-url head)
</span></span><span style="display:flex;"><span>  (git-graph/group-topo
</span></span><span style="display:flex;"><span>   (-map (lambda (rev-with-parents)
</span></span><span style="display:flex;"><span>           (let* ((rev (<span style="color:#a6e22e">car</span> rev-with-parents))
</span></span><span style="display:flex;"><span>                  (parents (<span style="color:#a6e22e">cdr</span> rev-with-parents))
</span></span><span style="display:flex;"><span>                  (label (git-graph/git-label repo-url rev)))
</span></span><span style="display:flex;"><span>             (git-graph/make-node rev parents
</span></span><span style="display:flex;"><span>                                  <span style="color:#f92672">`</span>((label <span style="color:#f92672">.</span> <span style="color:#f92672">,</span>label)))))
</span></span><span style="display:flex;"><span>         (git-graph/git-rev-list repo-url head))))
</span></span></code></pre></div><p>Here&rsquo;s the result of graphing the <code>master</code> branch:</p>
<p><a id="code-snippet--graph-git-branch"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(git-graph/to-graphviz-pretty
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;git&#34;</span>
</span></span><span style="display:flex;"><span> (git-graph/git-graphs-head
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;/tmp/test.git&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;master&#34;</span>))
</span></span></code></pre></div><pre tabindex="0"><code class="language-dot" data-lang="dot">nil
</code></pre><figure><img src="/ox-hugo/git-graphs-branch.svg"/>
</figure>

<h4 id="graphing-multiple-branches">Graphing Multiple Branches</h4>
<p>To graph multiple branches, I needed a function for combining
histories. To do so, I simply append any nodes I don&rsquo;t already know
about in the first history from the second.</p>
<p><a id="code-snippet--git-graph-adder"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(defun git-graph/+ (a b)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">append</span> a
</span></span><span style="display:flex;"><span>          (-remove (lambda (node)
</span></span><span style="display:flex;"><span>                     (<span style="color:#a6e22e">assoc</span> (git-graph/node-id node) a))
</span></span><span style="display:flex;"><span>                   b)))
</span></span></code></pre></div><p>From there, all that remained was to accumulate the branch histories
and output the complete graph:</p>
<p><a id="code-snippet--git-graph-from-git"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(defun git-graph/git-load (repo-url heads)
</span></span><span style="display:flex;"><span>  (-reduce <span style="color:#a6e22e">#&#39;</span>git-graph/+
</span></span><span style="display:flex;"><span>           (-map (lambda (head)
</span></span><span style="display:flex;"><span>                   (git-graph/git-graphs-head repo-url head))
</span></span><span style="display:flex;"><span>                 heads)))
</span></span></code></pre></div><p>And here&rsquo;s the example repository, graphed in full:</p>
<p><a id="code-snippet--graph-git-repo"></a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(git-graph/to-graphviz-pretty
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;git&#34;</span>
</span></span><span style="display:flex;"><span> (git-graph/git-load
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;/tmp/test.git&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#39;</span>(<span style="color:#e6db74">&#34;master&#34;</span> <span style="color:#e6db74">&#34;feature-1&#34;</span>)))
</span></span></code></pre></div><pre tabindex="0"><code class="language-dot" data-lang="dot">nil
</code></pre><figure><img src="/ox-hugo/git-graphs-repo.svg"/>
</figure>

<h3 id="things-i-may-add-in-the-future">Things I may add in the future</h3>
<h4 id="limiting-commits-to-graph">Limiting Commits to Graph</h4>
<p>Running this against repos with any substantial history can make the
graph unwieldy. It&rsquo;d be a good idea to abstract out the commit list
fetching, and modify it to support different ways of limiting the
history to display.</p>
<p>Ideas would include:</p>
<ul>
<li>Specifying commit ranges</li>
<li>Stopping at a common ancestor to all graphed branches (e.g., using
<code>git-merge-base</code>).</li>
<li>Other git commit limiting options, like searches, showing only merge
or non-merge commits, etc.</li>
</ul>
<h4 id="collapsing-history">Collapsing History</h4>
<p>Another means of reducing the size of the resulting graph would be to
collapse unimportant sections of it. It should be possible to collapse
a section of the graph, showing a count of skipped nodes.</p>
<p>The difficult part would be determining what parts aren&rsquo;t worth
drawing. Something like this would be handy, though, for concisely
graphing the state of multiple ongoing development branches (say, to
get a picture of what&rsquo;s been going on since the last release, and
what&rsquo;s still incomplete).</p>
<pre tabindex="0"><code class="language-dot" data-lang="dot">digraph G {
        rankdir=&#34;LR&#34;;
        bgcolor=&#34;transparent&#34;;
        node[width=0.15,height=0.15,shape=point,color=white];
        edge[weight=2,arrowhead=none,color=white];
        node[group=main];
        1 -&gt; 2 -&gt; 3 -&gt; 4 -&gt; 5;
        node[group=branch];
        2 -&gt; 6 -&gt; 7 -&gt; 8 -&gt; 9 -&gt; 10 -&gt; 4;
}
</code></pre><figure><img src="/ox-hugo/git-graphs-long.svg"
         alt="Figure 1: A graph with multiple nodes on a branch."/><figcaption>
            <p><span class="figure-number">Figure 1: </span>A graph with multiple nodes on a branch.</p>
        </figcaption>
</figure>

<pre tabindex="0"><code class="language-dot" data-lang="dot">digraph G {
        rankdir=&#34;LR&#34;;
        bgcolor=&#34;transparent&#34;;
        node[width=0.15,height=0.15,shape=point,color=white];
        edge[weight=2,arrowhead=none,color=white,fontcolor=white];
        node[group=main];
        1 -&gt; 2 -&gt; 3 -&gt; 4 -&gt; 5;
        node[group=branch];
        2 -&gt; 6;
        6 -&gt; 10[style=dashed,label=&#34;+3&#34;];
        10 -&gt; 4;
}
</code></pre><figure><img src="/ox-hugo/git-graphs-collapsed.svg"
         alt="Figure 2: The same graph, collapsed."/><figcaption>
            <p><span class="figure-number">Figure 2: </span>The same graph, collapsed.</p>
        </figcaption>
</figure>

<h4 id="clean-up-and-optimize-the-code-a-bit">Clean up and optimize the code a bit</h4>
<p>Some parts of this (particularly, the grouping) are probably pretty
inefficient. If this turns out to actually be useful, I may take
another crack at it.</p>
<h3 id="final-code">Final Code</h3>
<p>In case anyone would like to use this code for anything, or maybe just
pick it apart and play around with it, all the Emacs Lisp code in this
post is collected into a single file below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span><span style="color:#75715e">;;; git-graph.el --- Generate git-style graphs using graphviz</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; Copyright (c) 2015 Correl Roush &lt;correl@gmail.com&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;;; License:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; This program is free software; you can redistribute it and/or modify</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; it under the terms of the GNU General Public License as published by</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; the Free Software Foundation; either version 3, or (at your option)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; any later version.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; This program is distributed in the hope that it will be useful,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; GNU General Public License for more details.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; You should have received a copy of the GNU General Public License</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; along with GNU Emacs; see the file COPYING.  If not, write to the</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; Boston, MA 02110-1301, USA.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;;; Commentary:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;;; Code:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(require <span style="color:#e6db74">&#39;dash</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/make-node (id <span style="color:#66d9ef">&amp;optional</span> parents options)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">list</span> id parents options))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/node-id (node)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">0</span> node))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/node-parents (node)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">1</span> node))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/node-group (node)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">cdr</span> (<span style="color:#a6e22e">assoc</span> <span style="color:#e6db74">&#39;group</span> (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">2</span> node))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/node-label (node)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">cdr</span> (<span style="color:#a6e22e">assoc</span> <span style="color:#e6db74">&#39;label</span> (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">2</span> node))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/+ (a b)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">append</span> a
</span></span><span style="display:flex;"><span>          (-remove (lambda (node)
</span></span><span style="display:flex;"><span>                     (<span style="color:#a6e22e">assoc</span> (git-graph/node-id node) a))
</span></span><span style="display:flex;"><span>                   b)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/to-graphviz (id nodes)
</span></span><span style="display:flex;"><span>  (string-join
</span></span><span style="display:flex;"><span>   (<span style="color:#a6e22e">list</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;digraph &#34;</span> id <span style="color:#e6db74">&#34; {&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;bgcolor=\&#34;transparent\&#34;;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;rankdir=\&#34;LR\&#34;;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;node[width=0.15,height=0.15,shape=point,fontsize=8.0,color=white,fontcolor=white];&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;edge[weight=2,arrowhead=none,color=white];&#34;</span>
</span></span><span style="display:flex;"><span>    (string-join
</span></span><span style="display:flex;"><span>     (-map <span style="color:#a6e22e">#&#39;</span>git-graph/to-graphviz-node nodes)
</span></span><span style="display:flex;"><span>     <span style="color:#e6db74">&#34;\n&#34;</span>)
</span></span><span style="display:flex;"><span>     (string-join
</span></span><span style="display:flex;"><span>      (-uniq (-flatten (-map
</span></span><span style="display:flex;"><span>                        (lambda (node) (git-graph/to-graphviz-edges node nodes))
</span></span><span style="display:flex;"><span>                        nodes)))
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;\n&#34;</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;}&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#34;\n&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/to-graphviz-node-id (id)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;\&#34;%s\&#34;&#34;</span> id))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/to-graphviz-edges (node <span style="color:#66d9ef">&amp;optional</span> nodelist)
</span></span><span style="display:flex;"><span>  (let ((node-id (git-graph/node-id node))
</span></span><span style="display:flex;"><span>        (parents (git-graph/node-parents node))
</span></span><span style="display:flex;"><span>        (node-ids (-map <span style="color:#a6e22e">#&#39;</span>git-graph/node-id nodelist)))
</span></span><span style="display:flex;"><span>    (-map (lambda (parent)
</span></span><span style="display:flex;"><span>            (unless (and nodelist (not (<span style="color:#a6e22e">member</span> parent node-ids)))
</span></span><span style="display:flex;"><span>              (git-graph/to-graphviz-edge node-id parent)))
</span></span><span style="display:flex;"><span>          parents)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/to-graphviz-edge (from to)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">concat</span>
</span></span><span style="display:flex;"><span>   (git-graph/to-graphviz-node-id to)
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#34; -&gt; &#34;</span>
</span></span><span style="display:flex;"><span>   (git-graph/to-graphviz-node-id from)
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#34;;&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/group-topo (nodelist)
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">reverse</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#a6e22e">car</span>
</span></span><span style="display:flex;"><span>    (-reduce-from
</span></span><span style="display:flex;"><span>     (lambda (acc node)
</span></span><span style="display:flex;"><span>       (let* ((grouped-nodes (<span style="color:#a6e22e">car</span> acc))
</span></span><span style="display:flex;"><span>              (group-stack (<span style="color:#a6e22e">cdr</span> acc))
</span></span><span style="display:flex;"><span>              (node-id (git-graph/node-id node))
</span></span><span style="display:flex;"><span>              (group-from-stack (--if-let (<span style="color:#a6e22e">assoc</span> node-id group-stack)
</span></span><span style="display:flex;"><span>                                    (<span style="color:#a6e22e">cdr</span> it)))
</span></span><span style="display:flex;"><span>              (group (or group-from-stack node-id))
</span></span><span style="display:flex;"><span>              (parents (git-graph/node-parents node))
</span></span><span style="display:flex;"><span>              (first-parent (first parents)))
</span></span><span style="display:flex;"><span>         (if group-from-stack
</span></span><span style="display:flex;"><span>             (pop group-stack))
</span></span><span style="display:flex;"><span>         (if (and first-parent (not (<span style="color:#a6e22e">assoc</span> first-parent group-stack)))
</span></span><span style="display:flex;"><span>             (push (<span style="color:#a6e22e">cons</span> first-parent group) group-stack))
</span></span><span style="display:flex;"><span>         (<span style="color:#a6e22e">cons</span> (<span style="color:#a6e22e">cons</span> (git-graph/make-node node-id
</span></span><span style="display:flex;"><span>                                    parents
</span></span><span style="display:flex;"><span>                                    <span style="color:#f92672">`</span>((group <span style="color:#f92672">.</span> <span style="color:#f92672">,</span>group)
</span></span><span style="display:flex;"><span>                                      (label <span style="color:#f92672">.</span> <span style="color:#f92672">,</span>(git-graph/node-label node))))
</span></span><span style="display:flex;"><span>                     grouped-nodes)
</span></span><span style="display:flex;"><span>               group-stack)))
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>     nodelist))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(defun git-graph/git-execute (repo-url command <span style="color:#66d9ef">&amp;rest</span> args)
</span></span><span style="display:flex;"><span>  (with-temp-buffer
</span></span><span style="display:flex;"><span>    (shell-command (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;git -C \&#34;%s\&#34; %s&#34;</span>
</span></span><span style="display:flex;"><span>                           repo-url
</span></span><span style="display:flex;"><span>                           (string-join (<span style="color:#a6e22e">cons</span> command args)
</span></span><span style="display:flex;"><span>                                        <span style="color:#e6db74">&#34; &#34;</span>))
</span></span><span style="display:flex;"><span>                   <span style="color:#66d9ef">t</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">buffer-string</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(provide <span style="color:#e6db74">&#39;git-graph</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">;;; git-graph.el ends here</span>
</span></span></code></pre></div><p>Download: <a href="/files/git-graph.el">git-graph.el</a></p>
<h2 id="org-publish-with-theme">Use a different theme when publishing Org files</h2>
<p>I&rsquo;ve been using <a href="https://github.com/cpaulik/emacs-material-theme">material-theme</a> lately, and I sometimes switch around,
but I&rsquo;ve found that <a href="https://github.com/bbatsov/solarized-emacs">solarized</a> produces the best exported code block
results. To avoid having to remember to switch themes when exporting,
I wrote a quick wrapper for org-export to do it for me:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(defun my/with-theme (theme fn <span style="color:#66d9ef">&amp;rest</span> args)
</span></span><span style="display:flex;"><span>  (let ((current-themes custom-enabled-themes))
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">mapcar</span> <span style="color:#a6e22e">#&#39;</span>disable-theme custom-enabled-themes)
</span></span><span style="display:flex;"><span>    (load-theme theme <span style="color:#66d9ef">t</span>)
</span></span><span style="display:flex;"><span>    (let ((result (<span style="color:#a6e22e">apply</span> fn args)))
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">mapcar</span> <span style="color:#a6e22e">#&#39;</span>disable-theme custom-enabled-themes)
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">mapcar</span> (lambda (theme) (load-theme theme <span style="color:#66d9ef">t</span>)) current-themes)
</span></span><span style="display:flex;"><span>      result)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(advice-add <span style="color:#a6e22e">#&#39;</span>org-export-to-file :around (apply-partially <span style="color:#a6e22e">#&#39;</span>my/with-theme <span style="color:#e6db74">&#39;solarized-dark</span>))
</span></span><span style="display:flex;"><span>(advice-add <span style="color:#a6e22e">#&#39;</span>org-export-to-buffer :around (apply-partially <span style="color:#a6e22e">#&#39;</span>my/with-theme <span style="color:#e6db74">&#39;solarized-dark</span>))
</span></span></code></pre></div><p>Voilà, no more bizarrely formatted code block exports from whatever
theme I might have loaded at the time :)</p>
<h2 id="recursive-http-with-elm">Recursive HTTP Requests with Elm</h2>
<p>So I got the idea in my head that I wanted to pull data from the
GitLab / GitHub APIs in my Elm app. This seemed straightforward
enough; just wire up an HTTP request and a JSON decoder, and off I go.
Then I remember, oh crap&hellip; like any sensible API with a potentially
huge amount of data behind it, the results come back <em>paginated</em>. For
anyone unfamiliar, this means that a single API request for a list of,
say, repositories, is only going to return up to some maximum number
of results. If there are more results available, there will be a
reference to additional <em>pages</em> of results, that you can then fetch
with <em>another</em> API request. My single request decoding only the
results returned <em>from</em> that single request wasn&rsquo;t going to cut it.</p>
<p>I had a handful of problems to solve. I needed to:</p>
<ul>
<li>Detect when additional results were available.</li>
<li>Parse out the URL to use to fetch the next page of results.</li>
<li>Continue fetching results until none remained.</li>
<li>Combine all of the results, maintaining their order.</li>
</ul>
<h3 id="are-there-more-results">Are there more results?</h3>
<p>The first two bullet points can be dealt with by parsing and
inspecting the response header. Both GitHub and GitLab embed
pagination links in the <a href="https://www.w3.org/wiki/LinkHeader">HTTP Link header</a>. As I&rsquo;m interested in
consuming pages until no further results remain, I&rsquo;ll be looking for a
link in the header with the relationship &ldquo;next&rdquo;. If I find one, I know
I need to hit the associated URL to fetch more results. If I don&rsquo;t
find one, I&rsquo;m done!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">Link: &lt;https://api.github.com/user/repos?page=3&amp;per_page=100&gt;; rel=&#34;next&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">  &lt;https://api.github.com/user/repos?page=50&amp;per_page=100&gt;; rel=&#34;last&#34;
</span></span></span></code></pre></div><div class="src-block-caption">
  <span class="src-block-number">Code Snippet 1:</span>
  Example GitHub Link header
</div>
<p>Parsing this stuff out went straight into a utility module.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span><span style="color:#f92672">module </span><span style="color:#a6e22e">Paginated.Util</span> exposing (links)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import </span><span style="color:#a6e22e">Dict</span> exposing (<span style="color:#66d9ef">Dict</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">import </span><span style="color:#a6e22e">Maybe.Extra</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import </span><span style="color:#a6e22e">Regex</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{-| Parse an HTTP Link header into a dictionary. For example, to look
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">for a link to additional results in an API response, you could do the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">following:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    Dict.get &#34;Link&#34; response.headers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        |&gt; Maybe.map links
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        |&gt; Maybe.andThen (Dict.get &#34;next&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">-}</span>
</span></span><span style="display:flex;"><span>links <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">String</span> <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Dict</span> <span style="color:#66d9ef">String</span> <span style="color:#66d9ef">String</span>
</span></span><span style="display:flex;"><span>links s <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span>
</span></span><span style="display:flex;"><span>        toTuples xs <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> xs <span style="color:#66d9ef">of</span>
</span></span><span style="display:flex;"><span>                [ <span style="color:#66d9ef">Just</span> a, <span style="color:#66d9ef">Just</span> b ] <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">Just</span> ( b, a )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                _ <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">Nothing</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">in</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">Regex</span><span style="color:#a6e22e">.</span>find
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">Regex</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">All</span>
</span></span><span style="display:flex;"><span>            (<span style="color:#66d9ef">Regex</span><span style="color:#a6e22e">.</span>regex <span style="color:#e6db74">&#34;&lt;(.*?)&gt;; rel=</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">(.*?)</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            s
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">|&gt;</span> <span style="color:#66d9ef">List</span><span style="color:#a6e22e">.</span>map <span style="color:#a6e22e">.</span>submatches
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">|&gt;</span> <span style="color:#66d9ef">List</span><span style="color:#a6e22e">.</span>map toTuples
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">|&gt;</span> <span style="color:#66d9ef">Maybe</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Extra</span><span style="color:#a6e22e">.</span>values
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">|&gt;</span> <span style="color:#66d9ef">Dict</span><span style="color:#a6e22e">.</span>fromList
</span></span></code></pre></div><p>A little bit of regular expression magic, tuples, and
<code>Maybe.Extra.values</code> to keep the matches, and now I&rsquo;ve got my
(<code>Maybe</code>) URL.</p>
<h3 id="time-to-make-some-requests">Time to make some requests</h3>
<p>Now&rsquo;s the time to define some types. I&rsquo;ll need a <code>Request</code>, which will
be similar to a standard <code>Http.Request</code>, with a <em>slight</em> difference.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">alias</span> <span style="color:#66d9ef">RequestOptions</span> a <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    { method <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">String</span>
</span></span><span style="display:flex;"><span>    , headers <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">List</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Header</span>
</span></span><span style="display:flex;"><span>    , url <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">String</span>
</span></span><span style="display:flex;"><span>    , body <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Body</span>
</span></span><span style="display:flex;"><span>    , decoder <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Decoder</span> a
</span></span><span style="display:flex;"><span>    , timeout <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Maybe</span> <span style="color:#66d9ef">Time</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Time</span>
</span></span><span style="display:flex;"><span>    , withCredentials <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Bool</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">Request</span> a
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">=</span> <span style="color:#66d9ef">Request</span> (<span style="color:#66d9ef">RequestOptions</span> a)
</span></span></code></pre></div><p>What separates it from a basic <code>Http.Request</code> is the <code>decoder</code> field
instead of an <code>expect</code> field. The <code>expect</code> field in an HTTP request is
responsible for parsing the full response into whatever result the
caller wants. For my purposes, I always intend to be hitting a JSON
API returning a list of items, and I have my own designs on parsing
bits of the request to pluck out the headers. Therefore, I expose only
a slot for including a JSON decoder representing the type of item I&rsquo;ll
be getting a collection of.</p>
<p>I&rsquo;ll also need a <code>Response</code>, which will either be <code>Partial</code>
(containing the results from the response, plus a <code>Request</code> for
getting the next batch), or <code>Complete</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">Response</span> a
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">=</span> <span style="color:#66d9ef">Partial</span> (<span style="color:#66d9ef">Request</span> a) (<span style="color:#66d9ef">List</span> a)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">|</span> <span style="color:#66d9ef">Complete</span> (<span style="color:#66d9ef">List</span> a)
</span></span></code></pre></div><p>Sending the request isn&rsquo;t too bad. I can just convert my request into
an <code>Http.Request</code>, and use <code>Http.send</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span>send <span style="color:#a6e22e">:</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">Result</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Error</span> (<span style="color:#66d9ef">Response</span> a) <span style="color:#a6e22e">-&gt;</span> msg)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Request</span> a
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Cmd</span> msg
</span></span><span style="display:flex;"><span>send resultToMessage request <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span>send resultToMessage <span style="color:#a6e22e">&lt;|</span>
</span></span><span style="display:flex;"><span>        httpRequest request
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>httpRequest <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Request</span> a <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Request</span> (<span style="color:#66d9ef">Response</span> a)
</span></span><span style="display:flex;"><span>httpRequest (<span style="color:#66d9ef">Request</span> options) <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span>request
</span></span><span style="display:flex;"><span>        { method <span style="color:#a6e22e">=</span> options<span style="color:#a6e22e">.</span>method
</span></span><span style="display:flex;"><span>        , headers <span style="color:#a6e22e">=</span> options<span style="color:#a6e22e">.</span>headers
</span></span><span style="display:flex;"><span>        , url <span style="color:#a6e22e">=</span> options<span style="color:#a6e22e">.</span>url
</span></span><span style="display:flex;"><span>        , body <span style="color:#a6e22e">=</span> options<span style="color:#a6e22e">.</span>body
</span></span><span style="display:flex;"><span>        , expect <span style="color:#a6e22e">=</span> expect options
</span></span><span style="display:flex;"><span>        , timeout <span style="color:#a6e22e">=</span> options<span style="color:#a6e22e">.</span>timeout
</span></span><span style="display:flex;"><span>        , withCredentials <span style="color:#a6e22e">=</span> options<span style="color:#a6e22e">.</span>withCredentials
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>expect <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">RequestOptions</span> a <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Expect</span> (<span style="color:#66d9ef">Response</span> a)
</span></span><span style="display:flex;"><span>expect options <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span>expectStringResponse (fromResponse options)
</span></span></code></pre></div><p>All of my special logic for handling the headers, mapping the decoder
over the results, and packing them up into a <code>Response</code> is baked into
my <code>Http.Request</code> via a private <code>fromResponse</code> translator:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span>fromResponse <span style="color:#a6e22e">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">RequestOptions</span> a
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Response</span> <span style="color:#66d9ef">String</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Result</span> <span style="color:#66d9ef">String</span> (<span style="color:#66d9ef">Response</span> a)
</span></span><span style="display:flex;"><span>fromResponse options response <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span>
</span></span><span style="display:flex;"><span>        items <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Result</span> <span style="color:#66d9ef">String</span> (<span style="color:#66d9ef">List</span> a)
</span></span><span style="display:flex;"><span>        items <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">Json</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Decode</span><span style="color:#a6e22e">.</span>decodeString
</span></span><span style="display:flex;"><span>                (<span style="color:#66d9ef">Json</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Decode</span><span style="color:#a6e22e">.</span>list options<span style="color:#a6e22e">.</span>decoder)
</span></span><span style="display:flex;"><span>                response<span style="color:#a6e22e">.</span>body
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        nextPage <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">Dict</span><span style="color:#a6e22e">.</span>get <span style="color:#e6db74">&#34;Link&#34;</span> response<span style="color:#a6e22e">.</span>headers
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">|&gt;</span> <span style="color:#66d9ef">Maybe</span><span style="color:#a6e22e">.</span>map <span style="color:#66d9ef">Paginated</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Util</span><span style="color:#a6e22e">.</span>links
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">|&gt;</span> <span style="color:#66d9ef">Maybe</span><span style="color:#a6e22e">.</span>andThen (<span style="color:#66d9ef">Dict</span><span style="color:#a6e22e">.</span>get <span style="color:#e6db74">&#34;next&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">in</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> nextPage <span style="color:#66d9ef">of</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">Nothing</span> <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">Result</span><span style="color:#a6e22e">.</span>map <span style="color:#66d9ef">Complete</span> items
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">Just</span> url <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">Result</span><span style="color:#a6e22e">.</span>map
</span></span><span style="display:flex;"><span>                    (<span style="color:#66d9ef">Partial</span> (request { options <span style="color:#a6e22e">|</span> url <span style="color:#a6e22e">=</span> url }))
</span></span><span style="display:flex;"><span>                    items
</span></span></code></pre></div><h3 id="putting-it-together">Putting it together</h3>
<p>Now, I can make my API request, and get back a response with
potentially partial results. All that needs to be done now is to make
my request, and iterate on the results I get back in my <code>update</code>
method.</p>
<p>To make things a bit easier, I add a method for concatenating two
responses:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span>update <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Response</span> a <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Response</span> a <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Response</span> a
</span></span><span style="display:flex;"><span>update old new <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> ( old, new ) <span style="color:#66d9ef">of</span>
</span></span><span style="display:flex;"><span>        ( <span style="color:#66d9ef">Complete</span> items, _ ) <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">Complete</span> items
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ( <span style="color:#66d9ef">Partial</span> _ oldItems, <span style="color:#66d9ef">Complete</span> newItems ) <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">Complete</span> (oldItems <span style="color:#a6e22e">++</span> newItems)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ( <span style="color:#66d9ef">Partial</span> _ oldItems, <span style="color:#66d9ef">Partial</span> request newItems ) <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">Partial</span> request (oldItems <span style="color:#a6e22e">++</span> newItems)
</span></span></code></pre></div><p>Putting it all together, I get a fully functional test app that
fetches a paginated list of repositories from GitLab, and renders them
when I&rsquo;ve fetched them all:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span><span style="color:#f92672">module </span><span style="color:#a6e22e">Example</span> exposing <span style="color:#a6e22e">(..)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import </span><span style="color:#a6e22e">Html</span> exposing (<span style="color:#66d9ef">Html</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">import </span><span style="color:#a6e22e">Http</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import </span><span style="color:#a6e22e">Json.Decode</span> exposing (field, string)
</span></span><span style="display:flex;"><span><span style="color:#f92672">import </span><span style="color:#a6e22e">Paginated</span> exposing (<span style="color:#66d9ef">Response</span><span style="color:#a6e22e">(..)</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">alias</span> <span style="color:#66d9ef">Model</span> <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    { repositories <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Maybe</span> (<span style="color:#66d9ef">Response</span> <span style="color:#66d9ef">String</span>) }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">Msg</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">=</span> <span style="color:#66d9ef">GotRepositories</span> (<span style="color:#66d9ef">Result</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Error</span> (<span style="color:#66d9ef">Paginated</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Response</span> <span style="color:#66d9ef">String</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">main </span><span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Program</span> <span style="color:#66d9ef">Never</span> <span style="color:#66d9ef">Model</span> <span style="color:#66d9ef">Msg</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">main </span><span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Html</span><span style="color:#a6e22e">.</span>program
</span></span><span style="display:flex;"><span>        { init <span style="color:#a6e22e">=</span> init
</span></span><span style="display:flex;"><span>        , update <span style="color:#a6e22e">=</span> update
</span></span><span style="display:flex;"><span>        , view <span style="color:#a6e22e">=</span> view
</span></span><span style="display:flex;"><span>        , subscriptions <span style="color:#a6e22e">=</span> <span style="color:#a6e22e">\</span>_ <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Sub</span><span style="color:#a6e22e">.</span>none
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>init <span style="color:#a6e22e">:</span> ( <span style="color:#66d9ef">Model</span>, <span style="color:#66d9ef">Cmd</span> <span style="color:#66d9ef">Msg</span> )
</span></span><span style="display:flex;"><span>init <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    ( { repositories <span style="color:#a6e22e">=</span> <span style="color:#66d9ef">Nothing</span> }
</span></span><span style="display:flex;"><span>    , getRepositories
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>update <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Msg</span> <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Model</span> <span style="color:#a6e22e">-&gt;</span> ( <span style="color:#66d9ef">Model</span>, <span style="color:#66d9ef">Cmd</span> <span style="color:#66d9ef">Msg</span> )
</span></span><span style="display:flex;"><span>update msg model <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> msg <span style="color:#66d9ef">of</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">GotRepositories</span> (<span style="color:#66d9ef">Ok</span> response) <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>            ( { model
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">|</span> repositories <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">case</span> model<span style="color:#a6e22e">.</span>repositories <span style="color:#66d9ef">of</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">Nothing</span> <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#66d9ef">Just</span> response
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">Just</span> previous <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#66d9ef">Just</span> (<span style="color:#66d9ef">Paginated</span><span style="color:#a6e22e">.</span>update previous response)
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            , <span style="color:#66d9ef">case</span> response <span style="color:#66d9ef">of</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">Partial</span> request _ <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">Paginated</span><span style="color:#a6e22e">.</span>send <span style="color:#66d9ef">GotRepositories</span> request
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">Complete</span> _ <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">Cmd</span><span style="color:#a6e22e">.</span>none
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">GotRepositories</span> (<span style="color:#66d9ef">Err</span> _) <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>            ( { model <span style="color:#a6e22e">|</span> repositories <span style="color:#a6e22e">=</span> <span style="color:#66d9ef">Nothing</span> }
</span></span><span style="display:flex;"><span>            , <span style="color:#66d9ef">Cmd</span><span style="color:#a6e22e">.</span>none
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>view <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Model</span> <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Html</span> <span style="color:#66d9ef">Msg</span>
</span></span><span style="display:flex;"><span>view model <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> model<span style="color:#a6e22e">.</span>repositories <span style="color:#66d9ef">of</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">Nothing</span> <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">Html</span><span style="color:#a6e22e">.</span>div [] [ <span style="color:#66d9ef">Html</span><span style="color:#a6e22e">.</span>text <span style="color:#e6db74">&#34;Loading&#34;</span> ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">Just</span> (<span style="color:#66d9ef">Partial</span> _ _) <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">Html</span><span style="color:#a6e22e">.</span>div [] [ <span style="color:#66d9ef">Html</span><span style="color:#a6e22e">.</span>text <span style="color:#e6db74">&#34;Loading...&#34;</span> ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">Just</span> (<span style="color:#66d9ef">Complete</span> repos) <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">Html</span><span style="color:#a6e22e">.</span>ul [] <span style="color:#a6e22e">&lt;|</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">List</span><span style="color:#a6e22e">.</span>map
</span></span><span style="display:flex;"><span>                    (<span style="color:#a6e22e">\</span>x <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Html</span><span style="color:#a6e22e">.</span>li [] [ <span style="color:#66d9ef">Html</span><span style="color:#a6e22e">.</span>text x ])
</span></span><span style="display:flex;"><span>                    repos
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>getRepositories <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Cmd</span> <span style="color:#66d9ef">Msg</span>
</span></span><span style="display:flex;"><span>getRepositories <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Paginated</span><span style="color:#a6e22e">.</span>send <span style="color:#66d9ef">GotRepositories</span> <span style="color:#a6e22e">&lt;|</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">Paginated</span><span style="color:#a6e22e">.</span>get
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;http://git.phoenixinquis.net/api/v4/projects?per_page=5&#34;</span>
</span></span><span style="display:flex;"><span>            (field <span style="color:#e6db74">&#34;name&#34;</span> string)
</span></span></code></pre></div><h3 id="there-s-got-to-be-a-better-way">There&rsquo;s got to be a better way</h3>
<p>I&rsquo;ve got it working, and it&rsquo;s working well. However, it&rsquo;s kind of a
pain to use. It&rsquo;s nice that I can play with the results as they come
in by peeking into the <code>Partial</code> structure, but it&rsquo;s a real chore to
have to stitch the results together in my application&rsquo;s <code>update</code>
method. It&rsquo;d be nice if I could somehow encapsulate that behavior in
my request and not have to worry about the pagination at all in my
app.</p>
<p>It just so happens that, with Tasks, I can.</p>
<p><em>Feel free to check out the full library documentation and code
referenced in this post <a href="http://package.elm-lang.org/packages/correl/elm-paginated/1.0.1">here</a>.</em></p>
<p><em>Continue on with part two, <a href="/2018/01/23/cleaner-recursive-http-with-elm-tasks.html">Cleaner Recursive HTTP Requests with Elm
Tasks</a>.</em></p>
<h2 id="cleaner-recursive-http-with-elm-tasks">Cleaner Recursive HTTP Requests with Elm Tasks</h2>
<p><em>Continued from part one, <a href="/2018/01/22/recursive-http-with-elm.html">Recursive HTTP Requests with Elm</a>.</em></p>
<p>In <a href="/2018/01/22/recursive-http-with-elm.html">my last post</a>, I described my first pass at building a library to
fetch data from a paginated JSON REST API. It worked, but it wasn&rsquo;t
too clean. In particular, the handling of the multiple pages and
concatenation of results was left up to the calling code. Ideally,
both of these concerns should be handled by the library, letting the
application focus on working with a full result set. Using Elm&rsquo;s
Tasks, we can achieve exactly that!</p>
<h3 id="what-s-a-task">What&rsquo;s a Task?</h3>
<p>A <a href="http://package.elm-lang.org/packages/elm-lang/core/5.1.1/Task">Task</a> is a data structure in Elm which represents an asynchronous
operation that may fail, which can be mapped and <strong>chained</strong>. What this
means is, we can create an action, transform it, and chain it with
additional actions, building up a complex series of things to do into
a single <code>Task</code>, which we can then package up into a <a href="http://package.elm-lang.org/packages/elm-lang/core/5.1.1/Platform-Cmd#Cmd">Cmd</a> and hand to
the Elm runtime to perform. You can think of it like building up a
<a href="https://en.wikipedia.org/wiki/Futures_and_promises">Future or Promise</a>, setting up a sort of <a href="https://en.wikipedia.org/wiki/Callback_(computer_programming)">callback</a> chain of mutations
and follow-up actions to be taken. The Elm runtime will work its way
through the chain and hand your application back the result in the
form of a <code>Msg</code>.</p>
<p>So, tasks sound great!</p>
<h3 id="moving-to-tasks">Moving to Tasks</h3>
<p>Just to get things rolling, let&rsquo;s quit using <code>Http.send</code>, and instead
prepare a simple <code>toTask</code> function leveraging the very handy
<code>Http.toTask</code>. This&rsquo;ll give us a place to start building up some more
complex behavior.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span>send <span style="color:#a6e22e">:</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">Result</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Error</span> (<span style="color:#66d9ef">Response</span> a) <span style="color:#a6e22e">-&gt;</span> msg)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Request</span> a
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Cmd</span> msg
</span></span><span style="display:flex;"><span>send resultToMessage request <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>        toTask request
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">|&gt;</span> <span style="color:#66d9ef">Task</span><span style="color:#a6e22e">.</span>attempt resultToMessage
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>toTask <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Request</span> a <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Task</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Error</span> (<span style="color:#66d9ef">Response</span> a)
</span></span><span style="display:flex;"><span>toTask <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    httpRequest <span style="color:#a6e22e">&gt;&gt;</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span>toTask
</span></span></code></pre></div><h3 id="shifting-the-recursion">Shifting the recursion</h3>
<p>Now, for the fun bit. We want, when a request completes, to inspect
the result. If the task failed, we do nothing. If it succeeded, we
move on to checking the response. If we have a <code>Complete</code> response,
we&rsquo;re done. If we do not, we want to build another task for the next
request, and start a new iteration on that.</p>
<p>All that needs to be done here is to chain our response handling using
<code>Task.andThen</code>, and either recurse to continue the chain with the next
<code>Task</code>, or wrap up the final results with <code>Task.succeed</code>!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span>recurse <span style="color:#a6e22e">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Task</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Error</span> (<span style="color:#66d9ef">Response</span> a)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Task</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Error</span> (<span style="color:#66d9ef">Response</span> a)
</span></span><span style="display:flex;"><span>recurse <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Task</span><span style="color:#a6e22e">.</span>andThen
</span></span><span style="display:flex;"><span>        (<span style="color:#a6e22e">\</span>response <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> response <span style="color:#66d9ef">of</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">Partial</span> request _ <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>                    httpRequest request
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">|&gt;</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span>toTask
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">|&gt;</span> recurse
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">Complete</span> _ <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">Task</span><span style="color:#a6e22e">.</span>succeed response
</span></span><span style="display:flex;"><span>        )
</span></span></code></pre></div><p>That wasn&rsquo;t so bad. The function recursion almost seems like cheating:
I&rsquo;m able to build up a whole chain of requests <em>based</em> on the results
without actually <em>having</em> the results yet! The <code>Task</code> lets us define a
complete plan for what to do with the results, using what we know
about the data structures flowing through to make decisions and tack
on additional things to do.</p>
<h3 id="accumulating-results">Accumulating results</h3>
<p>There&rsquo;s just one thing left to do: we&rsquo;re not accumulating results yet.
We&rsquo;re just handing off the results of the final request, which isn&rsquo;t
too helpful to the caller. We&rsquo;re also still returning our Response
structure, which is no longer necessary, since we&rsquo;re not bothering
with returning incomplete requests anymore.</p>
<p>Cleaning up the types is pretty easy. It&rsquo;s just a matter of switching
out some instances of <code>Response a</code> with <code>List a</code> in our type
declarations&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span>send <span style="color:#a6e22e">:</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">Result</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Error</span> (<span style="color:#66d9ef">List</span> a) <span style="color:#a6e22e">-&gt;</span> msg)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Request</span> a
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Cmd</span> msg
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>toTask <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Request</span> a <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Task</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Error</span> (<span style="color:#66d9ef">List</span> a)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>recurse <span style="color:#a6e22e">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Task</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Error</span> (<span style="color:#66d9ef">Response</span> a)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Task</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Error</span> (<span style="color:#66d9ef">List</span> a)
</span></span></code></pre></div><p>&hellip;then changing our <code>Complete</code> case to return the actual items:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span><span style="color:#66d9ef">Complete</span> xs <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Task</span><span style="color:#a6e22e">.</span>succeed xs
</span></span></code></pre></div><p>The final step, then, is to accumulate the results. Turns out this is
<strong>super</strong> easy. We already have an <code>update</code> function that combines two
responses, so we can map <em>that</em> over our next request task so that it
incorporates the previous request&rsquo;s results!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span><span style="color:#66d9ef">Partial</span> request _ <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>    httpRequest request
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">|&gt;</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span>toTask
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">|&gt;</span> <span style="color:#66d9ef">Task</span><span style="color:#a6e22e">.</span>map (update response)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">|&gt;</span> recurse
</span></span></code></pre></div><h3 id="tidying-up">Tidying up</h3>
<p>Things are tied up pretty neatly, now! Calling code no longer needs to
care whether the JSON endpoints its calling paginate their results,
they&rsquo;ll receive everything they asked for as though it were a single
request. Implementation details like the <code>Response</code> structure,
<code>update</code> method, and <code>httpRequest</code> no longer need to be exposed.
<code>toTask</code> can be exposed now as a convenience to anyone who wants to
perform further chaining on their calls.</p>
<p>Now that there&rsquo;s a cleaner interface to the module, the example app is
looking a lot cleaner now, too:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span><span style="color:#f92672">module </span><span style="color:#a6e22e">Example</span> exposing <span style="color:#a6e22e">(..)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import </span><span style="color:#a6e22e">Html</span> exposing (<span style="color:#66d9ef">Html</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">import </span><span style="color:#a6e22e">Http</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import </span><span style="color:#a6e22e">Json.Decode</span> exposing (field, string)
</span></span><span style="display:flex;"><span><span style="color:#f92672">import </span><span style="color:#a6e22e">Paginated</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">alias</span> <span style="color:#66d9ef">Model</span> <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    { repositories <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Maybe</span> (<span style="color:#66d9ef">List</span> <span style="color:#66d9ef">String</span>) }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">Msg</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">=</span> <span style="color:#66d9ef">GotRepositories</span> (<span style="color:#66d9ef">Result</span> <span style="color:#66d9ef">Http</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Error</span> (<span style="color:#66d9ef">List</span> <span style="color:#66d9ef">String</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">main </span><span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Program</span> <span style="color:#66d9ef">Never</span> <span style="color:#66d9ef">Model</span> <span style="color:#66d9ef">Msg</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">main </span><span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Html</span><span style="color:#a6e22e">.</span>program
</span></span><span style="display:flex;"><span>        { init <span style="color:#a6e22e">=</span> init
</span></span><span style="display:flex;"><span>        , update <span style="color:#a6e22e">=</span> update
</span></span><span style="display:flex;"><span>        , view <span style="color:#a6e22e">=</span> view
</span></span><span style="display:flex;"><span>        , subscriptions <span style="color:#a6e22e">=</span> <span style="color:#a6e22e">\</span>_ <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Sub</span><span style="color:#a6e22e">.</span>none
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>init <span style="color:#a6e22e">:</span> ( <span style="color:#66d9ef">Model</span>, <span style="color:#66d9ef">Cmd</span> <span style="color:#66d9ef">Msg</span> )
</span></span><span style="display:flex;"><span>init <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    ( { repositories <span style="color:#a6e22e">=</span> <span style="color:#66d9ef">Nothing</span> }
</span></span><span style="display:flex;"><span>    , getRepositories
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>update <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Msg</span> <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Model</span> <span style="color:#a6e22e">-&gt;</span> ( <span style="color:#66d9ef">Model</span>, <span style="color:#66d9ef">Cmd</span> <span style="color:#66d9ef">Msg</span> )
</span></span><span style="display:flex;"><span>update msg model <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> msg <span style="color:#66d9ef">of</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">GotRepositories</span> result <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>            ( { model <span style="color:#a6e22e">|</span> repositories <span style="color:#a6e22e">=</span> <span style="color:#66d9ef">Result</span><span style="color:#a6e22e">.</span>toMaybe result }
</span></span><span style="display:flex;"><span>            , <span style="color:#66d9ef">Cmd</span><span style="color:#a6e22e">.</span>none
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>view <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Model</span> <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Html</span> <span style="color:#66d9ef">Msg</span>
</span></span><span style="display:flex;"><span>view model <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> model<span style="color:#a6e22e">.</span>repositories <span style="color:#66d9ef">of</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">Nothing</span> <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">Html</span><span style="color:#a6e22e">.</span>div [] [ <span style="color:#66d9ef">Html</span><span style="color:#a6e22e">.</span>text <span style="color:#e6db74">&#34;Loading&#34;</span> ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">Just</span> repos <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">Html</span><span style="color:#a6e22e">.</span>ul [] <span style="color:#a6e22e">&lt;|</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">List</span><span style="color:#a6e22e">.</span>map
</span></span><span style="display:flex;"><span>                    (<span style="color:#a6e22e">\</span>x <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Html</span><span style="color:#a6e22e">.</span>li [] [ <span style="color:#66d9ef">Html</span><span style="color:#a6e22e">.</span>text x ])
</span></span><span style="display:flex;"><span>                    repos
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>getRepositories <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Cmd</span> <span style="color:#66d9ef">Msg</span>
</span></span><span style="display:flex;"><span>getRepositories <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Paginated</span><span style="color:#a6e22e">.</span>send <span style="color:#66d9ef">GotRepositories</span> <span style="color:#a6e22e">&lt;|</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">Paginated</span><span style="color:#a6e22e">.</span>get
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;http://git.phoenixinquis.net/api/v4/projects?per_page=5&#34;</span>
</span></span><span style="display:flex;"><span>            (field <span style="color:#e6db74">&#34;name&#34;</span> string)
</span></span></code></pre></div><p>So, there we have it! Feel free to check out the my complete
<code>Paginated</code> library on the <a href="http://package.elm-lang.org/packages/correl/elm-paginated/latest">Elm package index</a>, or on <a href="https://github.com/correl/elm-paginated">GitHub</a>. Hopefully
you&rsquo;ll find it or this post useful. I&rsquo;m still finding my way around
Elm, so any and all feedback is quite welcome :)</p>
<h2 id="hue-wake-up">How Does The Phillips Hue Wake-Up Feature Work?</h2>
<p>I recently got myself a set of Phillips Hue White and Color Ambiance
lights. One of the features I was looking forward to in particular
(besides playing with all the color options) was setting a wake-up
alarm with the lights gradually brightening. This was pretty painless
to get set up using the phone app. I&rsquo;m pretty happy with the result,
but there&rsquo;s certainly some things I wouldn&rsquo;t mind tweaking. For
example, the initial brightness of the bulbs (at the lowest setting)
still seems a bit bright, so I might want to delay the bedside lamps
and let the more distant lamp start fading in first. I also want to
see if I can fiddle it into transitioning between some colors to get
more of a sunrise effect (perhaps &ldquo;rising&rdquo; from the other side of the
room, with the light spreading towards the head of the bed).</p>
<p>Figuring out how the wake-up settings that the app installed on my
bridge seemed a good first step towards introducing my own
customizations.</p>
<p>Information on getting access to a Hue bridge to make REST API calls
to it can be found in the <a href="https://www.developers.meethue.com/documentation/getting-started">Hue API getting started guide</a>.</p>
<h3 id="my-wake-up-settings">My wake-up settings</h3>
<p>My wake-up is scheduled for 7:00 to gradually brighten the lights with
a half-hour fade-in each weekday. I also toggled on the setting to
automatically turn the lights off at 9:00.</p>
<style>.org-center { margin-left: auto; margin-right: auto; text-align: center; }</style>
<div class="org-center">
<p><img src="/images/Screenshot_20180313-182434.png" alt=""> <img src="/images/Screenshot_20180313-182438.png" alt=""></p>
</div>
<h3 id="finding-things-on-the-bridge">Finding things on the bridge</h3>
<p>The most natural starting point is to check the schedules. Right off
the bat, I find what I&rsquo;m after:</p>
<h4 id="the-schedule-dot-dot-dot">The schedule &hellip;</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">GET http://bridge/api/${username}/schedules/1
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Wake up&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;description&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;L_04_fidlv_start wake up&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;command&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;address&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/api/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/sensors/2/state&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;body&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;flag&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;method&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;PUT&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;localtime&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;W124/T06:30:00&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;time&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;W124/T10:30:00&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;created&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2018-03-11T19:46:54&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;status&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;enabled&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;recycle&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This is a recurring schedule item that runs every weekday at 6:30. We
can tell this by looking at the <code>localtime</code> field. From the
documentation on <a href="https://www.developers.meethue.com/documentation/datatypes-and-time-patterns#16_time_patterns">time patterns</a>, we can see that it&rsquo;s a recurring time
pattern specifying days of the week as a bitmask, and a time (6:30).</p>
<div class="table-caption">
  <span class="table-number">Table 2:</span>
  Unraveling the weekday portion
</div>
<table>
<thead>
<tr>
<th style="text-align:left"><code>0MTWTFSS</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>01111100</code> (124 in decimal)</td>
</tr>
</tbody>
</table>
<p>Since this schedule is enabled, we can be assured that it will run,
and in doing so, will issue a <code>PUT</code> to a sensors endpoint, setting a
flag to true.</p>
<h4 id="dot-dot-dot-triggers-the-sensor-dot-dot-dot">&hellip; triggers the sensor &hellip;</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">GET http://bridge/api/${username}/sensors/2
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;state&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;flag&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;lastupdated&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2018-03-13T13:00:00&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;config&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;on&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;reachable&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Sensor for wakeup&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;type&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;CLIPGenericFlag&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;modelid&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;WAKEUP&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;manufacturername&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;swversion&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;A_1801260942&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;uniqueid&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;L_04_fidlv&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;recycle&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The sensor is what&rsquo;s <em>really</em> setting things in motion. Here we&rsquo;ve got
a <a href="https://www.developers.meethue.com/documentation/supported-sensors#clipSensors">generic CLIP flag sensor</a> that is triggered exclusively by our
schedule. Essentially, by updating the flag state, we trigger the
sensor.</p>
<h4 id="dot-dot-dot-triggers-a-rule-dot-dot-dot">&hellip; triggers a rule &hellip;</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">GET http://bridge/api/${username}/rules/1
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;L_04_fidlv_Start&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;owner&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;created&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2018-03-11T19:46:51&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;lasttriggered&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2018-03-13T10:30:00&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;timestriggered&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;status&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;enabled&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;recycle&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;conditions&#34;</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;address&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/sensors/2/state/flag&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;operator&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;eq&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;value&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;actions&#34;</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;address&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/groups/1/action&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;method&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;PUT&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;body&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;scene&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;7GJer2-5ahGIqz6&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;address&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/schedules/2&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;method&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;PUT&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;body&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;status&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;enabled&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now things are happening. Looking at the conditions, we can see that
this rule triggers when the wakeup sensor updates, and its flag is set
to <code>true</code>. When that happens, the bridge will iterate through its
rules, find that the above condition has been met, and iterate through
each of the actions.</p>
<h4 id="dot-dot-dot-which-sets-the-scene-dot-dot-dot">&hellip; which sets the scene &hellip;</h4>
<p>The bedroom group (<code>/groups/1</code> in the rule&rsquo;s action list) is set to
the following scene, which turns on the lights at minimum brightness:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">GET http://bridge/api/${username}/scenes/7GJer2-5ahGIqz6
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Wake Up init&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;lights&#34;</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;2&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;3&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;5&#34;</span>
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;owner&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;recycle&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;locked&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;appdata&#34;</span><span style="color:#f92672">:</span> {},
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;picture&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;lastupdated&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2018-03-11T19:46:50&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;version&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;lightstates&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;2&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;on&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;bri&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;ct&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">447</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;3&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;on&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;bri&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;ct&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">447</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;5&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;on&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;bri&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;ct&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">447</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="dot-dot-dot-and-schedules-the-transition-dot-dot-dot">&hellip; and schedules the transition &hellip;</h4>
<p>Another schedule (<code>/schedules/2</code> in the rule&rsquo;s action list) is enabled
by the rule.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">GET http://bridge/api/${username}/schedules/2
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;L_04_fidlv&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;description&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;L_04_fidlv_trigger end scene&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;command&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;address&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/api/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/groups/0/action&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;body&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;scene&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;gXdkB1um68N1sZL&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;method&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;PUT&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;localtime&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;PT00:01:00&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;time&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;PT00:01:00&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;created&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2018-03-11T19:46:51&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;status&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;disabled&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;autodelete&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;starttime&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2018-03-13T10:30:00&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;recycle&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><em>This</em> schedule is a bit different from the one we saw before. It is
normally disabled, and it&rsquo;s time pattern (in <code>localtime</code>) is
different. The <code>PT</code> prefix specifies that this is a timer which
expires after the given amount of time has passed. In this case, it is
set to one minute (the first 60 seconds of our wake-up will be spent
in minimal lighting). Enabling this schedule starts up the timer. When
one minute is up, another scene will be set.</p>
<p>This one, strangely, is applied to group <code>0</code>, the meta-group including
all lights, but since the scene itself specifies to which lights it
applies, there&rsquo;s no real problem with it.</p>
<h4 id="dot-dot-dot-to-a-fully-lit-room-dot-dot-dot">&hellip; to a fully lit room &hellip;</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">GET http://bridge/api/${username}/scenes/gXdkB1um68N1sZL
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Wake Up end&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;lights&#34;</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;2&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;3&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;5&#34;</span>
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;owner&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;recycle&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;locked&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;appdata&#34;</span><span style="color:#f92672">:</span> {},
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;picture&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;lastupdated&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2018-03-11T19:46:51&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;version&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;lightstates&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;2&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;on&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;bri&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">254</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;ct&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">447</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;transitiontime&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">17400</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;3&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;on&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;bri&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">254</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;ct&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">447</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;transitiontime&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">17400</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;5&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;on&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;bri&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">254</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;ct&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">447</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;transitiontime&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">17400</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This scene transitions the lights to full brightness over the next 29
minutes (1740 seconds), per the specified <code>transitiontime</code> (which is
specified in deciseconds).</p>
<h4 id="dot-dot-dot-which-will-be-switched-off-later-dot">&hellip; which will be switched off later.</h4>
<p>Finally, an additional rule takes care of turning the lights off and
the wake-up sensor at 9:00 (Two and a half hours after the initial
triggering of the sensor).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">GET http://bridge/api/${username}/rules/2
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Wake up 1.end&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;owner&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;created&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2018-03-11T19:46:51&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;lasttriggered&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2018-03-13T13:00:00&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;timestriggered&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;status&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;enabled&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;recycle&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;conditions&#34;</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;address&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/sensors/2/state/flag&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;operator&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;eq&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;value&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;address&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/sensors/2/state/flag&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;operator&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;ddx&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;value&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;PT02:30:00&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;actions&#34;</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;address&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/groups/2/action&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;method&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;PUT&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;body&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;on&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;address&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/sensors/2/state&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;method&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;PUT&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;body&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;flag&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Unlike the first rule, this one doesn&rsquo;t trigger immediately. It has an
additional condition on the sensor state flag using the special <code>ddx</code>
operator, which (given the timer specified) is true <strong>two and a half
hours after</strong> the flag has been set. As the schedule sets it at 6:30,
that means that this rule will trigger at 9:00, turn the lights off in
the bedroom, and set the sensor&rsquo;s flag to <code>false</code>.</p>
<h3 id="where-to-go-from-here">Where to go from here</h3>
<p>The wake-up config in the phone app touched on pretty much every major
aspect of the Hue bridge API. Given the insight I now have into how it
works, I can start constructing my own schedules and transitions, and
playing with different ways of triggering them and even having them
trigger each other.</p>
<p>If I get around to building my rolling sunrise, I&rsquo;ll be sure to get a
post up on it :)</p>
<h2 id="automating-my-apartment-with-home-assistant">Automating My Apartment With Home Assistant</h2>
<p>A while ago, I <a href="/2018/03/13/hue-wake-up.html">posted about</a> my experiments with the Phillips Hue API
to create an automated morning sunrise effect. The end result was
nice, but all that mucking about with their HTTP APIs was a hassle any
time I wanted to tweak something. I wanted to define what I wanted in
a more declarative style, and have all the API calls managed behind
the scenes. <a href="https://www.home-assistant.io/">Home Assistant</a> allowed me to do exactly that, and more.</p>
<p>While the Home Assistant docs are geared heavily towards setting up a
raspberry pi appliance to run everything 24/7, I don&rsquo;t own one, and I
already have a server going. I opted instead to get the home assistant
server running using <a href="https://www.home-assistant.io/docs/installation/docker/">Docker</a>, and setting up a git repository to hold
my configuration.</p>
<h3 id="a-brand-new-day">A Brand New Day</h3>
<p>Setting up my sunrise was actually <em>really</em> easy. I already had the
scenes I wanted from my <a href="/2018/03/13/hue-wake-up.html">previous attempt</a>, so it was just a matter of
codifying them in the YAML config. I split them into four scenes - a
start (dawn) and end (daylight) pair for the standing lamp at the wall
beyond the foot of the bed, and a pair for the two nightstand lights.
The end scenes include the transition time to fade in (30 minutes).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">scene</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Dawn Sun</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">entities</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">light.standing_lamp</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#66d9ef">on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">brightness</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">xy_color</span>: [<span style="color:#ae81ff">0.6042</span>, <span style="color:#ae81ff">0.3739</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Dawn Daylight</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">entities</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">light.correls_nightstand</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#66d9ef">on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">brightness</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">xy_color</span>: [<span style="color:#ae81ff">0.2376</span>, <span style="color:#ae81ff">0.1186</span>]
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">light.stephanies_nightstand</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#66d9ef">on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">brightness</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">xy_color</span>: [<span style="color:#ae81ff">0.2376</span>, <span style="color:#ae81ff">0.1186</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Sunrise Sun</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">entities</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">light.standing_lamp</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#66d9ef">on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">transition</span>: <span style="color:#ae81ff">1800</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">brightness</span>: <span style="color:#ae81ff">254</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">xy_color</span>: [<span style="color:#ae81ff">0.3769</span>, <span style="color:#ae81ff">0.3639</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Sunrise Daylight</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">entities</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">light.correls_nightstand</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#66d9ef">on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">transition</span>: <span style="color:#ae81ff">1800</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">brightness</span>: <span style="color:#ae81ff">203</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">xy_color</span>: [<span style="color:#ae81ff">0.2698</span>, <span style="color:#ae81ff">0.295</span>]
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">light.stephanies_nightstand</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#66d9ef">on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">transition</span>: <span style="color:#ae81ff">1800</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">brightness</span>: <span style="color:#ae81ff">203</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">xy_color</span>: [<span style="color:#ae81ff">0.2698</span>, <span style="color:#ae81ff">0.295</span>]
</span></span></code></pre></div><p>Breaking them apart this way means I can trigger the &ldquo;sun&rdquo; first for a
splash of orange, then start up the nightstand &ldquo;daylight&rdquo; lights a
little bit later! This worked out well, too, since even at the lowest
brightness, having them turn on right at the start when the room is
totally dark had a tendency to jolt me awake. Staggering them produces
a much gentler effect. Scripting all of this took very little work&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">script</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sunrise</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">alias</span>: <span style="color:#ae81ff">Sunrise</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sequence</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">scene.turn_on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">scene.dawn_sun</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">scene.turn_on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">scene.sunrise_sun</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">delay</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">seconds</span>: <span style="color:#ae81ff">180</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">scene.turn_on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">scene.dawn_daylight</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">scene.turn_on</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">scene.sunrise_daylight</span>
</span></span></code></pre></div><p>&hellip; and the end result really is quite pleasant:</p>
<style>.org-center { margin-left: auto; margin-right: auto; text-align: center; }</style>
<div class="org-center">
<p><img src="/ox-hugo/ha-lights-1.png" alt="">
<img src="/ox-hugo/ha-lights-2.png" alt="">
<img src="/ox-hugo/ha-lights-3.png" alt=""></p>
</div>
<p>That just leaves the automation, which fires a half an hour before the
<em>actual</em> sunrise, so long as the lights aren&rsquo;t already on and somebody
is home (using a binary sensor I defined elsewhere based on phones
detected in the house plus an override toggle).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">automation</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">alias</span>: <span style="color:#ae81ff">Sunrise</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">action</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">script.sunrise</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">trigger</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">sun</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">sunrise</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">offset</span>: <span style="color:#e6db74">&#39;-00:30:00&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">condition</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">state</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">binary_sensor.occupied</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#e6db74">&#39;on&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">state</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">group.bedroom_lights</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#e6db74">&#39;off&#39;</span>
</span></span></code></pre></div><p>I later extended the automation with some configuration inputs, which
tie into some new triggers and conditions. I added a &ldquo;latest start
time&rdquo; to make sure it always gets me up in time for me to get ready
for work, and an option to disable the wake-up on weekends.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">input_select</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sunrise_days</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Days to wake up</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">options</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">Every Day</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">Weekdays</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initial</span>: <span style="color:#ae81ff">Every Day</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">icon</span>: <span style="color:#ae81ff">mdi:weather-sunset</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">input_datetime</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sunrise_time</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Latest start time</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">has_date</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">has_time</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initial</span>: <span style="color:#e6db74">&#39;06:30&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">automation</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">alias</span>: <span style="color:#ae81ff">Sunrise</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">action</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">script.sunrise</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">trigger</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">sun</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">sunrise</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">offset</span>: <span style="color:#e6db74">&#39;-00:30:00&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">template</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value_template</span>: &gt;-<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          {{ states(&#39;sensor.time&#39;) == (
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">               states.input_datetime.sunrise_time.attributes.timestamp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">               | int | timestamp_custom(&#39;%H:%M&#39;, False)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             )
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          }}</span>          
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">condition</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">state</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">binary_sensor.occupied</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#e6db74">&#39;on&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">state</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">group.bedroom_lights</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#e6db74">&#39;off&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">or</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">conditions</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">state</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">input_select.sunrise_days</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">state</span>: <span style="color:#ae81ff">Every Day</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">and</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">conditions</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">state</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">input_select.sunrise_days</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">state</span>: <span style="color:#ae81ff">Weekdays</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">time</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">weekday</span>:
</span></span><span style="display:flex;"><span>                  - <span style="color:#ae81ff">mon</span>
</span></span><span style="display:flex;"><span>                  - <span style="color:#ae81ff">tue</span>
</span></span><span style="display:flex;"><span>                  - <span style="color:#ae81ff">wed</span>
</span></span><span style="display:flex;"><span>                  - <span style="color:#ae81ff">thu</span>
</span></span><span style="display:flex;"><span>                  - <span style="color:#ae81ff">fri</span>
</span></span></code></pre></div><p>Sprinkle in some groups, and I&rsquo;ve got a nice panel in my Home
Assistant UI to manage everything:</p>
<figure><img src="/images/ha-sunrise-ui.png"
         alt="Figure 1: The completed sunrise panel"/><figcaption>
            <p><span class="figure-number">Figure 1: </span>The completed sunrise panel</p>
        </figcaption>
</figure>

<h3 id="keep-it-down">Keep It Down!</h3>
<p>Determined to find more things to automate, I realized that since I
have my TV audio going through a Sonos sound bar, I could very easily
automate the rather annoying ritual of leaping for the app on my phone
to turn on night mode when a movie I&rsquo;m watching is getting explodey
and I realize it&rsquo;s a bit late in the evening to be shaking my
neighbor&rsquo;s walls.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">automation</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">alias</span>: <span style="color:#ae81ff">Toggle Sonos night mode</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">action</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">media_player.sonos_set_option</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">media_player.den</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data_template</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">night_sound</span>: &gt;-<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span>            {{ <span style="color:#ae81ff">now().hour &gt;= 22 }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">trigger</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">time</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">at</span>: <span style="color:#e6db74">&#39;22:30:00&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">time</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">at</span>: <span style="color:#e6db74">&#39;08:00:00&#39;</span>
</span></span></code></pre></div><p>Boom. Happier neighbors, and I can fall asleep in front of movies
without worry!</p>
<p>Just because I could, I also added some configurability to this
automation as well. The logic got a bit tricky, since I wanted to
configure a window that crosses a 24-hour boundary. I also added a
binary sensor so I could see when night mode was enabled from Home
Assistant.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">automation</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">alias</span>: <span style="color:#ae81ff">Toggle Sonos night mode</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">action</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">service</span>: <span style="color:#ae81ff">media_player.sonos_set_option</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">entity_id</span>: <span style="color:#ae81ff">media_player.den</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data_template</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">night_sound</span>: &gt;-<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {% set start = states.input_datetime.sonos_nightmode_start.attributes %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {% set end = states.input_datetime.sonos_nightmode_end.attributes %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {% set now_ = (now().hour, now().minute, now().second) %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {% set start_ = (start.hour, start.minute, start.second) %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {% set end_ = (end.hour, end.minute, end.second) %}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {% if start_ &gt; end_ -%}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              {{ now_ &gt;= start_ or now_ &lt; end_ }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {%- else -%}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              {{ now_ &gt;= start_ and now_ &lt; end_ }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {%- endif -%}</span>            
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">trigger</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">template</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value_template</span>: <span style="color:#e6db74">&#34;{{ states(&#39;sensor.time&#39;) == (states.input_datetime.sonos_nightmode_start.attributes.timestamp | int | timestamp_custom(&#39;%H:%M&#39;, False)) }}&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">template</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value_template</span>: <span style="color:#e6db74">&#34;{{ states(&#39;sensor.time&#39;) == (states.input_datetime.sonos_nightmode_end.attributes.timestamp | int | timestamp_custom(&#39;%H:%M&#39;, False)) }}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">sensor</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">time_date</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">display_options</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">time</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">input_datetime</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sonos_nightmode_start</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Start Night Mode</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">has_date</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">has_time</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initial</span>: <span style="color:#e6db74">&#39;22:30&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sonos_nightmode_end</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">End Night Mode</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">has_date</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">has_time</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initial</span>: <span style="color:#e6db74">&#39;08:00&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">binary_sensor</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sensors</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">den_night_mode</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">friendly_name</span>: <span style="color:#ae81ff">Sonos Den Night Mode</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value_template</span>: &gt;-<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          </span>          {{ <span style="color:#ae81ff">state_attr(&#39;media_player.den&#39;, &#39;night_sound&#39;) }}</span>
</span></span></code></pre></div><p>And, voilà, a dashboard for my speakers, which I pretty much never
need to look at anymore!</p>
<figure><img src="/images/ha-sonos-ui.png"/>
</figure>

<h3 id="but-wait-there-s-more">But Wait, There&rsquo;s More!</h3>
<p>It&rsquo;s a too much to cover in a single blog post, but there&rsquo;s plenty
more going on in my config. Over time, I&rsquo;ve tweaked and added to my
device tracking to make sure Home Assistant knows when someone&rsquo;s home.
I set up some text-to-speech to announce the weather in the morning,
and welcome the first person to get home. I even re-purposed an old
phone as a webcam so I can check on the cat while I&rsquo;m out. My config
is on my personal gitlab server, feel free to check it out and see if
there&rsquo;s anything there you can use or learn from:
<a href="http://git.phoenixinquis.net/correlr/home-assistant">http://git.phoenixinquis.net/correlr/home-assistant</a></p>
<h2 id="trans-day-of-visibility-2002">Trans Day of Visibility 2022</h2>
<figure><img src="/ox-hugo/trans-flag-with-symbol.jpg"/>
</figure>

<p>It&rsquo;s hard to feel positive about this year&rsquo;s <a href="https://www.glaad.org/tdov">Transgender Day of Visibility</a>. On
the one hand, trans visibility is extremely important. It&rsquo;s because of out trans
people that I was able to understand my own identity. The more cis people really
see, talk to, and come to understand trans people, the easier it will be for
them to understand that we&rsquo;re, well, just <em>people</em>. Transitioning is a
<em>beautiful</em> thing. Look at any set of photos trans people share, and you&rsquo;ll see
that they&rsquo;re not just happier, but more vibrant, more full of life, and so very
genuinely themselves! This is what folks need to see more of, and what I think
this day is meant to be about. Unfortunately, a lot of what folks are seeing
nowadays isn&rsquo;t trans people thriving, it&rsquo;s misinformation and vitriol. This
isn&rsquo;t at all a new phenomenon, but <a href="https://www.vox.com/first-person/22977970/anti-trans-legislation-texas-idaho">in recent years it&rsquo;s gotten overwhelming</a>.</p>
<p>This year, like last year, has brought with it a <a href="https://freedomforallamericans.org/legislative-tracker/anti-transgender-legislation/">record-breaking amount of
anti-trans legislation across the majority of states in the country</a>. These bills
are targeting trans youths by banning them from playing sports with their peers,
forbidding any discussion about gender or queer identities in their classrooms,
requiring that trusted teachers and other school staff out them to families, and
restricting and even outlawing their healthcare. Book bans have been sweeping
the nation, intent on removing anything they consider unpleasant or
uncomfortable, which has mostly amounted to anything discussing gender,
sexuality, or race. There is a <em>constant</em> stream of vitriol flowing across
social media and news outlets sowing outrage by <a href="https://www.theguardian.com/commentisfree/2018/apr/19/anti-trans-rhetoric-homophobia-trans-rights">recycling old homophobic
rhetoric</a> as they label trans people as predators, anyone supporting us as
&ldquo;groomers&rdquo;, and claim we&rsquo;re forcing children into life-altering surgeries. Trans
kids <a href="https://www.washingtonpost.com/dc-md-va/2021/04/22/transgender-child-sports-treatments/">do not get surgeries</a>, but laws are being pushed and passed banning them
anyway, though always with a note that <a href="https://www.them.us/story/trans-health-care-attacks-target-intersex-people-too">those restrictions aren&rsquo;t extended to
intersex kids</a>, who continue to be operated upon to make their bodies conform to
a comfortable binary.</p>
<p>Trans kids and trans adults alike, whether they&rsquo;re in states that are actively
arguing or passing these bills, <a href="https://www.thedailybeast.com/we-trans-people-will-never-surrender-but-fighting-bigots-is-exhausting?s=09&amp;source=twitter&amp;utm_source=pocket_mylist&amp;via=desktop">are having to endure watching this all happen</a>.
Watching their identities, their <em>existence</em> be debated, questioned, demonized,
and ridiculed. We&rsquo;re having to watch this all unfold, and it really feels like
<a href="https://truthout.org/audio/trans-youth-are-facing-right-wing-attacks-and-a-solidarity-shortage/">few people are actively defending us or standing up to this torrent of hate</a>.
Most of these bills aren&rsquo;t even getting much news coverage, and <a href="https://www.teenvogue.com/story/trans-people-right-wing-media?s=09&amp;utm_source=pocket_mylist">those that are
often aren&rsquo;t in our favor</a>, framing the issues as <a href="https://www.bbc.com/news/uk-43255878">divisive</a> or <a href="https://www.nbcnews.com/nbc-out/out-news/trans-swimmer-lia-thomas-speaks-scrutiny-controversy-rcna18503">controversial</a>. Even
Florida&rsquo;s so-called <a href="https://www.flsenate.gov/Session/Bill/2022/1557">&ldquo;Don&rsquo;t Say Gay&rdquo; bill</a> is framed first and foremost as an
attack on gay rights (which it certainly is), but leaving the very deliberate
targeting of trans kids out of the discussion. Florida governor Ron DeSantis
certainly didn&rsquo;t hide it, <a href="https://www.axios.com/dont-say-gay-bill-desantis-578593fc-5d6e-4098-b69a-c838b017ce24.html">claiming its intent is to squash so-called &ldquo;woke
gender ideology&rdquo;</a> and
<a href="https://www.tampabay.com/news/florida/2022/03/29/grooming-the-buzzword-in-lgbtq-school-debate-including-in-florida/">pointing
at a large illustration from a transgender author&rsquo;s childrens book</a> just before
signing the bill.</p>
<p>It&rsquo;s hard, as a trans person watching all of this, seeing these kids, their
parents, and ourselves under such constant and cruel attack. It&rsquo;s hard hearing
only the faintest murmurs of &ldquo;we&rsquo;ve got your back&rdquo; from the White House as the
Equality Act continues to languish, stalled in Congress. It is hard seeing so
few people outside of the transgender community, traumatized so much by it as it
is, raising any awareness of what&rsquo;s going on. Each year we endure so much. We
watch public figures tell people we&rsquo;re perverts and predators. We watch where we
go and what we do in public, lest we inadvertently draw anyone&rsquo;s ire. We watch
as some trans folks do succeed, and celebrate them, but also see all the
nastiness directed at them in the media and in strangers&rsquo; comments on social
media. All of this is so, so traumatizing.</p>
<p>Ours is a community molded by trauma and loss. Our history, vibrant as it is,
has been largely <a href="https://historycollection.com/16-remarkable-historical-figures-who-were-transgender/">hidden from us</a> or <a href="https://www.teenvogue.com/story/lgbtq-institute-in-germany-was-burned-down-by-nazis">outright destroyed</a>. Nearly an entire
generation of queer people was <a href="https://read.dukeupress.edu/tsq/article/7/4/527/168493/Trans-in-a-Time-of-HIV-AIDS?utm_source=blog&amp;utm_medium=post&amp;utm_campaign=j-TSQ_7-4_Feb2021">lost to hate and apathy during the AIDS epidemic</a>.
Many <a href="https://www.hrc.org/resources/fatal-violence-against-the-transgender-and-gender-non-conforming-community-in-2022">continue to be lost every year to violence</a>. Mostly trans women of color,
losing their lives to hate in the rising tide of racism, misogyny, homophobia
and transphobia. We likely lose far more than we know as crimes go unreported or
misreported, as they tend to be, when trans folks <a href="https://chicago.suntimes.com/2021/11/29/22807775/what-i-learned-about-news-media-law-enforcement-transgender-murders-morgan-sherm-op-ed">get misgendered in death</a>. This
isn&rsquo;t how it&rsquo;s supposed to be. Discovering and living as who we truly are is one
of the most joyful things in life. Being ourselves, <em>really sharing ourselves</em>
with the people we love is such a wonderful, vibrant feeling. That more and more
people are able to learn about the beautiful spectrums of identities is an
amazing thing. We&rsquo;ve got greater resources and representation now than ever
before.</p>
<p>I do not believe that all of this hatred, all of these laws, any of it will win
out in the end. Trans people aren&rsquo;t going anywhere; being trans is just a part
of being human. We have always been here, and we will continue to be. What I
fear isn&rsquo;t that trans people will be wiped off the earth, because that&rsquo;s
impossible. What I do fear is how hard the struggle may remain for us to
continue to just <em>live</em>. I feel for these kids, terrified as they are that the
world hates them. I feel for the trans community, as we struggle with vastly
different degrees of discrimination and violence. It&rsquo;s a lot.</p>
<p>On this Transgender Day of Visibility, I feel it&rsquo;s important that we&rsquo;re not
merely seen, but seen fully. I hope that people will see our joy and our
strength and our fierce love of authentic life. I also hope that people will see
our pain, and find it in themselves to offer not just performative displays of
support but real empathy and action. We&rsquo;re out here showing you who we are and
what we can be. Please show <em>us</em> who <em>you</em> are and what we mean to you.</p>
<p>And, for the love of everything, <a href="https://www.gamespot.com/articles/jk-rowlings-anti-transgender-stance-and-hogwarts-legacy/1100-6501632/?s=09&amp;utm_source=pocket_mylist">please leave Harry Potter in the past</a>.</p>
<h2 id="types-in-python">Types in Python</h2>
<h3 id="why-use-types">Why Use Types?</h3>
<h3 id="success-typing">Success Typing</h3>
<h3 id="running-mypy">Running Mypy</h3>
<h3 id="specifying-types">Specifying Types</h3>
<h2 id="strangeloop-2018">Conference Notes: Strangeloop 2018</h2>
<h3 id="wednesday">Wednesday</h3>
<h4 id="richard-feldman">Richard Feldman</h4>
<p><span class="timestamp-wrapper"><span class="timestamp">2018-09-26 Wed 09:00–2018-09-26 Wed 09:30</span></span></p>
<ul>
<li>Dictionaries as tables</li>
</ul>
<h4 id="grant-maki-facilitating-technology-change-through-cultural-change">Grant Maki: Facilitating Technology Change Through Cultural Change</h4>
<p><span class="timestamp-wrapper"><span class="timestamp">2018-09-26 Wed 09:40–2018-09-26 Wed 10:10</span></span></p>
<ul>
<li>Trying things in teams</li>
<li>Tech lead impostor syndrome</li>
<li>Empathizing with fear, skepticism, and choice overload</li>
</ul>
<div class="NOTES">
<p>Very interesting talk from a tech lead position. Grant emphasized
building <em>shared</em> experiences, and approaching adoption of new tools
and ideas with empathy for the feelings of each team member.</p>
</div>
<h4 id="ravi-chugh-structured-editing-for-elm-in-elm">Ravi Chugh: Structured Editing for Elm in Elm</h4>
<p><span class="timestamp-wrapper"><span class="timestamp">2018-09-26 Wed 10:40–2018-09-26 Wed 11:10</span></span></p>
<ul>
<li>&ldquo;Sketch-n-Sketch&rdquo;</li>
<li>Structured code editor &ldquo;Deuce&rdquo;
<ul>
<li>Shows AST on code</li>
<li>Apply context-aware transformations to the AST</li>
</ul>
</li>
<li>Type inspector mode</li>
<li>Supports holes</li>
<li>Live feedback for incomplete programs</li>
<li><a href="https://hazel.org">https://hazel.org</a> - Holes for incomplete code (Cyrus Omar)
<ul>
<li>Friday Strangeloop talk</li>
</ul>
</li>
</ul>
<h4 id="anthony-deschamps-programming-robots-with-elm">Anthony Deschamps: Programming Robots with Elm</h4>
<p><span class="timestamp-wrapper"><span class="timestamp">2018-09-26 Wed 11:30–2018-09-26 Wed 12:00</span></span></p>
<dl>
<dt><a href="https://www.ev3dev.org">EV3DEV</a></dt>
<dd>Debian distribution for LEGO Mindstorms</dd>
</dl>
<p>Robotics is about perception, behavior, and control</p>
<dl>
<dt><code>PLatform.Worker</code></dt>
<dd>Application sans view function</dd>
</dl>
<h4 id="matthew-griffith-building-a-toolkit-for-design">Matthew Griffith: Building a Toolkit for Design</h4>
<p><span class="timestamp-wrapper"><span class="timestamp">2018-09-26 Wed 13:00–2018-09-26 Wed 13:30</span></span></p>
<ul>
<li>Legos
<ul>
<li>Everything fits together</li>
<li>Easy to build</li>
<li>Easy to change</li>
</ul>
</li>
<li>CSS
<ul>
<li>Dependent on lots of external factors</li>
<li>Lots of gotchas</li>
</ul>
</li>
<li><a href="https://package.elm-lang.org/packages/mdgriffith/elm-ui/latest">mdgriffith/elm-ui</a> (<a href="https://elm-ui.netlify.com/">Website</a>)</li>
<li>Palettes
<ul>
<li>Consists of
<ul>
<li>Colors</li>
<li>Spacing</li>
<li>Typography</li>
</ul>
</li>
<li>A concise set of style rules (~50 max)</li>
</ul>
</li>
<li>Each property defines its own tests, which can be run in arbitrary
environments</li>
<li>Design systems</li>
</ul>
<h4 id="dillon-kearns-extending-type-safety-beyond-elm-s-borders">Dillon Kearns: Extending Type Safety Beyond Elm&rsquo;s Borders</h4>
<p><span class="timestamp-wrapper"><span class="timestamp">2018-09-26 Wed 13:40–2018-09-26 Wed 14:10</span></span></p>
<ul>
<li>Addressing &ldquo;avoidable uncertainty&rdquo;</li>
<li><a href="https://github.com/dillonkearns/elm-graphql">dillonkearns/elm-graphql</a>
<ul>
<li>Generates code from a specification</li>
</ul>
</li>
<li><a href="https://github.com/dillonkearns/elm-typescript-interop">dillonkearns/elm-typescript-interop</a>
<ul>
<li>Generates TypeScript type declarations for elm ports and flags</li>
</ul>
</li>
<li><a href="https://bit.ly/typeswithoutborders">https://bit.ly/typeswithoutborders</a></li>
</ul>
<h4 id="sam-row-complex-animations-done-well">Sam Row: Complex Animations Done Well</h4>
<p><span class="timestamp-wrapper"><span class="timestamp">2018-09-26 Wed 14:40–2018-09-26 Wed 15:10</span></span></p>
<ul>
<li>Easings
<ul>
<li>Tracks starting and target state</li>
<li>Animation updates will be jarring if the target state changes</li>
</ul>
</li>
<li>Springs
<ul>
<li>Tracks current position and velocity, and target state</li>
</ul>
</li>
<li>Decoupling animation logic from business logic
<ul>
<li>Separate models for application state and visual state</li>
</ul>
</li>
</ul>
<h4 id="alley-kelly-mcknight-naming-things-in-elm">Alley Kelly McKnight: Naming Things in Elm</h4>
<p><span class="timestamp-wrapper"><span class="timestamp">2018-09-26 Wed 15:20–2018-09-26 Wed 15:50</span></span></p>
<ul>
<li>Categories for naming rules
<ul>
<li>Naming conventions</li>
<li>Guiding lights</li>
</ul>
</li>
<li>What makes a name good?
<ul>
<li>Does the name keep us in the process flow?</li>
<li>Does the name help the reader build an accurate mental model of
the code?</li>
<li>Does the reader know accurately what the thing you&rsquo;re naming is?</li>
</ul>
</li>
<li>The Mental Model: Our Human Narrative</li>
</ul>
<div class="NOTES">
<p>The idea of using names to allow functions to flow as a narrative is
an interesting one, as is maintaining a consistent metaphor
throughout.</p>
</div>
<h4 id="tereza-sokol-demystifying-parsers">Tereza Sokol: Demystifying Parsers</h4>
<p><span class="timestamp-wrapper"><span class="timestamp">2018-09-26 Wed 16:00–2018-09-26 Wed 16:30</span></span></p>
<ul>
<li><a href="https://package.elm-lang.org/packages/elm/parser/latest">elm/parser</a></li>
<li>Includes support for building useful error messages
<ul>
<li><code>problem : String -&gt; Parser a</code></li>
</ul>
</li>
</ul>
<div class="NOTES">
<p>I&rsquo;ve enjoyed using Haskell&rsquo;s Parsec library in the past, as well as
<code>boost::spirit</code> in C++ back when I first dipped my toes into EBNF
grammars. This will be interesting to play with when I can come up
with a reason to 😊.</p>
</div>
<h3 id="thursday">Thursday</h3>
<h4 id="shaping-our-children-s-education-in-computing">Shaping our children&rsquo;s education in computing</h4>
<p><span class="timestamp-wrapper"><span class="timestamp">2018-09-27 Thu 09:10–2018-09-27 Thu 10:00</span></span></p>
<ul>
<li>Project quantum (questions)</li>
<li>Teals (high schools)</li>
<li>Csteachers org</li>
<li>Raspberry Pi foundation</li>
<li>Education is rife with unintended consequences - be humble,
cooperative</li>
</ul>
<h4 id="zero-downtime-migrations-of-stateful-systems">Zero Downtime Migrations of Stateful Systems</h4>
<p><span class="timestamp-wrapper"><span class="timestamp">2018-09-27 Thu 10:20–2018-09-27 Thu 11:00</span></span></p>
<ul>
<li>
<p>Three different types of migrations</p>
<ul>
<li>perceived zero Downtime</li>
<li>actually zero Downtime</li>
<li>no migration of state</li>
</ul>
</li>
<li>
<p>Perceived Zero Downtime</p>
<ul>
<li>Migrating existing records
<ul>
<li>constant syncing</li>
<li>incremental</li>
</ul>
</li>
<li>Building confidence
<ul>
<li>automated reconciliation and checks</li>
<li>row counts</li>
<li>test environment</li>
</ul>
</li>
<li>Decouple interactions
<ul>
<li>allow reads</li>
<li>replay writes</li>
</ul>
</li>
<li>Migration
<ul>
<li>switch writes to queue</li>
<li>wait for sync to complete</li>
<li>switch database</li>
<li>replay queue</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Actual zero Downtime</p>
<ul>
<li>load snapshot</li>
<li>dual writes</li>
<li>metrics on any issues</li>
</ul>
</li>
<li>
<p>No migration</p>
<ul>
<li>new service built aware of legacy system</li>
<li>older data expires</li>
<li>run in tandem</li>
<li>delegate to legacy system when needed</li>
<li>test with dual writes</li>
<li>monitoring
<ul>
<li>unexpected behaviors</li>
<li>absent expected state</li>
</ul>
</li>
<li>slow roll-out</li>
</ul>
</li>
</ul>
<h4 id="chasing-the-stream-processing-utopia">Chasing the Stream Processing Utopia</h4>
<p><span class="timestamp-wrapper"><span class="timestamp">2018-09-27 Thu 11:20–2018-09-27 Thu 12:00</span></span></p>
<ul>
<li>Architecture
<ul>
<li>Ingestion (various sources)</li>
<li>Processing (using Apache Samza)</li>
</ul>
</li>
<li>Complexity
<ul>
<li>Stateless processing (filtering, <em>data enrichment</em>)</li>
<li>Stateful processing (aggregation)
<ul>
<li>Windowing</li>
<li>Beam processing model</li>
</ul>
</li>
</ul>
</li>
<li>Accuracy
<ul>
<li>Exactly once processing
<ul>
<li>Ingestion (de-dupe)</li>
<li>Pipelined processing (Chandy Lamport)</li>
<li>Storing results (idempotent writes / de-dupe)</li>
</ul>
</li>
</ul>
</li>
<li>Scale
<ul>
<li>Scaling ingestion
<ul>
<li>Managed by cloud services, or yourself when self-hosting</li>
</ul>
</li>
<li>Scaling processing
<ul>
<li>Challenges
<ul>
<li>horizontal scaling</li>
<li>limited to least performant component</li>
</ul>
</li>
<li>Typical bottlenecks
<ul>
<li>data access
<ul>
<li>accessing adjunct data (databases, services)</li>
<li>managing temporary state</li>
</ul>
</li>
<li>CPU</li>
</ul>
</li>
</ul>
</li>
<li>Any source (including batch sources, HDFS)</li>
<li>Any language</li>
<li>Anywhere
<ul>
<li>Stream processing as a service</li>
</ul>
</li>
<li>Awesome tools
<ul>
<li>Schema management
<ul>
<li>Schema evolution</li>
</ul>
</li>
<li>ACL management</li>
<li>Topic management</li>
<li>Stream Processing Job Management</li>
<li>Data Lineage (e.g. Apache Atlas)</li>
<li>Monitoring
<ul>
<li>Ingestion (e.g. Kafka Monitor)</li>
<li>Job Progress (e.g. Burrow)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="rosie-pattern-language">Rosie Pattern Language</h4>
<p><span class="timestamp-wrapper"><span class="timestamp">2018-09-27 Thu 13:30–2018-09-27 Thu 14:10</span></span></p>
<ul>
<li>Reasoning
<ul>
<li>Regular expressions do not scale</li>
</ul>
</li>
<li>Combing through data to get devops insights</li>
<li>libraries of named and namespaced expressions</li>
<li>RPL syntax looks like a programming language
<ul>
<li>reads/diffs like code</li>
<li>executable unit tests</li>
<li>macros</li>
</ul>
</li>
<li>RPL expressions compose</li>
<li>RPL is based on parsing expression crammers, which are greedy and possessive
<ul>
<li>makes it difficult to be accidentally inefficient</li>
<li>Allows parsing recursive grammars</li>
</ul>
</li>
<li>Logstash (Grok) uses pattern libraries</li>
<li>Can your &lsquo;grep&rsquo; do this?
<ul>
<li><code>curl -s www.google.com | rosie grep -o subs net.url_common</code>
<ul>
<li>Prints all matching URL sub-expressions</li>
</ul>
</li>
<li><code>sed -n 46,49p /var/log/system.log | rosie match all.things</code>
<ul>
<li><code>all.things</code> represents a disjunction of a variety of things,
different pattern matches will be color-coded</li>
</ul>
</li>
<li><code>head -n 1 /var/log/system.log | rosie grep -o jsonpp num.denoted_hex</code>
<ul>
<li>JSON-structured output</li>
</ul>
</li>
</ul>
</li>
<li>Formal basis
<ul>
<li>Chomsky hierarchy
<ul>
<li>regular - context-free - context-sensitive - recursively enumerable</li>
<li>RPL (and all PEG grammars) are context-sensitive</li>
</ul>
</li>
</ul>
</li>
<li>Shares <em>some</em> similarities with regular expressions
<ul>
<li>repetition (same syntax, greedy and possessive)</li>
<li>character sets (simplified syntax, one name or list or range at a
time)</li>
<li>Operations (look-ahead, negation, etc.) (simplified syntax)</li>
<li>&ldquo;choice&rdquo; differs, <code>/</code> is ordered choice, possessive)</li>
</ul>
</li>
<li>Ships with a standard library</li>
<li>Debugging
<ul>
<li>Trace a mismatch
<ul>
<li><code>echo '17:30:4' | rosie trace time.rfc3339</code></li>
</ul>
</li>
<li>REPL!</li>
</ul>
</li>
<li>Uses
<ul>
<li>IBM uses rosie in a big-data pipeline</li>
<li>Mining source code repositories</li>
<li>NCSU students wrote RPL patterns to extract language features from
different languages (including bash!)</li>
<li>White-listing valid input (protecting against injection attacks
per OWASP)</li>
<li>Python bindings! (also, c, go), more coming
<ul>
<li>Not very &ldquo;pythonic&rdquo;, currently</li>
</ul>
</li>
</ul>
</li>
<li>Resources
<ul>
<li><a href="http://rosie-lang.org/">http://rosie-lang.org/</a></li>
<li><a href="https://www.gitlab.com/rosie-pattern-language/rosie">rosie-pattern-language/rosie</a></li>
</ul>
</li>
</ul>
<h4 id="architecting-for-active-active-resiliency-in-the-cloud">Architecting for Active-Active Resiliency in the Cloud</h4>
<p><span class="timestamp-wrapper"><span class="timestamp">2018-09-27 Thu 14:30–2018-09-27 Thu 15:10</span></span></p>
<ul>
<li>Data and Service resiliency and durability</li>
<li>Basics (Ingredients)
<ul>
<li>Availability (normal operation time / total time)
<ul>
<li>mean time between failure (MTBF) / mean time to repair (MTTR)</li>
<li>Multiple components in series (<code>x</code> and <code>y</code>) (A = Ax * Ay)
<ul>
<li>Availability decreases</li>
</ul>
</li>
<li>Multiple components in parallel (multiple services <code>x</code>)  (A = 1 - (1 - Ax)^2
<ul>
<li>Availability increases</li>
</ul>
</li>
<li>Basic Active Architecture
<ul>
<li>Web -&gt; App -&gt; DB
<ul>
<li>cheap, simple, fast to market</li>
<li>manual intervention, low resiliency, high potential rework</li>
</ul>
</li>
</ul>
</li>
<li>Basic Active-Passive Architecture
<ul>
<li>Load balanced app with fail-over nodes / read-replica db</li>
<li>Hot or cold standby</li>
<li>decreased downtime, - backup services &amp; data,  good balance</li>
<li>increased costs, complexity, potential for data loss</li>
</ul>
</li>
<li>Basic Active-Active Architecture #1
<ul>
<li>Multiple instances taking traffic simultaneously</li>
<li>always on, minimum data loss, zero intervention</li>
<li>limited tools, most complex, most expensive</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Considerations &amp; trade-offs (Appetizers)
<ul>
<li>Data Replication
<ul>
<li>Active-Active (avoid this)
<ul>
<li>multiple master databases synchronizing
<ul>
<li>collisions</li>
<li>latency</li>
</ul>
</li>
</ul>
</li>
<li>Active-Passive
<ul>
<li>Multiple instances writing to a single data store
<ul>
<li>promote a read replica on failure</li>
<li>Active-Active at the service level, Active-Passive at the
data level</li>
</ul>
</li>
</ul>
</li>
<li>Easy data replication databases (managed)
<ul>
<li>Cloud Spanner</li>
<li>Cosmos</li>
<li>Aurora</li>
</ul>
</li>
<li>Easy data replication databases (not managed)
<ul>
<li>Apache Cassandra</li>
<li>MySQL</li>
</ul>
</li>
</ul>
</li>
<li>Considering tenants - what are we failing over?
<ul>
<li><em>Similar to considering restart strategies in OTP supervision
trees</em></li>
</ul>
</li>
<li>As availability and durability increases, so does complexity and cost</li>
</ul>
</li>
<li>Resiliency patterns (The Entrees)
<ul>
<li>Circuit breaker (stop retrying)</li>
<li>Exponential back-off (slow down retries)</li>
<li>Fallback (error response or cache)</li>
<li>Multiple instances in different availability zones within a
region</li>
<li>Worker queues and streams decouple components</li>
<li>Patterns can be combined</li>
</ul>
</li>
<li>Tools and services (The Desserts)
<ul>
<li>Chaos Monkey</li>
<li>Serverless</li>
</ul>
</li>
</ul>
<div class="NOTES">
<p>It&rsquo;s important to prepare for failure, and balancing availability and
consistency is always a balancing act.</p>
<p>For failure, I like to map out services and their dependency as I
would an Erlang supervision tree, drawing boundaries around tightly
coupled components, and defining the failure strategy for each group.</p>
</div>
<h4 id="towards-language-support-for-distributed-systems">Towards Language Support for Distributed Systems</h4>
<p><span class="timestamp-wrapper"><span class="timestamp">2018-09-27 Thu 15:30–2018-09-27 Thu 16:10</span></span></p>
<blockquote>
<p>Research is very animated! (doesn&rsquo;t look like it from the outside)</p>
</blockquote>
<ul>
<li>Language support for distributed system = ways that the programming
language/compiler can aid in the development of a distributed application</li>
<li>Some areas of research
<ul>
<li>Consistency &amp; Programming Models
<ul>
<li>Consistency?
<ul>
<li>Specifically programming models that provide some kind of
consistency guarantee (e.g, what guarantees do I have for a
replica of an object/datum?)</li>
<li>Sometimes weak consistency is good enough</li>
</ul>
</li>
<li>Conflict-free replicated data types (CRDTs)
<ul>
<li>Lasp: A Language for Distributed, Coordination-Free
Programming</li>
</ul>
</li>
<li>Spry is a programming model for building applications that want
to trade-off availability and consistency at varying points in
application code to support application requirements (CA in CAP)</li>
<li>Mixed consistency via &ldquo;Correctables&rdquo; (Incremental Consistency
Guarantees for Replicated Objects)
<ul>
<li>Give the user different APIs depending on the sort of
consistency they&rsquo;re after
<ul>
<li><code>invokeWeak(operation)</code></li>
<li><code>invokeStrong(operation)</code></li>
<li><code>invoke(operation[, levels])</code></li>
</ul>
</li>
</ul>
</li>
<li>Mixed consistency via &ldquo;MixT&rdquo; (<a href="http://www.cs.cornell.edu/andru/papers/mixt/mixt.pdf">MixT: A Language for Mixing
Consistency in Geodistributed Transactions</a>)
<ul>
<li>Answers the question of what if we want to choice from
multiple consistency options in one application</li>
</ul>
</li>
</ul>
</li>
<li>Session Types
<ul>
<li>Can be though of as types for communication protocols</li>
<li>Many variants of session types
<ul>
<li>Binary &amp; Multiparty (# of parties)</li>
<li>Static &amp; Dynamic</li>
</ul>
</li>
<li><a href="http://simonjf.com/2016/05/28/session-type-implementations.html">Introduction to session types by Simon Fowler</a></li>
<li>Prototypes of session types are implemented for many languages
<ul>
<li><strong>Erlang:</strong> monitored-session-erlang</li>
<li><strong>Python:</strong> <a href="https://www.doc.ic.ac.uk/~rn710/spy/main.pdf">SPY</a></li>
<li><strong>Haskell:</strong> effect-sessions</li>
<li><strong>Scala:</strong> Ichannels</li>
<li><strong>Java:</strong> Scribble</li>
</ul>
</li>
</ul>
</li>
<li>Static Analysis &amp; Verification</li>
<li>Others
<ul>
<li>Whip (<a href="https://people.seas.harvard.edu/~chong/pubs/icfp17-whip.pdf">Higher-Order Contracts for Microservices</a>)</li>
<li><a href="http://unisonweb.org">Unison</a>
<ul>
<li>Haskell-like language for moving computations around</li>
</ul>
</li>
<li>Syndicate (<a href="https://www2.ccs.neu.edu/racket/pubs/dissertation-garnock-jones.pdf">Conversational Concurrency</a>)</li>
<li>ML5 (<a href="http://www.cs.cmu.edu/~tom7/papers/modal-types-for-mobile-code.pdf">Modal Types for Mobile Code</a>)</li>
<li>Function-Passing (<a href="https://infoscience.epfl.ch/record/230304/files/fp-jfp.pdf">A Programming Model and Foundation for
Lineage-Based Distributed Computation</a>)</li>
</ul>
</li>
<li>Birds-eye view of fringe projects
<ul>
<li><a href="http://christophermeiklejohn.com/publications/hotedge-2018-containers-preprint.pdf">Verifying Interfaces Between Container-Based Components (Or&hellip; A
Type System By Any Other Name)</a>
<ul>
<li>Rejected 😅</li>
</ul>
</li>
<li>Statically ensuring that microservices satisfy invariants -
Adelbert Chang</li>
<li>Statically ensuring that functions on replicated data are
monotone - Kevin Clancy</li>
<li>Fault-Tolerant Functional Reactive Programming (Functional
Pearl)</li>
</ul>
</li>
</ul>
</li>
<li>Resources
<ul>
<li><a href="http://bit.ly/dist-prog-refs">http://bit.ly/dist-prog-refs</a></li>
</ul>
</li>
</ul>
<h4 id="keynote-erica-joy-baker-changing-the-world">Keynote: Erica Joy Baker - Changing the World</h4>
<p><span class="timestamp-wrapper"><span class="timestamp">2018-09-27 Thu 16:30–2018-09-27 Thu 17:20</span></span></p>
<ul>
<li>Passionate about talking about diversity and inclusion</li>
<li>It seems that everyone wants to &ldquo;change the world&rdquo;</li>
<li>&ldquo;We did it! &hellip; Mission accomplished, in the words of George Bush.
We changed the world&rdquo;</li>
<li>&ldquo;We got so focused on disruption that we didn&rsquo;t stop to think about
who or what we were disrupting&rdquo;</li>
<li>Recommends watching &ldquo;Halt and Catch Fire&rdquo;</li>
<li>&ldquo;Silicon Valley is Venture Capital&rdquo;
<ul>
<li>Story of &ldquo;The Scorpion and the Frog&rdquo;</li>
<li>The VCs are the scorpions &ldquo;in case that wasn&rsquo;t clear&rdquo;.</li>
</ul>
</li>
<li>Steps to change the world
<ol>
<li>Have an idea</li>
<li>Grow your ideas slowly.</li>
<li>Get customers</li>
<li>Get some more of them</li>
<li>Keep going</li>
<li>Build what you want to build on your own terms.</li>
</ol>
</li>
<li>Mailchimp is a sponsor (bleh), has no VC funding</li>
<li>We have to ask ourselves, &ldquo;I can do this, but should I do this?&rdquo;</li>
<li>&ldquo;How we&rsquo;re going to change the world is by the legacy we leave
behind.&rdquo;</li>
<li>&ldquo;We must build companies that represent everyone, and all
experiences.&rdquo;</li>
<li>Call to action: If you work in a company that you know is doing
something harmful, that you have averted your eyes from, now is the
time to speak up and do something.</li>
<li>Change the world, just make sure you&rsquo;re changing it for the better.</li>
</ul>
<h3 id="friday">Friday</h3>
<h4 id="all-the-languages-together">All the Languages Together</h4>
<p><span class="timestamp-wrapper"><span class="timestamp">2018-09-28 Fri 09:10–2018-09-28 Fri 10:00</span></span></p>
<ul>
<li>Different languages have different strengths</li>
<li>Multi-Language software is hard
<ul>
<li>FFI/JNI</li>
<li>microservices</li>
</ul>
</li>
<li>Can we allow reasoning about interop at the source level?
<ul>
<li>As opposed to running code and encountering errors / debugging</li>
</ul>
</li>
<li>Language specifications are incomplete - don&rsquo;t account for linking
<ul>
<li>&rsquo;escape hatches&rsquo; (ML/C FFI, Rust/unsafe, Java/JNI)</li>
<li>We tell programmers to &ldquo;be careful&rdquo;</li>
</ul>
</li>
<li>Rethink PL Design: Principled FFIs
<ul>
<li>Design <strong>linking types</strong> extensions that support safe
interoperability with other languages
<ul>
<li>linear types (similar to rust ownership)</li>
<li>pure (terminating) functions</li>
</ul>
</li>
<li>Only need linking type extensions to interact with
<strong>behavior/features inexpressible</strong> in your language</li>
<li><a href="https://arxiv.org/abs/1711.04559">Linking Types for Multi-Language Software: Have Your Cake and Eat It Too</a></li>
<li>Reasoning about refactoring
<ul>
<li>Let the programmer specify, do I want to only link with pure
code? Allow linking with stateful code?</li>
</ul>
</li>
<li>Minimal annotation burden
<ul>
<li>Provide a default translation (e.g, a pure language defaults to
linking pure code, not stateful)</li>
</ul>
</li>
</ul>
</li>
<li>Catching cross-language type errors
<ul>
<li>What happens if the linked code doesn&rsquo;t have linking type
annotations?</li>
<li>Type-preserving compilation
<ul>
<li>Provide specifications of code invariants that can be checked at
link time
<ul>
<li><a href="https://www.cs.princeton.edu/~dpw/papers/tal-toplas.pdf">From System F to Typed Assembly Language</a></li>
</ul>
</li>
</ul>
</li>
<li>Cross-language type errors
<ul>
<li>Fail linking if target (compiled) types don&rsquo;t match</li>
</ul>
</li>
</ul>
</li>
<li>Refactoring-Preserving Compilation
<ul>
<li>Also known as <em>equivalence-preserving compilation</em>, <em>fully
abstract compilation</em>, and <em>secure compilation</em></li>
<li>Specifying a non-default linking type means giving up some
refactoring patterns</li>
<li>Programmer gets to decide what refactorings matter to them; LT
annotations tell the compiler what linking to allow/disallow</li>
<li>Linking types are the escape hatch</li>
</ul>
</li>
<li>Ongoing work
<ul>
<li>Mulberry Project
<ul>
<li>Building linking types to interop ML with Rust</li>
<li>Building linking types for a pure language</li>
<li>Building on top of web assembly (generating a richly typed Wasm
with state/effect encapsulation)</li>
</ul>
</li>
<li>What about untyped languages (Scheme, C)?
<ul>
<li><em>Untyped</em> Wasm (gradual typing)</li>
<li><strong>control</strong> linking type</li>
</ul>
</li>
</ul>
</li>
<li><a href="http://silc.ccs.neu.edu">SILC - Secure Interoperability, Languages &amp; Compilers</a></li>
</ul>
<h4 id="leverage-vs-dot-autonomy-in-a-large-software-system">Leverage vs. Autonomy in a Large Software System</h4>
<p><span class="timestamp-wrapper"><span class="timestamp">2018-09-28 Fri 10:20–2018-09-28 Fri 11:00</span></span></p>
<ul>
<li>Big company problems
<ul>
<li>How do you make good use of hundreds of software engineers to
build a large system?</li>
<li>How do you organize a large software system so hundreds of
engineers working on it can avoid wasting their time?</li>
</ul>
</li>
<li>Andy grove on org structure (High Output Management)
<ul>
<li>functional team - increased leverage</li>
<li>mission-oriented team - increased speed
<ul>
<li>speed is the only advantage</li>
</ul>
</li>
</ul>
</li>
<li>Conway&rsquo;s Law
<ul>
<li>Software tends to look like the organization that built it</li>
</ul>
</li>
<li>Coplein&rsquo;s Law
<ul>
<li>If your software doesn&rsquo;t look like your organization, you&rsquo;ve got
trouble</li>
</ul>
</li>
<li>Leverage vs Autonomy
<ul>
<li>centralized systems - increased leverage</li>
<li>decentralized systems - increased autonomy</li>
<li>poor leverage - waste time reinventing wheels</li>
<li>poor autonomy - waste time waiting on other teams</li>
</ul>
</li>
<li>Costs of autonomy/decentralization
<ul>
<li>difficult to make global improvements</li>
<li>difficult to make cross-cutting changes</li>
<li>uncontrolled system complexity (little consistency)</li>
</ul>
</li>
<li>Costs of leverage/centralization
<ul>
<li>single points of failure / monoculture risk</li>
<li>arcade knowledge (downside of knowledge specialization)</li>
<li>uncontrolled system complexity (poor modularity)</li>
</ul>
</li>
<li>sweet spot: cluster scheduling
<ul>
<li>increased leverage, removed repetitive operational work</li>
<li>most customers want roughly the same thing</li>
<li>no important loss of autonomy</li>
<li>global system improvement (upgrades)</li>
<li>bugs (very rarely) bring down multiple services</li>
</ul>
</li>
<li>sweet spot: finagle as theft service framework
<ul>
<li>high leverage</li>
<li>most customers want roughly the same thing</li>
<li>no important loss of autonomy</li>
<li>difficult to debug</li>
</ul>
</li>
<li>sour patch: monolithic service
<ul>
<li>lots of autonomy problems (major development choke-point)</li>
<li>poor sense of ownership</li>
<li>very easy to cause cross-cutting bugs</li>
<li>single ci/deploy pipeline
<ul>
<li>easy to make cross-cutting changes</li>
</ul>
</li>
<li>good leverage</li>
</ul>
</li>
<li>sweet spot: service oriented architecture
<ul>
<li>autonomy is really good</li>
<li>every project needs its own ci/deployment pipeline</li>
<li>difficult to cause cross-cutting bugs</li>
<li>good ownership</li>
<li>code is very modularized</li>
<li>leverage is low</li>
<li>difficult to make cross-cutting changes</li>
</ul>
</li>
<li>sour patch: cross-service application logic library
<ul>
<li>where to put cross-cutting logic? attempted a shared library,
embedded in a variety of separate services</li>
<li>low autonomy (lots of services to deploy with changes)</li>
<li>bad ownership (which team owns this?)</li>
</ul>
</li>
<li>sour patch: unowned services
<ul>
<li>consequence of autonomy
<ul>
<li>services get lost in the shuffle between teams</li>
</ul>
</li>
</ul>
</li>
<li>sour patch: ad-hoc service platform
<ul>
<li>building stuff into existing services, rather than creating a new
one
<ul>
<li>caused by an aversion to build a whole new service</li>
<li>&ldquo;What&rsquo;s the fastest way I can get this piece of work done?&rdquo;</li>
</ul>
</li>
<li>owners of the code get a lot of leverage, but lose a lot of
autonomy</li>
</ul>
</li>
<li>Strato: platform for microservices
<ul>
<li>monolithic service that hosts services inside of it</li>
<li>captures some common patterns (e.g., a data store with a cache in
front of it, etc.)</li>
<li>Goal is to split the systems concerns from the applications
themselves (e.g., timeouts, retries, etc.)</li>
<li>Microservices within are isolated, allows modularity</li>
<li>a lot easier for the code structure to match the organization
structure</li>
</ul>
</li>
<li>Thrift RPC
<ul>
<li>communication between services is structurally typed</li>
<li>&ldquo;compatibility&rdquo; relation between types makes upgrades easier</li>
</ul>
</li>
<li>StratoQL: a DSL for microservices
<ul>
<li>structurally typed</li>
<li>native support for thrift data</li>
<li>transparent concurrency (cf. Haxl (previous Sl talk))</li>
<li>large gain in leverage over separate microservices
<ul>
<li>captures common infrastructure patterns in configuration</li>
</ul>
</li>
<li>autonomy for application logic owners</li>
<li>many customers want roughly the same thing</li>
<li>complicated interface</li>
<li>centralized team a bottleneck</li>
<li>difficult to debug</li>
<li>downtime affects many microservices</li>
</ul>
</li>
</ul>
<h2 id="abstractions-ii">Conference Notes: Abstractions II</h2>
<h3 id="day-one">Day One</h3>
<h4 id="kill-all-mutants">Kill All Mutants</h4>
<dl>
<dt>Speaker</dt>
<dd>Dave Aronson</dd>
<dt>Slides</dt>
<dd><a href="https://bit.ly/kill-mutants-abstractions-2019">https://bit.ly/kill-mutants-abstractions-2019</a></dd>
</dl>
<!--listend-->
<ul>
<li>Mutation testing
<ul>
<li>mutates code with the goal of generating test failures</li>
<li>checks for meaningful code and strict tests</li>
<li>each change to our code should make at least one test fail</li>
<li>at least one unit test failing on a mutation is &ldquo;killing the mutant&rdquo;</li>
<li>First proposed in Richard Lipton&rsquo;s &ldquo;Fault Diagnoses of computer
programs&rdquo; (1971)</li>
<li>Difficult to interpret results, and very CPU intensive</li>
<li>Python - cosmic-ray, mutmut, xmutant</li>
<li>JS - stryker</li>
</ul>
</li>
</ul>
<h4 id="maintaining-a-legacy-haskell-app-as-not-yet-experts">Maintaining a Legacy Haskell App as Not-Yet-Experts</h4>
<dl>
<dt>Speaker</dt>
<dd>Libby Horacek</dd>
<dt>Slides</dt>
<dd><a href="https://slides.com/emhoracek/haskell-24">https://slides.com/emhoracek/haskell-24</a></dd>
</dl>
<!--listend-->
<ul>
<li>Migrated from a haskell app in in frames within wordpress to a
haskell app serving wordpress content via the wordpress api</li>
<li>The &ldquo;Genius-Oh-No Cycle&rdquo;</li>
<li>Chesterton&rsquo;s Fence
<ul>
<li>Understand why a thing is the way it is before you try to change
it</li>
</ul>
</li>
<li>~3% of functional programmers are women</li>
<li>Things that helped
<ul>
<li>Pair programming</li>
<li>TDD (invert the cycle)</li>
<li>RFCs
<ul>
<li>Can be totally casual</li>
<li>Sketch out a larger idea and ask for input from the team</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="measuring-the-human-impact-of-software-best-practices-a-story-of-css-and-empathy">Measuring the Human Impact of Software Best Practices: A Story of CSS and Empathy</h4>
<dl>
<dt>Speaker</dt>
<dd>jnf</dd>
<dt>Twitter</dt>
<dd>@_jnf</dd>
<dt>Slides</dt>
<dd><a href="https://speakerdeck.com/jnf/measuring-the-human-impact-of-software-best-practices-a-story-of-css-and-empathy">https://speakerdeck.com/jnf/measuring-the-human-impact-of-software-best-practices-a-story-of-css-and-empathy</a></dd>
</dl>
<!--listend-->
<ul>
<li>&ldquo;The Tyranny of Pay-as-you-go Internet&rdquo;</li>
<li>Worked at Mighty Ai (training data as a service), acquired by Uber</li>
<li>Stuff in the talk happened before Uber</li>
<li>microaggressions and microaffirmations
<ul>
<li>&ldquo;you guys&rdquo; vs. (friends, folks, participants, peeps, illustrious
heroes, party people, yinz)</li>
</ul>
</li>
<li>microaffirmations, a guide
<ul>
<li><a href="https://brown.edu/sheridan/microaggressions-and-micro-affirmations-0">https://brown.edu/sheridan/microaggressions-and-micro-affirmations-0</a></li>
<li>active listening</li>
<li>recognizing and validating experiences</li>
<li>affirming emotional reactions</li>
</ul>
</li>
<li>micro-tasks in a webapp to generate vector images
<ul>
<li>$0.03 to $0.05 USD</li>
<li>Large base in Venezuela</li>
</ul>
</li>
<li>community members raised concerns about data transfer
<ul>
<li>forgot ota internet was paid by the megabyte</li>
<li>didn&rsquo;t know the ost per megabyte</li>
<li>didn&rsquo;t know there was such flux in data access costs</li>
<li>asked them to take a literal loss in order to participate in the
beta test</li>
<li><strong>I assumed an experience largely consistent with my own</strong></li>
</ul>
</li>
<li>CSS is a <em>tax</em>
<ul>
<li>1.3MB of css vs 34KB after refactoring</li>
<li>Movistar pricing: 0 MB included, each MB is $5 (5,00 Bs (bolivars))</li>
<li>92 deployments, only 9 changed the CSS, every one of them
re-generated the bundle and busted the cache</li>
<li>8 downloads @ 1.3MB  (52Bs) instead of 2 at 34KB (0.34Bs) <em>just
for CSS</em></li>
<li>This is an <em>ethical</em> issue</li>
</ul>
</li>
<li>ask, listen, believe, then act</li>
</ul>
<h4 id="testing-you-keep-using-that-word-but-i-don-t-think-it-means-what-you-think-it-means">“Testing” - You Keep Using that Word, but I Don’t Think It Means What You Think It Means!</h4>
<dl>
<dt>Speaker</dt>
<dd>Samuel Brown</dd>
<dt>Twitter</dt>
<dd>@SamuelBrownIV</dd>
<dt>Slides</dt>
<dd><a href="https://bit.ly/testabstract">https://bit.ly/testabstract</a></dd>
</dl>
<!--listend-->
<ul>
<li>Testing is generally re-defined by every organization to fit their
culture and needs</li>
<li>Easy to explain why an acceptance test works, harder to explain what
the utility is that you get out of a unit test</li>
<li>An opinionated view of testing
<ul>
<li><strong>automated</strong> testing is the single biggest factor in determining
how fast you can ship code</li>
<li>You have to build up tests in layers and spend time in the right
places</li>
<li>Teams that test write code with better structure focused on
interfaces and low cyclomatic complexity</li>
</ul>
</li>
<li>Pit of Despair - AKA &ldquo;Test Environment&rdquo;
<ul>
<li>Don&rsquo;t want to be dependent on the state of the environment to test
that your code works</li>
<li>Useful for UI/UX exploratory testing, load testing, deployment
testing</li>
</ul>
</li>
<li>What can we do
<ul>
<li><strong>Unit tests:</strong> Test the smallest units at the function/method level</li>
<li><strong>Integration/Component tests:</strong> testing the composition of <strong>two</strong>
functional units or external dependencies that achieve a larger
operational function (<strong>reduce</strong> the number of variables, not
<strong>increase</strong>)</li>
<li><strong>E2E/Acceptance/UI/API Tests:</strong> Testing features with all required
components integrated together <em>but some can be mocked</em></li>
</ul>
</li>
<li>Test Pyramid
<ul>
<li>low cost, fast run vs high cost, slow run</li>
<li>automated unit, automated integration, automated ui/api, manual ui/api</li>
</ul>
</li>
<li>Fun tests
<ul>
<li>Writing good tests can be as challenging as writing good code</li>
<li>You will write more (2-3x) test code than feature code</li>
<li>Testing can be cathartic</li>
</ul>
</li>
<li>Strategies for testing
<ul>
<li>Legacy code by Michael Feathers</li>
<li>Consider frameworks and libraries that lend themselves well to testing</li>
<li>Findexamples for what you want to do</li>
<li>Keep functions small and purpose-built - If it is hard to test,
it&rsquo;s probably too big!</li>
<li>Limit conditional logic in a single function to 3 levels at most</li>
<li>Test ALL error conditions respond as expected</li>
<li>Use stubs, mcks and test doubles to simulate expected inputs and outputs</li>
<li>Limit integration/component tests to two actors (mocks for all others)</li>
<li>Create interfaces for components so that they can be mocked</li>
<li>Store test-case data with your tests</li>
<li>It&rsquo;s NEVER too late to start writing tests</li>
</ul>
</li>
<li>Lightning Sand - AKA Microservices
<ul>
<li>The idea is to be (and stay) loosely coupled to the rest of the
architecture, minimizing dependencies when testing is key!</li>
</ul>
</li>
<li>Strategies for Microservice Testing
<ul>
<li>Don&rsquo;t be QA for services you depend on - trust their interface</li>
<li>Use service mocks for external dependencies</li>
<li>Write testing libraries/harnesses that other teams can use</li>
<li>Automate all of your tests - Without a UI you only need robots</li>
</ul>
</li>
<li>What about non-functional tests
<ul>
<li>Every organization needs to evaluate whether that testing is
necessary and correct for them ($$$)</li>
<li>Collect detailed metrics at service boundaries</li>
<li>Abstract out service-level concerns like back-pressure, retries
and complex routing</li>
</ul>
</li>
</ul>
<h4 id="how-games-can-inspire-great-application-ux">How Games Can Inspire Great Application UX</h4>
<dl>
<dt>Speaker</dt>
<dd>Scott Jenson</dd>
<dt>Twitter</dt>
<dd>@scottjenson</dd>
<dt>Email</dt>
<dd><a href="mailto:scott@jenson.org">scott@jenson.org</a></dd>
</dl>
<!--listend-->
<ul>
<li><strong>NOT</strong> gamification (don&rsquo;t be on the addictive side of things)</li>
<li>Video games like the word &ldquo;juicy&rdquo; (visual impact on input)</li>
<li>Video games create tension, apps remove it</li>
<li>Ralph Koster (Book: <a href="https://www.theoryoffun.com/">A Theory of Fun</a>)
<ul>
<li>Applying the lessons in the book to UX</li>
</ul>
</li>
<li>Games present story, players create narrative
<ul>
<li>Standalone features vs a journey</li>
<li>The Mac story arc
<ul>
<li>Sound</li>
<li>promise</li>
<li>model</li>
<li>depth</li>
</ul>
</li>
<li>Our story isn&rsquo;t the user&rsquo;s narrative</li>
</ul>
</li>
<li>Games are fractal, not linear
<ul>
<li>Games are made of games</li>
<li>Each level has its own motivation, feedback, and learning</li>
<li>The deeper you go, the more profound the effect</li>
</ul>
</li>
<li>The Learning Loop
<ul>
<li>Intent -&gt; Action -&gt; Result</li>
<li>Mental model -&gt; affordance -&gt; feedback</li>
<li>&ldquo;Fun is just another word for learning&rdquo; - Ralph</li>
<li>Mario 1-1
<ul>
<li>move (jump over) -&gt; opening (jump into bricks) -&gt; attacking
(jump onto an enemie)</li>
<li>&ldquo;That&rsquo;s how we make games at Nintend: we get the fundamentals
solid first, then do as much with that core concept as our time
and ambition will allow. As forthe courses and enemies, those
actually came at the very end, they were done in a single burst
of energy&hellip;&rdquo; - Shigeru Miyamoto</li>
<li>Nintendo does this <em>all the time</em></li>
</ul>
</li>
<li>&ldquo;Desktop has much better loops than mobile&rdquo; - Ralph</li>
</ul>
</li>
<li>Affordances
<ul>
<li>BotW stamina wheel - training you to take the better path</li>
<li><a href="https://pdfs.semanticscholar.org/ce60/77a469497e464ead9f38e39ac5b0d9ec2b44.pdf">The SonicFinder, An Interface That Uses Auditory Icons</a></li>
<li>Mobile import is impoverished
<ul>
<li>Pinch</li>
<li>Tap</li>
<li>Long press is a hack!</li>
</ul>
</li>
<li>Can&rsquo;t find any examples of gracenotes in apps</li>
<li>&ldquo;It&rsquo;s not the flashy trick that matters, but the rigourous
application of multiple types of feedback in both important and
trivial ways&rdquo; - Ralph</li>
</ul>
</li>
<li>Hintiness
<ul>
<li>Hints <code>/</code> Affordances</li>
<li>Affordances reinforce the loop you&rsquo;re on</li>
<li>Hints move you to  a new loop</li>
<li>Navigation (Disney weenies, always seeing a central place in a
park, ensuring sight lines)</li>
<li>Hintiness prevents &ldquo;bottom feeding&rdquo; (getting stuck at one level,
not making progress and doing new things)</li>
<li>Simple, light, patient examples showing how things can be done</li>
</ul>
</li>
<li>Pacing
<ul>
<li>Games work incredibly hard on the first step</li>
<li>Here is a toolbox vs learn <strong>this</strong> first</li>
</ul>
</li>
</ul>
<h4 id="game-development-in-eight-bits">Game Development in Eight Bits</h4>
<dl>
<dt>Speaker</dt>
<dd>Kevin Zurawel</dd>
<dt>Website</dt>
<dd><a href="https://famicom.party">https://famicom.party</a></dd>
<dt>Slides</dt>
<dd><a href="https://bit.ly/gd8b-abs2">https://bit.ly/gd8b-abs2</a></dd>
</dl>
<!--listend-->
<ul>
<li>256x240 resolution with 64 colors</li>
<li>1 background layer, 1 sprite layer</li>
<li>Backgrounds
<ul>
<li>30x30 grid of tiles, 1 byte per tile</li>
<li>2 pattern tables of tiles, 256 tiles each (one for sprites, one
for backgrounds)</li>
<li>64 colors. 8 of them are black (blame NTSC)
<ul>
<li>8 4-color palettes, 4 for sprites, 4 for backgrounds</li>
<li>The first color of all pallets is the same (hardware limitation)</li>
</ul>
</li>
</ul>
</li>
<li>Sprites
<ul>
<li>256 bytes of sprite ram, 4 bytes per sprite, 64 sprites at a time</li>
<li>No more than 8 sprites per scanline
<ul>
<li>solved using flickering</li>
</ul>
</li>
</ul>
</li>
<li>Level data
<ul>
<li>Make use of default color</li>
<li>abstract elements (pipe, height <em>x</em>)</li>
<li>run-length encoding</li>
<li>&ldquo;set decoration&rdquo; - three-screens-wide default background (SMB)</li>
</ul>
</li>
<li>Physics
<ul>
<li>Don&rsquo;t use physics (simple algorithm)</li>
<li>Collision detection
<ul>
<li>Contra uses point vs rectangle detection
<ul>
<li>The player is always the point, where it can be hit it is a
rectangle in relation to the point</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>The NES does not have a random number generator (3 optionsin
increasingorder of stupidity)
<ul>
<li>Tetris: Do it with math (16-bit fibonacci linear feedback shift register)</li>
<li>FF: (Nasir Gebelli, contractor) a lookup table of 256 random numbers</li>
<li>Contra: a single global 8-bit value that increments by 7 whenever
the game is idle
<ul>
<li>The demo uses prerecorded <em>actions</em>, it can play out differently</li>
</ul>
</li>
</ul>
</li>
<li>Saving progress
<ul>
<li>Password systems
<ul>
<li>DQ2 in Japan used a &ldquo;poem&rdquo;</li>
</ul>
</li>
<li>FDS
<ul>
<li>Shut down due to ease of piracy</li>
</ul>
</li>
<li>Battery-backed memory
<ul>
<li>&ldquo;Hold reset&rdquo; - power issues could lead to corruption</li>
<li>Write multiple times with CRC</li>
</ul>
</li>
</ul>
</li>
<li>&ldquo;Embrace the stupid&rdquo;
<ul>
<li>Is it close enough, and much more efficient?</li>
</ul>
</li>
</ul>
<h3 id="day-two">Day Two</h3>
<h4 id="duolingo-microservice-journey">Duolingo: Microservice Journey</h4>
<dl>
<dt>Speaker</dt>
<dd>Max Blaze</dd>
</dl>
<!--listend-->
<ul>
<li>first microservice in 2016</li>
<li>making many changes to the product, many releases per day</li>
<li>centralized dashboards/logging</li>
<li>Terraform for infrastructure as code</li>
<li>First microservice in ECS in 2017-2018</li>
<li>Why move to microservices?
<ul>
<li>Scalability problem with teams
<ul>
<li>Slow and difficult with a monolith</li>
<li>Desire to use multiple languages (monolith in python, wanting to
incorporate scala, nodejs, &hellip;)</li>
</ul>
</li>
<li>Flexibility</li>
<li>Velocity</li>
<li>Reliability</li>
<li>Cost savings</li>
</ul>
</li>
<li>What to carveout first?
<ul>
<li>Not the largest chunk</li>
<li>Start with a small but impactful feature</li>
<li>move up in size, complexity, and risk</li>
<li>consider dependencies</li>
<li>First thing was the reminder service 🦉🗡</li>
</ul>
</li>
<li>Using circuit breakers to make microservices independent</li>
<li>Why docker?
<ul>
<li>Kind of the only game in town</li>
</ul>
</li>
<li>Why docker with ECS?
<ul>
<li>task auto scaling</li>
<li>task-level IAM
<ul>
<li>needs to be supported by the aws client library (e.g., boto)</li>
</ul>
</li>
<li>cloudwatch metrics</li>
<li>dynamic alb targets</li>
<li>manageability</li>
</ul>
</li>
<li>Microservice abstractions at Duolingo
<ul>
<li>Abstracted into terraform modules
<ul>
<li>Web service (internal or external)
<ul>
<li>load balancer and route 53</li>
</ul>
</li>
<li>worker service (daemon or cron)
<ul>
<li>sqs and event-based scheduling</li>
</ul>
</li>
<li>data store</li>
<li>monitoring</li>
</ul>
</li>
</ul>
</li>
<li>CI/CD
<ul>
<li>Github -&gt; Jenkins -&gt; ECR/Terraform (S3) -&gt; ECS</li>
</ul>
</li>
<li>Load balancing
<ul>
<li>ALB vs. CLBs
<ul>
<li>ALBs more strict when handling malformed requests (defaults to
HTTP/2 (headers always passed in lowercase)</li>
<li>Differences in cloudwatch metrics (continuous in CLBs, discrete
in ALBs)</li>
</ul>
</li>
</ul>
</li>
<li>Standardizing microservices
<ul>
<li>develop a common naming scheme for repos and services</li>
<li>autogenerate as much of the initial service as possible (?)</li>
<li>move core functionality to shared base libraries</li>
<li><strong>provide standard alarms and dashboards</strong></li>
<li><em>periodically review microservices for consistency and quality</em></li>
</ul>
</li>
<li>Monitoring microservices
<ul>
<li>includes load balancer errors</li>
<li>pagerduty integration
<ul>
<li>includes links to playbooks</li>
<li>emergency pages, warnings go to email</li>
<li>schedules and rotations are managed by terraform</li>
</ul>
</li>
<li>Grading microservices</li>
<li>Cost reduction options
<ul>
<li>Cluster
<ul>
<li>instance type</li>
<li>pricing options</li>
<li>auto scale</li>
<li>add/remove AZs</li>
</ul>
</li>
<li>using &ldquo;Spot&rdquo; (spotinst) to save money on ephermeral cluster instances
<ul>
<li>drains ECS services</li>
<li>spreads capacity across AZs</li>
<li>bills on % of savings</li>
</ul>
</li>
<li>ECS allows oversubscription of memory, <strong>WE DO NOT RECOMMEND THIS</strong></li>
<li>AWS Limits
<ul>
<li>EC2 has a hard-coded maximum # of packets(1024/s) sent to an amazon
provided dns server</li>
<li>Nitro is not caching DNS requests where Xen was</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="mentoring-the-way-to-a-diverse-and-inclusive-workplace">Mentoring the way to a diverse and inclusive workplace</h4>
<dl>
<dt>Speaker</dt>
<dd>Alexandra Millatmal</dd>
<dt>Twitter</dt>
<dd>@halfghaninNE</dd>
<dt>Email</dt>
<dd><a href="mailto:hello@alexandramillatmal.com">hello@alexandramillatmal.com</a></dd>
<dt>Slides</dt>
<dd><a href="http://alexandramillatmal.com/talks">http://alexandramillatmal.com/talks</a></dd>
</dl>
<!--listend-->
<ul>
<li>Developer at Newsela (Education tech company promoting literacy in
the 2nd-12th grade space)</li>
<li>The tenants of mentorship are similar to the tenants of inclusive
companies</li>
<li>Mentorship doesn&rsquo;t work for folks of under-represented backgrounds</li>
<li>Finding very similar entry level jobs, very homogenous teams, no time to
support learning</li>
<li>Skill-building and diversity appear related</li>
<li>What if strong mentorship <em>begets</em> diversity &amp; inclusion?</li>
<li>Good mentorship / good diversity
<ul>
<li>Supporting and retaining engineers with underrepresented identities
<ul>
<li>be welcoming and inclusive in the recruiting process</li>
<li>post openings on &ldquo;key values&rdquo;
<ul>
<li>company must list their values</li>
<li>conveys people and tech values on the same level</li>
<li>candidates filter jobs based on their prioritized values</li>
</ul>
</li>
<li>referrals can cut both ways
<ul>
<li>can increase the homogenous nature of the workplace</li>
<li>maybe direct referall bonuses into donations to inclusive
groups that attract and talent</li>
</ul>
</li>
<li>affinity groups
<ul>
<li>caucuses across departments working with management</li>
</ul>
</li>
<li>standardized review process
<ul>
<li>stanford research into review proceseses
<ul>
<li>men overrepresented in the higher tier, women in the middle</li>
<li>standardizing removed the bias</li>
</ul>
</li>
</ul>
</li>
<li>clear definitions of roles and responsibilities
<ul>
<li>do they have ownership</li>
<li>are these employees getting a seat at the table for decisions</li>
</ul>
</li>
<li>representation in leadership
<ul>
<li>are there people there that look like me?</li>
<li>is there a clear model of advancement? allyship in leadership?</li>
</ul>
</li>
<li>investment in internal &amp; external advocacy
<ul>
<li>signals that copmanies understand the systematic barriers to
inclusion and diversity</li>
</ul>
</li>
</ul>
</li>
<li>sponsorship - &ldquo;super mentorship&rdquo;</li>
<li>stark differences in valuation of the above bulletpoints between
underrepresented groups and well-represented groups (women vs men,
lgbt+ vs straight men)</li>
</ul>
</li>
<li>Supporting and leveling up junior engineers
<ul>
<li>recruiting process / relationships
<ul>
<li>the candidate should be receiving feedback on their performance in
the recruting process!
<ul>
<li>Gives them constructive advice and context</li>
</ul>
</li>
</ul>
</li>
<li>apprenticeships and clearly defined entry-level positions
<ul>
<li>is there a clear path for growth?</li>
</ul>
</li>
<li>clear and structured onboarding
<ul>
<li>please do not make their point person a person they report to</li>
<li>need to go to information from somone that doesn&rsquo;t involve
company politics</li>
<li>information should exist outside of leads/managers heads</li>
<li>define onboarding procedures in a shared space</li>
</ul>
</li>
<li>learning groups
<ul>
<li>space to ask questions and demonstrate leadership, particularly
with peer-to-peer learning</li>
</ul>
</li>
<li>formalized mentorship
<ul>
<li>ensure that compensated time is resulting in measurable goals
for the junior engineer</li>
<li>recommend them for opportunities</li>
</ul>
</li>
<li>standardized review process
<ul>
<li>reframe junior-ness as an opportunity, not a deficit of skill</li>
</ul>
</li>
</ul>
</li>
<li>Mentorship with diversity and inclusion in mind
<ul>
<li>this work is really hard
<ul>
<li>easy to fall into a pattern of saying you&rsquo;re making progress
without measuring to make sure that&rsquo;s the case</li>
<li>intent is only half of the picture</li>
<li>the other half is <em>sacrifice</em> to make real, measured investments</li>
</ul>
</li>
<li>mentorship should begin during the interviews
<ul>
<li><a href="https://www.wired.com/story/for-young-female-coders-internship-interviews-can-be-toxic/">wired article on young women&rsquo;s interview experiences</a> (today?!)</li>
</ul>
</li>
<li>place serious focus on developing mentors
<ul>
<li>forces mentees to manage <em>up</em></li>
<li>mentorship is a two-way street</li>
<li>have you ever seen someone become a better collaborator after
mentoring a junior engineer?</li>
<li>mentorship is leadership and it&rsquo;s learned</li>
</ul>
</li>
<li>have clear growth objectives for the mentor and the mentee</li>
<li>mentorship should happen on compensated time</li>
<li>rethink the peer group
<ul>
<li>slack channel for juniors spread across different offices
<ul>
<li>wasn&rsquo;t an organic space to share knowledge</li>
<li>a black junior woman engineer&rsquo;s peers aren&rsquo;t just other black
employees, or women, or other limited groups</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>What&rsquo;s the value to the company?
<ul>
<li>make a business case for mentorship</li>
<li>that will drive diversity and inclusion</li>
<li>mentorship can
<ul>
<li>build brand halo among candidates</li>
<li>distribute management responsibilities</li>
<li>build its own workforce</li>
<li>distributes business knowledge working on real business projects</li>
<li>fosters relationship building and belonging
<ul>
<li>practices wielding expertise, fosters bonding over work</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="sextech-the-good-the-bad-and-the-bias">Sextech: The good, the Bad &amp; the Bias</h4>
<dl>
<dt>Speaker</dt>
<dd>Alison Falk</dd>
<dt>Twitter</dt>
<dd>alisonfalkpgh</dd>
<dt>Slides</dt>
<dd><a href="https://bit.ly/MillatmalAbstractionsII">https://bit.ly/MillatmalAbstractionsII</a></dd>
</dl>
<!--listend-->
<ul>
<li>Deepfakes
<ul>
<li>people onforums requesting deepfakes of coworkers, etc.</li>
<li>takes few photos</li>
<li>women are most typically targeted
<ul>
<li>silenced, made less credible due to the video</li>
</ul>
</li>
<li>no criminal recourse</li>
<li>currently thriving</li>
</ul>
</li>
<li>nonconsensual / revenge porn
<ul>
<li>laws are vague (interstate implications)</li>
<li>sexting &amp; development of sexual identity not reflected in the law
<ul>
<li>this gets caught under the net of sharing child pornography</li>
</ul>
</li>
</ul>
</li>
<li>Just because  you can doesn&rsquo;t mean you should
<ul>
<li>harms sex workers</li>
<li>sex trafficing is only 19% of human trafficing</li>
<li>25% of sex workers sexually assaulted by officers
<ul>
<li>multiple times during stings</li>
<li>arrests inflate statistics</li>
<li>90.8% of victims are deported</li>
</ul>
</li>
</ul>
</li>
<li>Bias
<ul>
<li>don&rsquo;t need to reach orgasm to procreate? considered a vice, not
family planning</li>
<li>approved / not approved.com
<ul>
<li>approved vs non approved ads</li>
<li>silencing of minority / repressed groups</li>
</ul>
</li>
</ul>
</li>
<li>payment processors
<ul>
<li>sex industry is the first adopter of new tech</li>
<li>kicked off, considered a liability</li>
</ul>
</li>
<li>shadowbanning
<ul>
<li>facebook&rsquo;s recent patented content filtering algorithm</li>
</ul>
</li>
<li>SESTA/FOSTA
<ul>
<li>doesn&rsquo;t punish traffickers, makes websites legally liable for any
user generated content found to &ldquo;knowingly assist, facilitate, or
support sex trafficing&rdquo;</li>
<li>interferes with sex education</li>
<li>pushes sex trafficking further underground</li>
<li>based on moral panic (National Center on Sexual Exploitation,
formerly Morality in the Media)</li>
<li>hurts the most vulnerable in our community</li>
</ul>
</li>
<li>Root of the problem
<ul>
<li>education &lt;=&gt; laws -&gt; media/tech</li>
<li>who receives accurate sex education</li>
<li>searches on sex tech aren&rsquo;t showing any of these issues</li>
<li>teach children to know about their bodies so they don&rsquo;t allow
others to make decisions about their bodies</li>
</ul>
</li>
<li>sextechspace
<ul>
<li>resources online</li>
</ul>
</li>
<li>What can you do today
<ul>
<li>support orgs like @decrimNY, @decrimNowDC, @TheBADASS_army</li>
<li>use your platform to spread awareness</li>
<li>advocate for agency and consent</li>
<li>make sure all stakeholders are at the table</li>
</ul>
</li>
<li>&ldquo;If you are not intentional about being inclusive, what you will do
is perpetuate exclusion&rdquo;</li>
</ul>
<h4 id="passing-the-torch-without-dropping-the-ball-lessons-in-documentation">Passing the Torch Without Dropping The Ball: Lessons in Documentation</h4>
<dl>
<dt>Speaker</dt>
<dd>Mary Thengvall, Rain Leander</dd>
<dt>Twitter</dt>
<dd>@mary_grace, @rainleander</dd>
</dl>
<!--listend-->
<ul>
<li>TL;DR: It&rsquo;s not just a question of clocking out and handing over the
keys</li>
<li>Advocato shirts!</li>
<li>Getting sick, switching roles, moving on</li>
<li>Why should you care about a transition plan?
<ul>
<li>Taking time off without worrying</li>
<li>Transitioning into a promotion</li>
<li>Delegate: documented things allow other people to volunteer</li>
<li>Are you going to do that forever? document it and let someone else
take over</li>
</ul>
</li>
<li>The handover document
<ul>
<li>the overview
<ul>
<li>project goals</li>
<li>reading list</li>
</ul>
</li>
<li>dramatis personae
<ul>
<li>who are the stakeholders/elders?</li>
<li>learn from them, and document!</li>
<li>who&rsquo;s the quiet person that gets stuff done?</li>
<li>who needs a bit more time to ramp up?</li>
<li>knowledge needs to be documented and disseminated with care,
perhaps a bit private</li>
<li>not toxic, just necessary</li>
</ul>
</li>
<li>the regular tasks</li>
<li>wish list
<ul>
<li>that which remains undone</li>
</ul>
</li>
<li>the inventory
<ul>
<li>budget</li>
<li>credentials</li>
<li>the keys to the castle</li>
</ul>
</li>
</ul>
</li>
<li><del>eDit edIt</del> Edit
<ul>
<li>what&rsquo;s no longer accurate?</li>
<li>what&rsquo;s missing?</li>
<li>what&rsquo;s confusing?</li>
<li>revisit it, keep it fresh</li>
</ul>
</li>
<li>Prioritize
<ul>
<li>what&rsquo;s urgent?</li>
<li>what&rsquo;s important?</li>
<li>what can only you do?</li>
<li>what&rsquo;s the low-hanging fruit that&rsquo;s easy to ramp up on?</li>
</ul>
</li>
<li>What works for you?
<ul>
<li>don&rsquo;t be scared to make changes</li>
<li>or to say no</li>
<li>be sure the community agrees with your changes</li>
</ul>
</li>
<li>Share your stories</li>
</ul>
<h4 id="the-times-they-are-a-changin-a-data-driven-portrait-of-new-trends-in-how-we-build-software-open-source-and-what-even-is-entry-level-now">The Times They Are a-Changin&rsquo;: A Data-Driven Portrait of New Trends in How We Build Software, Open Source, &amp; What Even is &ldquo;Entry-Level&rdquo; Now</h4>
<dl>
<dt>Speaker</dt>
<dd>Heather Miller</dd>
<dt>Twitter</dt>
<dd>@heathercmiller</dd>
</dl>
<!--listend-->
<ul>
<li>Tracking the shift in focus in open source Scala</li>
<li>Things that are changing fast
<ul>
<li>how we build software</li>
<li>open source</li>
<li>our idea of software engineers
<ul>
<li>what should they know?</li>
</ul>
</li>
</ul>
</li>
<li>How people are getting into tech
<ul>
<li>hiring is difficult</li>
<li>there&rsquo;s a massive gap between jobs available and people to fill
them</li>
<li>a large portion of professional developers are new</li>
<li>we need to adapt, culturally, to make room for lots more newcomers
<ul>
<li>frameworks and reuse to reduce friction?</li>
</ul>
</li>
<li>existing devs are burning out
<ul>
<li>&ldquo;With companies unable to fill open positions, current employees
are expected to fill in the gaps&rdquo;</li>
</ul>
</li>
<li>Increased diversity would help
<ul>
<li>Also immigration, remote workers</li>
<li><a href="https://dl.acm.org/citation.cfm?id=2702549">Paper: Gender and tenure diversity in github teams</a>
<ul>
<li>increased diversity = increased productivity</li>
</ul>
</li>
<li>How do we stop people from disengaging?
<ul>
<li>Women disengage earlier than men</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Open source adoption
<ul>
<li>Dramatically increased since 2010</li>
<li>Open source became the default choice</li>
<li>Low-cost with no vendor lock-in</li>
<li>Open source components exist in 96% of applications scanned and
analyzed by Synopsys in 2018, with an average of 257 components
per application. 36% of code bases were open source components in
2017, 57% in 2018.</li>
<li>OSS projects 62% self-funded, 49% employer-funded</li>
<li>&ldquo;Truck factor&rdquo;
<ul>
<li>64% of top projects on Github relied on 1-2 devs to survive</li>
</ul>
</li>
</ul>
</li>
<li>Ecosystem and community are everything
<ul>
<li>Leo Meyrovich - <a href="https://dl.acm.org/citation.cfm?id=2509515">Paper on programming language adoption</a></li>
<li>Most important factor is an ecosystem / open-source libraries</li>
<li>Professional developers want an active community</li>
</ul>
</li>
<li>All these puzzle pieces need polishing</li>
</ul>
<h3 id="day-three">Day Three</h3>
<h4 id="analysis-of-the-feeling-of-the-attendees-to-a-talk-in-real-time">Analysis of the Feeling of the Attendees to a Talk in Real Time</h4>
<dl>
<dt>Speaker</dt>
<dd>Juantomás Garcia Molina</dd>
<dt>Twitter</dt>
<dd>juantomas</dd>
</dl>
<!--listend-->
<ul>
<li>Google cloud functions triggered by Google Storage, Pub/Sub, or REST</li>
<li>Using google vision API to detect facial featuers and emotional
responses</li>
</ul>
<h4 id="identity-expression-coming-out-of-the-work-closet">Identity Expression: Coming Out of the Work Closet</h4>
<dl>
<dt>Speaker</dt>
<dd>Matthew Rogers</dd>
</dl>
<p>Coming out of the Closet</p>
<ul>
<li>Coming out doesn&rsquo;t just happen once, it happens a <em>lot</em></li>
<li>&ldquo;Spheres of existence&rdquo; you have to come out to
<ul>
<li>Friends</li>
<li>Peers</li>
<li>Family</li>
<li>Digital</li>
<li>Public</li>
<li><strong>Work</strong></li>
</ul>
</li>
<li>Story
<ul>
<li>The comment is made</li>
<li>Affected how I work, which affects my coworkers</li>
<li>Negative effect spreads</li>
<li>Expands further while training/interacting</li>
</ul>
</li>
<li>It isn&rsquo;t always cut and dry</li>
<li>The fear of &ldquo;what if&rdquo; can be damaging all its own</li>
<li>In 30 states, LGBTQ+ workers aren&rsquo;t fully protected under the law
<ul>
<li>PA included</li>
</ul>
</li>
<li>Professinal risks
<ul>
<li>Fired outright</li>
<li>Passed over for promotions or projects</li>
<li>Refusal of reference for next job</li>
</ul>
</li>
<li>Personal risks
<ul>
<li>Uncomfortable or dangerous work environment</li>
<li>lost source of income</li>
<li>Forced to change field or location</li>
</ul>
</li>
<li>Ther&rsquo;s risk to the business witself when employees hide part of
their identity
<ul>
<li>Productivity
<ul>
<li>Say that 10% of your day goes towards identity concealment
<ul>
<li>adds up to 6 weeks of lost productivity every year</li>
</ul>
</li>
</ul>
</li>
<li>Communication
<ul>
<li>less likely to engage</li>
<li>avoid people</li>
<li>crosses levels</li>
</ul>
</li>
<li>Creativity
<ul>
<li>stress + anxiety</li>
<li>requires vulnerability</li>
</ul>
</li>
<li>Collaboration
<ul>
<li>needs creativity + communication</li>
<li>not getting the best work</li>
</ul>
</li>
</ul>
</li>
<li>What if things went the other way?
<ul>
<li><strong>Productivity:</strong> fewer distractions from your work</li>
<li><strong>communication:</strong> problems caught, efficiency goes up</li>
<li><strong>creativity:</strong> flourishes in safe + comfortable environments</li>
<li><strong>collaboration:</strong> becomes easier and more routine</li>
</ul>
</li>
<li>Why focus on such a small group of people
<ul>
<li>~4.5% of the entire population</li>
<li>Just a method of expressing identity, not limited to just queer
people
<ul>
<li>4.5% queer</li>
<li>6% practicing non-christian faiths</li>
<li>19% have a disability</li>
<li>22% persons of color</li>
<li>47% female</li>
</ul>
</li>
</ul>
</li>
<li>Isn&rsquo;t this just about feelings?
<ul>
<li>this holds personal and professional importance with real mental
healthy implications</li>
<li>Your &ldquo;Selves&rdquo;
<ul>
<li>Private</li>
<li>Home</li>
<li><strong>You</strong>
<ul>
<li>Your core self</li>
</ul>
</li>
<li>Public</li>
<li>Work</li>
</ul>
</li>
<li>Dissonance
<ul>
<li>Your genuine self suffers as you put your energy into maintaining
a separate self or concealing part of your identity</li>
<li>Personal Consequences
<ul>
<li>drives down those four factors</li>
<li>is mentally exhausting</li>
<li>it becomes a cycle</li>
</ul>
</li>
<li>Business consequences
<ul>
<li>Quality of Product</li>
<li>Employee Satisfaction</li>
<li>Company Culture</li>
<li>Bottom Line</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>What can I do now?
<ul>
<li>Introduce yourself using your pronouns
<ul>
<li>Says you care how other people want to be addressed</li>
</ul>
</li>
<li>Start ERGs (Employee resource groups)
<ul>
<li>People with shared experiences</li>
</ul>
</li>
<li>Acknowledge and celebrate Black History Month, Women&rsquo;s Month,
Pride Month, etc. Let people feel <strong>seen</strong></li>
<li>Don&rsquo;t ask to touch anyone&rsquo;s hair. <strong>Ever</strong>.</li>
<li>Accommodate variations in holidays and scheduling around religious
practices</li>
<li><strong>Don&rsquo;t get embarrassed</strong> if you mess up. Apologize, correct
yourself, and learn.</li>
<li>Replace words like &ldquo;wife/husband/boyfriend/girlfriend/etc&rdquo; with
partner
<ul>
<li>Be careful asking about personal and private relationships in
general</li>
</ul>
</li>
<li>Look into unconscious bias training. Use HR.</li>
<li>Look around the room
<ul>
<li>Different perspectives and experiences simply work better</li>
</ul>
</li>
<li>When you don&rsquo;t know, research. Ask questions, if you must. Just
<strong>don&rsquo;t assume</strong>.</li>
</ul>
</li>
<li>If you are in the closet at work, <strong>open the door a little</strong></li>
<li>Make sure you&rsquo;re not blocking someone else&rsquo;s exit</li>
</ul>
<h4 id="overcoming-challenges-an-attitude-of-iteration">Overcoming Challenges: An Attitude of Iteration</h4>
<dl>
<dt>Speaker</dt>
<dd>Eric Johnson</dd>
</dl>
<!--listend-->
<ul>
<li>&ldquo;The Look&rdquo; (first date story)
<ul>
<li>If you&rsquo;re different and it shows, it&rsquo;s assumed every problem in the
book belongs to you</li>
<li>&ldquo;You&rsquo;re not good enough for her&rdquo; or &ldquo;That&rsquo;s the saddest thing I&rsquo;ve
ever seen&rdquo;</li>
<li>(context: one finger on each hand, one toe on each foot, 4/5 kids
share this trait)</li>
<li>&ldquo;Man, I&rsquo;m <em>different</em>&rdquo;</li>
<li>&ldquo;Things are gonna be a little <em>challenging</em> for me, aren&rsquo;t they?&rdquo;</li>
</ul>
</li>
<li><strong>We are all challenged</strong></li>
<li>How you deal with that challenge is the model by which everyone else
is going to deal with it</li>
<li>50/50 chance of the genetic condition being passed on (5 fingers, or
<em>something else</em>)</li>
<li><em>You</em> have to make the choice of how to deal with it
<ul>
<li>Can&rsquo;t force children to make a decision, they have to make it on
their own</li>
<li><em>It is a blessing, not a curse</em></li>
<li><em>It is what it is</em></li>
<li>It&rsquo;ll  never be what it isn&rsquo;t</li>
</ul>
</li>
<li>No excuses
<ul>
<li>&ldquo;I can&rsquo;t do x <em>yet</em>&rdquo;, not &ldquo;I can&rsquo;t do x&rdquo;</li>
<li>We have to adapt</li>
<li>Never tell kids they &ldquo;can&rsquo;t do x&rdquo;,but &ldquo;it&rsquo;s gonna be hard, you&rsquo;re
gonna have to figure it out&rdquo;</li>
</ul>
</li>
<li>Have fun</li>
<li>Sometimes life is hard, but you&rsquo;ve still gotta go on. you try again,
and you try again.</li>
</ul>
<h4 id="beyond-the-sunset-how-to-wring-the-maximum-joy-from-your-last-10-years-in-tech">Beyond The Sunset: How To Wring The Maximum Joy From Your Last 10 Years In Tech</h4>
<dl>
<dt>Speaker</dt>
<dd>Vanessa Kristoff</dd>
<dt>Twitter</dt>
<dd>@vanessakristoff</dd>
<dt>Email</dt>
<dd><a href="mailto:Vanessa.kristoff@gmail.com">Vanessa.kristoff@gmail.com</a></dd>
</dl>
<!--listend-->
<ul>
<li>&ldquo;Pre-tirement&rdquo;</li>
<li>55 years old</li>
<li>Ageism is real
<ul>
<li>&ldquo;Will they fit the culture&rdquo; BS</li>
<li>But Don&rsquo;t be &ldquo;that person&rdquo;
<ul>
<li>&ldquo;better back in the day&rdquo;</li>
</ul>
</li>
</ul>
</li>
<li>Job satisfaction over time
<ul>
<li>U-shaped curve</li>
<li><a href="http://www.andrewoswald.com/docs/jooparticle.pdf">http://www.andrewoswald.com/docs/jooparticle.pdf</a></li>
</ul>
</li>
<li>Imposter Syndrome
<ul>
<li>No, seriously, for reals, after all these years, you are NOT an
imposter</li>
<li>Hard to have fun while struggling with this</li>
</ul>
</li>
<li>We are the Village Elders
<ul>
<li>That comes with responsibility</li>
<li>We should be helping people</li>
</ul>
</li>
<li>It&rsquo;s just a job
<ul>
<li>You should know that by now</li>
</ul>
</li>
<li>Sponsor a Newbie
<ul>
<li>Teach your coworkers what grace is, by example</li>
<li>Sponsor vs mentoring
<ul>
<li>mentoring is &ldquo;tweaking&rdquo; them to fit in</li>
<li>sponsoring is promoting them</li>
</ul>
</li>
</ul>
</li>
<li>Give whimsical talks at conferences
<ul>
<li>Optional: create tag clouds referencing CORBA</li>
<li>You have knowledge that not everybody has</li>
</ul>
</li>
<li>Pretend to be an Extrovert
<ul>
<li>Doing so will help the folks you&rsquo;re extroverted with</li>
<li>This is why that imposter thing is important</li>
</ul>
</li>
<li>Sign up for the messiest possible coding
<ul>
<li>what do you have to fear? NOTHING</li>
</ul>
</li>
<li>Don&rsquo;t stop learning
<ul>
<li>Volunteer to write UI code or backend code or try that Haskell
thing</li>
<li>Join a new industry</li>
</ul>
</li>
<li>Use your network for good
<ul>
<li>You have contacts</li>
<li>Your people need contacts</li>
<li>See how that works?</li>
</ul>
</li>
<li>Gossip and complaining
<ul>
<li>It&rsquo;s not adding value to your work life, so just stop it</li>
</ul>
</li>
<li>Make a plan
<ul>
<li>start NOW thinking about what you&rsquo;ll do</li>
<li>how will you fill/structure your time?</li>
<li>you will need a social life once you&rsquo;re retired</li>
</ul>
</li>
<li>Get your house in order, literally and figuratively
<ul>
<li>Marie Kondo that crap</li>
<li>Use your employer health care (if you have it) while you can</li>
</ul>
</li>
</ul>
<h4 id="how-live-coding-changed-my-life">How Live Coding Changed My Life</h4>
<dl>
<dt>Speaker</dt>
<dd>Jesse Weigel</dd>
<dt>Twitter</dt>
<dd>@JesseRWeigel</dd>
</dl>
<!--listend-->
<ul>
<li>Volunteer live coder for freeCodeCamp</li>
<li>How I got started
<ul>
<li>Paid for private github repos rather than letting folks see my code</li>
<li>&ldquo;I make a lot of mistakes and I am a full time dev. Maybe it would
be helpful for beginners to see that.&rdquo;</li>
<li>First streams were really bad and nobody watched</li>
<li>Asked for help on the freeCodeCamp forum</li>
</ul>
</li>
<li>The community
<ul>
<li>all ages, locations, and skill levels</li>
<li>eager to learn and contribute</li>
<li>overwhelmingly positive</li>
<li>always learning and trying new ways to do things</li>
<li>VERY diverse watchers</li>
</ul>
</li>
<li>Consistency is key
<ul>
<li>Set time for the streams</li>
</ul>
</li>
<li>Keeping it positive
<ul>
<li>Thank for negative feedback</li>
<li>Ask for clarification if it&rsquo;s not constructive (&ldquo;what can I do
better?&rdquo;)</li>
<li>People with situational anxiety, etc. feeling safe</li>
<li>Video about depression, mental health issues</li>
</ul>
</li>
<li>What I&rsquo;ve learned
<ul>
<li>So much collaboration
<ul>
<li>Pull requests!</li>
</ul>
</li>
<li>Confidence building
<ul>
<li>Viewers too, gaining confidence over time</li>
</ul>
</li>
<li>Viewers get jobs!</li>
</ul>
</li>
<li>How you can start
<ul>
<li>Make a youtube or twitch channel</li>
<li>Broadcast and share your screen (OBS)</li>
<li>Start coding!</li>
</ul>
</li>
<li>Advice
<ul>
<li>Adapt based on feedback</li>
<li>show your mistakes</li>
<li>show your face</li>
<li>don&rsquo;t be afraid to say I don&rsquo;t know</li>
<li>It&rsquo;s okay to say nothing (or better yet thank you) when someone
tells you something that you already knew
<ul>
<li>it may not be new to them, they could be excited and want to
help</li>
</ul>
</li>
<li>Always be positive and encouraging</li>
<li>Give encouragement, not solutions</li>
</ul>
</li>
<li>Things to avoid
<ul>
<li>talking badly about another language, framework, library,etc</li>
<li>laughing at a question (assume every question is serious)</li>
<li>getting angry</li>
<li>coding and reading the chat at the same time</li>
<li>negativity (there is already enough negativity in the world)</li>
</ul>
</li>
</ul>
<h4 id="debugging-our-feelings">Debugging Our Feelings</h4>
<dl>
<dt>Speaker</dt>
<dd>Jamie Strachan</dd>
<dt>Twitter</dt>
<dd>@JamieStrachan</dd>
</dl>
<!--listend-->
<ul>
<li>Working at odds with professional development and depression</li>
<li>Cognitive Behavioural Therapy
<ul>
<li>&ldquo;Feeling Good&rdquo; by Dr. David Burns</li>
<li>parallells with developer life</li>
<li>Experiences -&gt; 👩 Thoughts -&gt; Responses</li>
<li>&ldquo;There is nothing either good or bad, but thinking makes it so&rdquo; (Shakesspeare)</li>
<li>We can change how we feel if we change how we think</li>
<li>Input -&gt; 💻 Code -&gt; Output</li>
</ul>
</li>
<li>Starting a project, getting overwhelmed, distracted, guilty, nervous
<ul>
<li>Similar to application in an incorrect, incomplete state. Not what
we wanted yet.</li>
<li>We test our output</li>
<li>We trust our feelings
<ul>
<li>Emotional reasoning</li>
<li>Because I feel something, it must be true</li>
<li>Not rational</li>
<li>Would be like looking at the app in that state, &ldquo;I guess I&rsquo;m
done.&rdquo;</li>
</ul>
</li>
</ul>
</li>
<li>Feelings should be
<ul>
<li><del>positive</del></li>
<li>helpful</li>
<li>reasonable</li>
<li>rational
<ul>
<li>good at <em>rationalizing</em>, working our way <em>back</em> from the
feelings, not super helpful</li>
</ul>
</li>
</ul>
</li>
<li>Mind reading
<ul>
<li>We respond to what <em>we</em> think <em>they&rsquo;re</em> thinking</li>
<li>Leads to impostor syndrome</li>
<li>Test the feelings instead. Ask the question, don&rsquo;t guess.</li>
</ul>
</li>
<li>All-or-nothing thinking
<ul>
<li>Perfectionism</li>
<li>Test
<ul>
<li>Antiperfectionism sheet
<ul>
<li>Task, Effectiveness, Satisfaction</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Testing helps identify problems, but doesn&rsquo;t fix them</li>
<li>Code won&rsquo;t get any better without changes</li>
<li>Editor for thoughts
<ul>
<li>Notebook</li>
<li>two column technique
<ul>
<li>left hand side: automatic thoughts
<ul>
<li>thought patterns that are causing us to feel that way
<ul>
<li>&ldquo;I&rsquo;m overwhelmed&rdquo; -&gt; thinking, &ldquo;this is going to be hard&rdquo;</li>
<li>&ldquo;Guilty&rdquo; -&gt; thinking, I&rsquo;m a procrastinator</li>
<li>Nervous -&gt; thinking, I&rsquo;m not going to finish this on time</li>
</ul>
</li>
</ul>
</li>
<li>right hand side: rational responses
<ul>
<li>fortune telling
<ul>
<li>we&rsquo;ve predicted the future, and are responding as though
it&rsquo;s true</li>
<li>I can&rsquo;t know this</li>
<li>it could also be fun, educational</li>
</ul>
</li>
<li>labeling
<ul>
<li>fancy term for name-calling</li>
<li>reduces people to one trait
<ul>
<li>&ldquo;I&rsquo;ve always been a procrastinator, I&rsquo;ll always be a procrastinator&rdquo;</li>
</ul>
</li>
<li>I&rsquo;m not any one thing (I&rsquo;m procrastinatING)</li>
<li>I don&rsquo;t always procrastinate</li>
</ul>
</li>
<li>fortune telling
<ul>
<li>takes away our autonomy (it&rsquo;s inevitable)</li>
<li>I have control over the outcome</li>
<li>there are other options</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Thoughts can have a &ldquo;home field advantage&rdquo; in our heads</li>
</ul>
</li>
<li>How does this change when it comes from someone else?
<ul>
<li>It doesn&rsquo;t</li>
<li>Still just an experience, just your thoughts</li>
<li>&ldquo;No one can make you feel inferior <strong>without your consent</strong>&rdquo; -
Eleanor Roosevelt</li>
</ul>
</li>
<li>Magnification and Minification</li>
<li>Disqualifying the postitive</li>
<li>Accepting a compliment
<ul>
<li>pause</li>
<li>say thank you</li>
</ul>
</li>
<li>Using the two-column technique, have someone to role play them with
<ul>
<li>We don&rsquo;t always extend sympathy to ourselves</li>
</ul>
</li>
<li>&ldquo;Should&rdquo; is the worst word in the english language
<ul>
<li>Try &ldquo;I <em>want</em>&hellip;&rdquo;</li>
</ul>
</li>
<li>Test your feelings</li>
<li>Get your thoughts out of your head</li>
<li>Get help</li>
</ul>
<h3 id="not-attended">Not Attended</h3>
<h4 id="the-mental-impact-of-tech-interviews">The Mental Impact of Tech Interviews</h4>
<dl>
<dt>Slides</dt>
<dd><a href="https://docs.google.com/presentation/d/1y4SwAuJcYgCJ-5lSpF560QBWaMBIrlLFA5BrMH-UKFw/edit?usp=drivesdk">https://docs.google.com/presentation/d/1y4SwAuJcYgCJ-5lSpF560QBWaMBIrlLFA5BrMH-UKFw/edit?usp=drivesdk</a></dd>
<dt>Speaker</dt>
<dd>Zack Zlotnik</dd>
</dl>
<h2 id="doing-the-next-right-thing">Doing the next right thing</h2>
<p>I&rsquo;m really good at beating myself up.</p>
<p>For me, doing the next right thing means:</p>
<ul>
<li>Taking a little extra time in the mornings to heat up some water for tea</li>
<li>Preparing myself a bubble bath and relaxing quietly for an hour listening to a
favorite podcast</li>
<li>Getting out for a short walk when the weather&rsquo;s good after a few days of
feeling bad for not exercising</li>
<li>Writing in my journal when I&rsquo;m feeling crappy about something to get my
feelings out</li>
<li>Watching a favorite episode of a show when I need to feel comforted</li>
</ul>
<h2 id="when-to-sanitize-when-to-validate">When to sanitize and when to validate</h2>
<p>Data should be validated coming into your application, and sanitized when going
out.</p>
<p>For the purpose of this article, I&rsquo;ll work with the following definitions:</p>
<dl>
<dt>Validation</dt>
<dd>Checking data against the expected types and constraints of a
domain, rejecting data that does not comply.</dd>
<dt>Sanitization</dt>
<dd>Transforming data to satisfy constraints (e.g. removing
unwanted characters or escaping them) in order to allow the data through.</dd>
</dl>
<p>The part of your system that is accepting data should not need to be concerned
with how it <em>may</em> be output elsewhere. If you can ensure that your output is
always properly sanitized, you can avoid needlessly complicating your validation
logic, thereby keeping your input and output layers neatly decoupled.</p>
<h3 id="reasons-to-sanitize-output">Reasons to sanitize output</h3>
<h4 id="cross-site-scripting--xss--prevention">Cross-site scripting (XSS) prevention</h4>
<h4 id="sql-injection-prevention">SQL injection prevention</h4>
<h2 id="dashboard-phone-mount">I didn&rsquo;t want to glue my new phone mount to my dashboard</h2>
<p>What do you do when you want to mount your phone in your car but it has trouble
staying put on your dashboard? Well, if you&rsquo;re me, you try your hand at
designing a counterweight and fabricate it with a 3D printer you&rsquo;re borrowing
from a friend.</p>
<h2 id="automating-our-garage-door">Automating our garage door with an ESP2866 and Home Assistant</h2>
<figure><img src="/ox-hugo/garage-door-feature.png"/>
</figure>

<p>Now that I&rsquo;ve got a house again, I can really start playing with home automation
projects a lot more. The first thing I plan to do is come up with something to
monitor and automate the garage door, as I&rsquo;ve <em>already</em> panicked from not
remembering whether I&rsquo;d closed it when leaving the house. It turned out I had
closed it, but I can definitely do without that anxiety. What better way to
remove that anxiety than by being able to remotely monitor and control the door!</p>
<h3 id="choosing-the-hardware">Choosing the hardware</h3>
<p>Controlling a garage door is a bit more involved than automating smart lights,
so it was time to finally dip my toes into wiring up and programming some
microcontrollers. I did some research and settled on the popular <a href="https://en.wikipedia.org/wiki/ESP8266">ESP8266</a> series
of microcontrollers, and found myself a set of WeMos D1 mini clones with
built-in micro USB connectors (<a href="https://www.amazon.com/gp/product/B081PX9YFV">$3 USD each on Amazon</a>). I also snagged myself a
heavy-duty looking <a href="https://en.wikipedia.org/wiki/Reed_switch">reed switch</a> to monitor when the door is closed (<a href="https://www.amazon.com/Magnetic-Contacts-Shutter-Adjustable-Bracket/dp/B07ZBT28L8">$17 USD on
Amazon</a>), and a pack of 3 volt DC single-channel optocoupler relays (<a href="https://www.amazon.com/Cermant-Channel-Driver-Module-Optocoupler/dp/B0B4MS62X6">$5 USD
each on Amazon</a>). I chose single-channel as I have only one door, getting
modules with more than one channel could make it easier to hook everything up if
you have more. Because this is my first electronics project, I also grabbed
myself an <a href="https://www.amazon.com/gp/product/B073ZC68QG">electronics kit</a> with a breadboard, jumper wires, and a bunch of fun
components to fiddle around with. I tacked on some <a href="https://www.amazon.com/gp/product/B071H25C43">USB cables</a> and <a href="https://www.amazon.com/gp/product/B0794WT57Y">power bricks</a>
for powering my creations as well.</p>
<h3 id="choosing-the-software">Choosing the software</h3>
<p>There are multiple options for developing the firmware to install on the ESP8266
controller. After looking at the <a href="https://www.arduino.cc/en/software/">Arduino IDE</a> and <a href="https://www.nodemcu.com/index_en.html">NodeMcu</a> as possible development
options, I settled on using <a href="https://esphome.io/">ESPHome</a> as it is super simple to set up (Arduino
coding looks fun, but I&rsquo;ll get everything I need just using some <a href="https://en.wikipedia.org/wiki/YAML">YAML</a>
configuration) and it integrates super easily with <a href="https://www.home-assistant.io/">Home Assistant</a> (the platform
I use for all of my home automation). I was able to get up and running just by
<a href="https://esphome.io/guides/installing_esphome.html">installing the ESPHome CLI tool</a> and tossing some configuration together.</p>
<h3 id="wiring-up-a-prototype">Wiring up a prototype</h3>
<figure><img src="/ox-hugo/garage-door-wiring.jpg"
         alt="Figure 1: Clockwise from the bottom: The ESP8266 Wemos D1 mini clone wired into the breadboard, the reed switch plate, its accommpanying magnet, and the relay switch."/><figcaption>
            <p><span class="figure-number">Figure 1: </span>Clockwise from the bottom: The ESP8266 Wemos D1 mini clone wired into the breadboard, the reed switch plate, its accommpanying magnet, and the relay switch.</p>
        </figcaption>
</figure>

<p>To test the module out, I wired it onto a breadboard, using it&rsquo;s 3.3V pin to
supply power to the top positive rail and hooked its ground pin to the lower
negative rail. Hooking it up to the breadboard with only jumper wires is a bit
finicky (I didn&rsquo;t have a soldering iron at the time), so to confirm that
everything was working I ran wires to hook a blue LED up between the power and
ground. When everything was snug and the USB cable was plugged in, it lit up!
Success!</p>
<h4 id="preparing-the-initial-firmware">Preparing the initial firmware</h4>
<p>I used the ESPHome CLI wizard to generate my initial firmware configuration for
the device. The wizard prompts for various values needed for basic
functionality. In my case, I specify a name for my device (<code>garage-door</code>), the
microcontroller I&rsquo;m using (<code>ESP2866</code>), the board I&rsquo;m using (<code>d1_mini</code>), and some
WiFi credentials. Substitute in the credentials for the WiFi network your device
will connect to if you&rsquo;re following along.</p>
<style>.org-center { margin-left: auto; margin-right: auto; text-align: center; }</style>
<div class="org-center">
<p><video width="800" height="406" controls><source src="/videos/esphome-wizard.webm" type="video/webm">
Download the <a href="/videos/esphome-wizard.webm">WEBM footage</a> of the ESPHome CLI wizard.</video></p>
</div>
<p>Review the contents of the generated YAML file, then connect the board to your
computer via USB and run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>esphome run garage-door.yml
</span></span></code></pre></div><p>The CLI tool will generate and compile the code for you, then prompt you for the
device to install to. As this is the first time you&rsquo;re installing the firmware,
you must select your USB device (in my case, on my linux machine, the device was
<code>/dev/ttyUSB0 (USB2.0-Ser!)</code>). You&rsquo;ll see the logs as the device boots up and
connects to your network, and it&rsquo;s up and running! Not doing much yet, but it is
there and discoverable!</p>
<h4 id="adding-it-to-home-assistant">Adding it to Home Assistant</h4>
<p>Now that the device is running and discoverable on the network, it can be added
to Home Assistant. Home Assistant should detect the device on your network and
show it as a new device to add automatically in the Integrations tab of your
settings. Home Assistant will prompt for its password, which is in the <code>api:</code>
section of <code>garage-door.yml</code> (the same password that was set in the wizard). If
for some reason it doesn&rsquo;t, click the &ldquo;+ Add Integration&rdquo; button, search for and
select &ldquo;ESPHome&rdquo;. Home Assistant then prompts for the connection settings (in my
case, the hostname was <code>garage-door.local</code>, and the default port is <code>6053</code>). As
entities are added to the ESPHome configuration and uploaded to the device, they
will become available within Home Assistant.</p>
<h4 id="wiring-up-the-garage-door-detector">Wiring up the garage door detector</h4>
<p>The first thing I hooked up was the reed switch. One wire is joined to the <code>D1</code>
pin on the ESP, and the other to ground. In the ESPHome configuration, I added a
binary sensor for the switch, configuring the <code>D1</code> for input with its pull-up
resistor enabled, which sets the D1 state to high normally. When the magnet is
within a couple inches of the switch plate, the switch will close the circuit,
triggering a state change from high to low on the ESP pin as the current can now
flow to the ground pin.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">binary_sensor</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">gpio</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">id</span>: <span style="color:#ae81ff">garage_door_sensor</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;Garage Door&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">device_class</span>: <span style="color:#ae81ff">garage_door</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pin</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">number</span>: <span style="color:#e6db74">&#34;D1&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mode</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">input</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">pullup</span>: <span style="color:#66d9ef">true</span>
</span></span></code></pre></div><div class="src-block-caption">
  <span class="src-block-number">Code Snippet 2:</span>
  Configuration YAML for the garage door sensor.
</div>
<p>The binary sensor is using the <code>gpio</code> platform to read the <code>D1</code> pin in <code>input</code>
mode with its <code>pullup</code> enabled. The <code>id</code> value will be used to reference the
sensor in other areas of the configuration, and the <code>device_class</code> is used to
inform Home Assistant that this device is monitoring a garage door.</p>
<p>I executed the <code>esphome run</code> command once again to load the new firmware, and
once it was up and running I was able to verify that the switch was working from
the logs as I moved the magnet up to and away from the switch plate.</p>
<figure><img src="/ox-hugo/garage-door-sensor.png"
         alt="Figure 1: The ESPHome logs showing the door state updating."/><figcaption>
            <p><span class="figure-number">Figure 1: </span>The ESPHome logs showing the door state updating.</p>
        </figcaption>
</figure>

<p>I was also able to add the new sensor entity to my Home Assistant dashboard,
which also updated as I moved the magnet!</p>
<figure><img src="/ox-hugo/garage-door-sensor-card.png"
         alt="Figure 1: The garage door sensor card in Home Assistant."/><figcaption>
            <p><span class="figure-number">Figure 1: </span>The garage door sensor card in Home Assistant.</p>
        </figcaption>
</figure>

<h4 id="adding-the-garage-door-control-switch">Adding the garage door control switch</h4>
<p>Next is the relay switch, which I will use to control the garage door so I can
open or close it via the Home Assistant mobile app or any automations I decide
to set up for it.</p>
<p>In the ESPHome configuration, I added a <code>gpio</code> switch using the <code>D5</code> pin. Since
going to be activating this switch in a particular way within another control, I
marked it as <code>internal</code> so it can&rsquo;t be activated manually via Home Assistant. I
then added a <code>cover</code> entity representing the garage door as a whole. This wraps
up the door sensor and door control into one neat package, and lets me specify
how the switch should be toggled to activate the door.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">switch</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">gpio</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">id</span>: <span style="color:#ae81ff">garage_door_switch</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;Garage Door Opener&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pin</span>: <span style="color:#e6db74">&#34;D5&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">internal</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">cover</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">platform</span>: <span style="color:#ae81ff">template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;Garage Door&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">lambda</span>: |-<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      if (id(garage_door_sensor).state) {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        return COVER_OPEN;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      } else {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        return COVER_CLOSED;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }</span>      
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">open_action</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">switch.turn_on</span>: <span style="color:#ae81ff">garage_door_switch</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">delay</span>: <span style="color:#ae81ff">0.</span><span style="color:#ae81ff">1s</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">switch.turn_off</span>: <span style="color:#ae81ff">garage_door_switch</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">close_action</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">switch.turn_on</span>: <span style="color:#ae81ff">garage_door_switch</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">delay</span>: <span style="color:#ae81ff">0.</span><span style="color:#ae81ff">1s</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">switch.turn_off</span>: <span style="color:#ae81ff">garage_door_switch</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">stop_action</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">switch.turn_on</span>: <span style="color:#ae81ff">garage_door_switch</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">delay</span>: <span style="color:#ae81ff">0.</span><span style="color:#ae81ff">1s</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">switch.turn_off</span>: <span style="color:#ae81ff">garage_door_switch</span>
</span></span></code></pre></div><div class="src-block-caption">
  <span class="src-block-number">Code Snippet 1:</span>
  Configuration YAML for the opener control switch.
</div>
<p>Because the garage has only one switch for opening, closing, and stopping the
door, the <code>open_action</code>, <code>close_action</code>, and <code>stop_action</code> are identical. To
trigger the mechanism, it activates the switch, pauses briefly, then deactivates
the switch. I used a <code>lambda</code> to interrogate the door sensor&rsquo;s state to return
whether the &ldquo;cover&rdquo; is open or closed.</p>
<p>The switch uses three hookups to the ESP: One from the <code>3.3v</code> pin, one from the
input wired to the <code>D5</code> pin, and one to ground. To give it something to control
while testing in place of the garage door opener it&rsquo;ll eventually connect to, I
set up a circuit with a red LED between the 3.3v power and ground lines, and
wired the relay switch in the middle. Because I only want the LED (door opener)
circuit closed when the switch is activated (i.e. a <em>normally-open circuit</em>), I
attached the LED circuit wires to the <code>NO</code> (Normally Open) and <code>COM</code> (Common)
leads on the far side of the switch.</p>
<p>Once this was done, I was able to activate the door control in Home Assistant
and see the red LED toggled on and off!</p>
<p>By adding the cover entity to Home Assistant, I was also able to get this nifty control card!</p>
<figure><img src="/ox-hugo/garage-door-cover-card.png"
         alt="Figure 1: The garage door control card in Home Assistant."/><figcaption>
            <p><span class="figure-number">Figure 1: </span>The garage door control card in Home Assistant.</p>
        </figcaption>
</figure>

<h4 id="celebration">Celebration!</h4>
<p>Behold! The prototype works!</p>
<style>.org-center { margin-left: auto; margin-right: auto; text-align: center; }</style>
<div class="org-center">
<p><video width="480" height="960" controls><source src="/videos/garage-door-prototype.webm" type="video/webm">
Download the <a href="/videos/garage-door-prototype.webm">WEBM footage</a> of the wired prototype.</video></p>
</div>
<h3 id="hooking-it-all-up-for-real">Hooking it all up for real</h3>
<p>With the prototype sorted, it was time to put it together into something I could
install!</p>
<h4 id="getting-it-soldered">Getting it soldered</h4>
<p>I grabbed a perforated board and got to wiring and soldering everything
together, changing the pins I was using for the sensor and controller to make
them easier to route (now <code>D5</code> and <code>D2</code>, respectively). For my first time
soldering electronics, it went pretty smoothly. Getting the wires soldered
together took a couple of tries and aren&rsquo;t going to win any beauty contests, but
everything&rsquo;s secure and working fine.</p>
<p>I also added a red status LED adjacent to the blue one I used for power that
will flash when booting or in an error state.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">status_led</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">pin</span>: <span style="color:#e6db74">&#34;D7&#34;</span>
</span></span></code></pre></div><div class="src-block-caption">
  <span class="src-block-number">Code Snippet 1:</span>
  Configuration YAML for the status LED.
</div>
<figure><img src="/ox-hugo/garage-door-soldered-top.png"
         alt="Figure 1: The top, all neatly connected to the board."/><figcaption>
            <p><span class="figure-number">Figure 1: </span>The top, all neatly connected to the board.</p>
        </figcaption>
</figure>

<figure><img src="/ox-hugo/garage-door-soldered-bottom.png"
         alt="Figure 1: The bottom, all wired up."/><figcaption>
            <p><span class="figure-number">Figure 1: </span>The bottom, all wired up.</p>
        </figcaption>
</figure>

<h4 id="designing-and-printing-an-enclosure">Designing and printing an enclosure</h4>
<p>With everything in place, I grabbed my calipers, measured everything, and hopped
into FreeCAD. I put in some supports to hold the board up with some room
underneath for the wires, and cut out holes in the sides where the usb power and
external wires will attach to their screw mounts. I added small bumps on
opposite inside walls to grab the edges of the board and hold it in place. I
then made a lid that will slide in to the top, and opened holes in it for the
LED to shine through and to provide access to the screws for the wire mounts.
The lid also has a small bump for it to hold it in place when fully inserted.</p>
<figure><img src="/ox-hugo/garage-door-freecad.png"
         alt="Figure 1: The completed design in FreeCAD."/><figcaption>
            <p><span class="figure-number">Figure 1: </span>The completed design in FreeCAD.</p>
        </figcaption>
</figure>

<p>There are pretty visible layer lines in the print, likely because I switched in
a new roll of filament for this and didn&rsquo;t dial it in first, but where this
thing is going it doesn&rsquo;t need to be gorgeous.</p>
<figure><img src="/ox-hugo/garage-door-case.png"
         alt="Figure 1: The case and lid freshly printed in white PLA."/><figcaption>
            <p><span class="figure-number">Figure 1: </span>The case and lid freshly printed in white PLA.</p>
        </figcaption>
</figure>

<p>The board popped right into place, nice and cozy in its new home. The openings
lined up pretty well, though I did have to widen the USB opening a bit with an
X-Acto knife so the cable would fit properly.</p>
<figure><img src="/ox-hugo/garage-door-in-case.png"
         alt="Figure 1: Snug in its new home!"/><figcaption>
            <p><span class="figure-number">Figure 1: </span>Snug in its new home!</p>
        </figcaption>
</figure>

<p>The lid slid right in and locked in place just fine! The LEDs shine through
their opening, and the screws are easy to get to and manipulate with a
screwdriver.</p>
<figure><img src="/ox-hugo/garage-door-with-lid.png"
         alt="Figure 1: All tucked in with its lid!"/><figcaption>
            <p><span class="figure-number">Figure 1: </span>All tucked in with its lid!</p>
        </figcaption>
</figure>

<p>I&rsquo;m proud of my little creation and its pretty little case. Next up, installation!</p>
<h4 id="installation">Installation</h4>
<p>Alright, time to get this thing into the garage! Getting this set up was pretty
straightforward. I decided to install the reed switch sensor at the top of the
garage door, screwing the sensor into wood above it and bolting the magnet onto
the top of the metal door such that the magnet is positioned beside the sensor
when the door is closed. Using my laptop, I was able to monitor the device and
see that the switch did correctly register the door&rsquo;s state.</p>
<figure><img src="/ox-hugo/garage-door-installation-sensor.png"
         alt="Figure 1: The switch is mounted to the wall with its wires running up to the rail, the magnet is mounted to the top of the door."/><figcaption>
            <p><span class="figure-number">Figure 1: </span>The switch is mounted to the wall with its wires running up to the rail, the magnet is mounted to the top of the door.</p>
        </figcaption>
</figure>

<p>To connect everything together, I cut some lengths of <a href="https://www.amazon.com/gp/product/B076645YB7">bell wire</a> to the distances
I needed, and got started. I ran a pair of wires from the switch from there to
the garage door opener, where I mounted the device to its frame with some ties.
I may attach it to the ceiling later so it&rsquo;s prettier, but for now this works
just fine. I then wired the <code>NO</code> and <code>COM</code> connectors on the relay switch to the
two leftmost connectors in my garage door opener, which are the two connectors
shared with the wall garage door button.</p>
<figure><img src="/ox-hugo/garage-door-installation-opener.png"
         alt="Figure 1: The wires were added to the garage door opener alongside the wall switch&amp;rsquo;s existing wires."/><figcaption>
            <p><span class="figure-number">Figure 1: </span>The wires were added to the garage door opener alongside the wall switch&rsquo;s existing wires.</p>
        </figcaption>
</figure>

<figure><img src="/ox-hugo/garage-door-installation-device.png"
         alt="Figure 1: The device is mounted to the metal frame with ties, having drilled a couple holes into the back of the enclosure to loop them through."/><figcaption>
            <p><span class="figure-number">Figure 1: </span>The device is mounted to the metal frame with ties, having drilled a couple holes into the back of the enclosure to loop them through.</p>
        </figcaption>
</figure>

<p>With everything connected, I powered up my device with a USB power brick plugged
into the outlet above the door opener, and&hellip; it worked! I was able to open and
close the door using Home Assistant on my laptop or on my phone, and get
feedback on whether the door was left open or closed!</p>
<h3 id="wrapping-up">Wrapping up</h3>
<p>This was a really cool project! I&rsquo;m super proud of it and <em>very</em> happy with the
result, and I learned a great deal about building electronics along the way. I&rsquo;m
looking forward to finding more ways to make our home just a little bit smarter
and easier for us to manage, and I expect I&rsquo;ll have plenty of fun putting
together even more electronic projects in the future!</p>
    </div>
    <div class="post-footer">
      <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "correl" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </article>

    </main>
  </body>
</html>
